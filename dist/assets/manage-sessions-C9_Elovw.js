import{_ as G}from"./BaseAlert-DD7TYDid.js";import{_ as Q}from"./ConfirmDangerDialog-CMa2bCpZ.js";import{_ as R}from"./AppDateTimePicker-BgyvrkNf.js";import{_ as X}from"./SmartTable-raxuwEO6.js";import{_ as $}from"./AppBreadcrumbs-C2qXUlsW.js";import v from"./teacher_api-CttZnCtW.js";import{n as ee}from"./number-DRUmGIrN.js";import{c,b as l,f as k,n as I,e as n,o as r,d as f,p as N,v as x,s as p,aZ as F,F as V,x as S,t as _,b6 as J,C as M,a_ as te,V as L}from"./index-omKhXJNb.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as A,a as U,c as j,b as W}from"./VCard-DlaxaK5b.js";import{V as H}from"./VDialog-Cxtu-VAV.js";import{V as B}from"./VDivider-BYIWte0q.js";import{V as T,a as D}from"./VRow-Du8-Eqpf.js";import{V as P}from"./VSelect-Cgo16f76.js";import{V as q}from"./VSwitch-Dxuq803t.js";import{V as z}from"./VChip-n5LLO8zQ.js";import{V as le,a as ae,b as oe,c as ne}from"./VExpansionPanels-vViuCE-R.js";import{V as Y}from"./VCardText-C-Z2woWC.js";import"./VDataTable-B8pDatzQ.js";import"./VPagination-DWTsJtGR.js";import"./VTable-2KcgklgL.js";import"./filter-DI_52EWd.js";import"./VTooltip-Dg8TXygl.js";import"./axios-CERTCeax.js";import"./VAvatar-wQju2yKo.js";import"./VImg-iVV7VdE5.js";import"./VList-DkM7Hypf.js";const ie={data(){var s;return{keyName:"manage-sessions",results:JSON.parse(localStorage.getItem("user")),breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"الجلسات",disabled:!0}],loading:!1,progress:0,showTable:!1,weekdays:[{text:"الكل",value:null},{text:"الأحد",value:0},{text:"الاثنين",value:1},{text:"الثلاثاء",value:2},{text:"الأربعاء",value:3},{text:"الخميس",value:4},{text:"الجمعة",value:5},{text:"السبت",value:6}],table:{totalItems:0,Data:[],actions:["عرض الطلاب","إضافة طلاب","إنهاء الجلسة","تعديل","حذف"],loading:!1,headers:[{title:"#",type:"strong",sortable:!1,key:"num"},{title:"العنوان",type:"link",sortable:!0,key:"title"},{title:"الدورة",type:"strong",sortable:!0,key:"course_name"},{title:"المرحلة",type:"strong",sortable:!0,key:"grade_name"},{title:"عدد الطلاب",type:"strong",sortable:!0,key:"attendees_count"},{title:"اليوم",type:"strong",sortable:!0,key:"weekdayLabel"},{title:"من",type:"strong",sortable:!0,key:"start_time"},{title:"إلى",type:"strong",sortable:!0,key:"end_time"},{title:"العمليات",type:"strong",sortable:!1,key:"actions"}],tableSettings:{options:{page:1,limit:10,search:null,weekday:null}}},sessionDialog:{open:!1,mode:"create",form:{id:null,title:"",course_id:"",teacher_id:(s=JSON.parse(localStorage.getItem("user")))==null?void 0:s.id,weekdays:[],start_time:"",end_time:"",recurrence:!0,flex_type:null,flex_minutes:null}},attendeesDialog:{open:!1,data:null,loading:!1,candidates:[],selectedIds:[],currentIds:[],currentDetailed:[]},studentsViewDialog:{open:!1,data:null,loading:!1,loadingItem:null,students:[]},endDialog:{open:!1,data:null,messages:["سيتم إنهاء المحاضرة وإشعار الطلاب الحاضرين اليوم."],title:"تأكيد إنهاء الجلسة",confirmButtonText:"إنهاء الجلسة",saving:!1,menus:{start:!1,end:!1}},deleteDialog:{open:!1,loading:!1,data:null,messages:["سيتم حذف الجلسة.","لا يمكن استرجاعها بعد الحذف."],title:"تأكيد الحذف",confirmButtonText:"حذف الجلسة"},alert:{open:!1,message:null,type:"success"},courseItems:[],coursesLoading:!1,flexTypes:[{text:"نافذة (window)",value:"window"},{text:"ثابت (fixed)",value:"fixed"},{text:"بدون",value:null}]}},computed:{weeklyCalendar(){var t;const s=this.weekdays.filter(o=>o.value!==null),e=new Map,m=Array.isArray((t=this.table)==null?void 0:t.Data)?this.table.Data:[];for(const o of m){const u=Array.isArray(o.weekdays)?o.weekdays:o.weekday!==void 0&&o.weekday!==null?[o.weekday]:[],i=o.start_time??"",w=o.end_time??"",b=`${i}-${w}`,C=i&&w?`${i} - ${w}`:i||w||"";for(const a of u){if(!Number.isInteger(a)||a<0||a>6)continue;e.has(b)||e.set(b,{slotKey:b,label:C,start:i,byDay:{0:[],1:[],2:[],3:[],4:[],5:[],6:[]}}),e.get(b).byDay[a].push({...o,__calendarKey:`${o.id??o.title??"x"}-${a}-${b}`})}}const d=Array.from(e.values()).sort((o,u)=>String(o.start||"").localeCompare(String(u.start||"")));for(const o of d)for(const u of s)o.byDay[u.value].sort((i,w)=>String(i.title||"").localeCompare(String(w.title||"")));return{days:s,rows:d}},weeklyCalendarMobile(){var m;const s=this.weekdays.filter(d=>d.value!==null),e=((m=this.weeklyCalendar)==null?void 0:m.rows)||[];return s.map(d=>{const t=e.map(u=>{var i;return{slotKey:u.slotKey,label:u.label,sessions:(((i=u.byDay)==null?void 0:i[d.value])||[]).slice()}}).filter(u=>u.sessions.length>0),o=t.reduce((u,i)=>u+i.sessions.length,0);return{dayValue:d.value,dayText:d.text,count:o,rows:t}})}},created(){const s=JSON.parse(localStorage.getItem(this.keyName));this.table.tableSettings=s||this.table.tableSettings,this.tempScrollTop=(s==null?void 0:s.scrollTop)||0,this.loadCourseNames(),this.getDataAxios()},mounted(){window.addEventListener("scroll",this.handleScroll),this.$watch(()=>this.table.Data,s=>{(s==null?void 0:s.length)>0&&this.tempScrollTop&&setTimeout(()=>{window.scrollTo({top:this.tempScrollTop,behavior:"smooth"}),this.tempScrollTop=0},300)},{deep:!0})},beforeUnmount(){var s;(s=this.unwatch)==null||s.call(this),window.removeEventListener("scroll",this.handleScroll)},methods:{numberWithComma:ee,weekdayName(s){const e=["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];return Number.isInteger(s)&&s>=0&&s<=6?e[s]:String(s??"")},formatWeekdays(s){return Array.isArray(s)?s.map(this.weekdayName).join("، "):this.weekdayName(s)},handleScroll(){const s=window.scrollY||window.pageYOffset,e=JSON.parse(localStorage.getItem(this.keyName))||{};e.scrollTop=s,localStorage.setItem(this.keyName,JSON.stringify(e))},reload(){localStorage.removeItem(this.keyName),this.table.tableSettings.options={page:1,limit:10,search:null,weekday:null},this.getDataAxios()},updateTableOptions(s){this.table.tableSettings.options={...this.table.tableSettings.options,...s,search:s.search?s.search:null},this.getDataAxios()},async getDataAxios(){var e,m,d;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{localStorage.setItem(this.keyName,JSON.stringify(this.table.tableSettings));const t=await v.getSessions(this.table.tableSettings),o=(t==null?void 0:t.data)||{},u=o.data||o.sessions||[];this.table.Data=u.map(i=>({...i,weekdayLabel:i.hasOwnProperty("weekdays")?this.formatWeekdays(i.weekdays):this.formatWeekdays(i.weekday)})),this.table.totalItems=o.count||o.total||((e=o.pagination)==null?void 0:e.total)||0}catch(t){this.showAlert("error",((d=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:d.message)||"حدث خطأ أثناء جلب البيانات")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0},500)}},async loadCourseNames(){var s;try{this.coursesLoading=!0;const e=await v.getCourseNames(),m=((s=e==null?void 0:e.data)==null?void 0:s.data)||[];this.courseItems=m.map(d=>({text:d.name,value:d.id}))}catch{this.showAlert("error","تعذر جلب أسماء الدورات")}finally{this.coursesLoading=!1}},openCreateDialog(){var s;this.sessionDialog.mode="create",this.sessionDialog.form={id:null,title:"",course_id:"",teacher_id:(s=JSON.parse(localStorage.getItem("user")))==null?void 0:s.id,weekdays:[],start_time:"",end_time:"",recurrence:!0,flex_type:null,flex_minutes:null},this.sessionDialog.open=!0},editItem(s){var e,m;this.sessionDialog.mode="edit",this.sessionDialog.form={id:s.id,title:s.title||"",course_id:s.course_id||((e=s.course)==null?void 0:e.id)||"",teacher_id:(m=JSON.parse(localStorage.getItem("user")))==null?void 0:m.id,weekdays:Array.isArray(s.weekdays)?s.weekdays:s.weekday!==void 0?[s.weekday]:[],start_time:s.start_time,end_time:s.end_time,recurrence:s.recurrence??!0,flex_type:s.flex_type??null,flex_minutes:s.flex_minutes??null},this.sessionDialog.open=!0},async saveSession(){var d,t,o,u;const s=this.sessionDialog.mode==="create",e=this.sessionDialog.form;if(!e.course_id||e.weekdays.length===0||!e.start_time||!e.end_time){this.showAlert("error","الحقول الأساسية مطلوبة");return}this.progress=0,this.loading=!0;const m=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{let i;if(s){const w={course_id:e.course_id,teacher_id:e.teacher_id,weekdays:e.weekdays,start_time:e.start_time,end_time:e.end_time,title:e.title||void 0,recurrence:e.recurrence===!0,flex_type:e.flex_type??null,flex_minutes:e.flex_minutes??null,flex_alternates:null,hard_constraints:null,soft_constraints:null,state:"confirmed"};i=await v.createSession(w)}else{const w={course_id:e.course_id,teacher_id:e.teacher_id,weekday:(d=e.weekdays)==null?void 0:d[0],start_time:e.start_time,end_time:e.end_time,title:e.title||void 0,recurrence:e.recurrence===!0,flex_type:e.flex_type??null,flex_minutes:e.flex_minutes??null,state:"confirmed"};i=await v.updateSession(e.id,w)}this.showAlert("success",((t=i==null?void 0:i.data)==null?void 0:t.message)||(s?"تم إنشاء الجلسة":"تم تحديث الجلسة")),this.sessionDialog.open=!1,this.getDataAxios()}catch(i){this.showAlert("error",((u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message)||"حدث خطأ أثناء الحفظ")}finally{clearInterval(m),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0},500)}},openAddAttendeesDialog(s){this.attendeesDialog.data=s,this.attendeesDialog.open=!0,this.attendeesDialog.candidates=[],this.attendeesDialog.selectedIds=[],this.attendeesDialog.currentIds=[],this.attendeesDialog.currentDetailed=[],this.loadAddDialogData()},async loadAddDialogData(){var s,e,m,d,t;try{this.attendeesDialog.loading=!0;const o=await v.getSessionAttendees(this.attendeesDialog.data.id),u=((s=o==null?void 0:o.data)==null?void 0:s.data)||[],i=u.map(g=>typeof g=="object"?g.student_id||g.id:g).filter(Boolean),w=u.map(g=>typeof g=="object"?g:{student_id:g,student_name:String(g)});this.attendeesDialog.currentIds=i,this.attendeesDialog.currentDetailed=w;const b=this.attendeesDialog.data.course_id||((e=this.attendeesDialog.data.course)==null?void 0:e.id);if(!b)throw new Error("لا يوجد معرّف كورس في هذه الجلسة");const C=await v.getCourseConfirmedStudents(b),a=((m=C==null?void 0:C.data)==null?void 0:m.data)||[];this.attendeesDialog.candidates=a,this.attendeesDialog.selectedIds=a.map(g=>g.student_id).filter(g=>this.attendeesDialog.currentIds.includes(g))}catch(o){this.showAlert("error",((t=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"تعذر تحميل الطلاب")}finally{this.attendeesDialog.loading=!1}},async submitAddAttendees(){var t,o,u;const s=this.attendeesDialog.selectedIds||[],e=this.attendeesDialog.currentIds||[],m=s.filter(i=>!e.includes(i));if(m.length===0){this.showAlert("info","لا توجد إضافات جديدة"),this.attendeesDialog.open=!1;return}this.progress=0,this.loading=!0,this.attendeesDialog.loading=!0;const d=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const i=await v.addSessionAttendees(this.attendeesDialog.data.id,m);this.showAlert("success",((t=i==null?void 0:i.data)==null?void 0:t.message)||"تم حفظ التغييرات"),await this.loadAddDialogData(),this.attendeesDialog.open=!1}catch(i){this.showAlert("error",((u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message)||"تعذر إضافة الطلاب")}finally{clearInterval(d),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.attendeesDialog.loading=!1},500)}},openViewStudentsDialog(s){this.studentsViewDialog.data=s,this.studentsViewDialog.open=!0,this.studentsViewDialog.students=[],this.loadStudentsView()},openEndSessionDialog(s){this.endDialog.data=s,this.endDialog.open=!0},navigateToAttendance(s){s!=null&&s.id&&this.$router.push(`/teacher/sessions/attendance/${s.id}`)},async loadStudentsView(){var s,e,m;try{this.studentsViewDialog.loading=!0;const d=await v.getSessionAttendees(this.studentsViewDialog.data.id),o=(((s=d==null?void 0:d.data)==null?void 0:s.data)||[]).map(u=>typeof u=="object"?u:{student_id:u,student_name:String(u),grade_name:"",study_year:""});this.studentsViewDialog.students=o}catch(d){this.showAlert("error",((m=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:m.message)||"تعذر جلب طلاب الجلسة")}finally{this.studentsViewDialog.loading=!1}},async handleEndSession(){var e,m,d;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const t=await v.endSession(this.endDialog.data.id);this.showAlert("success",((e=t==null?void 0:t.data)==null?void 0:e.message)||"تم إنهاء الجلسة وإشعار الطلاب"),this.getDataAxios()}catch(t){this.showAlert("error",((d=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:d.message)||"تعذر إنهاء الجلسة")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.endDialog.open=!1},500)}},deleteItem(s){this.deleteDialog.data=s,this.deleteDialog.open=!0},async handleDelete(){var e,m,d;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const t=await v.deleteSession(this.deleteDialog.data.id);this.showAlert("success",((e=t==null?void 0:t.data)==null?void 0:e.message)||"تم حذف الجلسة"),this.getDataAxios()}catch(t){this.showAlert("error",((d=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:d.message)||"تعذر حذف الجلسة")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.deleteDialog.open=!1},500)}},allowEvery5(s){return s%5===0},showAlert(s,e){this.alert={open:!0,type:s,message:e}}}},re={key:1,class:"week-calendar",dir:"rtl"},de={class:"d-none d-lg-block"},ue={class:"week-calendar__grid"},me={class:"week-calendar__time"},ce={key:0,class:"week-calendar__cellStack"},ge=["onClick","onKeydown"],fe={class:"week-calendar__sessionTitle"},pe={class:"week-calendar__sessionMeta"},_e={key:0},ye={class:"week-calendar__sessionBadges"},he={key:1,class:"week-calendar__empty"},we={class:"d-block d-lg-none"},De={key:1,class:"week-calendar__mobileList"},ke={class:"week-calendar__mobileTime"},be={class:"week-calendar__mobileSessions"},ve=["onClick","onKeydown"],Ve={class:"week-calendar__sessionTitle"},xe={class:"week-calendar__sessionMeta"},Se={key:0},Ie={class:"week-calendar__sessionBadges"},Ae={key:0,class:"text-medium-emphasis"},Ce={key:1},Te={key:0,class:"d-flex flex-wrap gap-2"},Ne={key:1,class:"text-medium-emphasis"},Ue={key:0,class:"text-medium-emphasis"},Be={key:1},Ee={class:"text-subtitle-1"},Oe={class:"text-caption text-medium-emphasis"};function Ke(s,e,m,d,t,o){const u=$,i=X,w=R,b=Q,C=G;return r(),c("div",null,[l(u,{items:t.breadcrumbItems},null,8,["items"]),l(A,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:n(()=>[l(U,{class:"d-flex align-center py-4 px-6"},{default:n(()=>[l(N,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),e[23]||(e[23]=f("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),l(B),l(j,null,{default:n(()=>[l(T,{class:"align-center justify-start pa-2"},{default:n(()=>[l(x,{color:"primary",class:"ma-2","prepend-icon":"ri-add-line",rounded:"pill",elevation:"2",size:"default",onClick:o.openCreateDialog},{default:n(()=>e[24]||(e[24]=[p(" إضافة جلسة ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),l(A,{class:"my-4",elevation:"3",rounded:"lg"},{default:n(()=>[l(U,{class:"d-flex align-center py-4 px-6"},{default:n(()=>[l(N,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),e[25]||(e[25]=f("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),l(B),l(j,null,{default:n(()=>[l(T,{class:"py-3"},{default:n(()=>[l(D,{cols:"12",md:"4"},{default:n(()=>[l(P,{modelValue:t.table.tableSettings.options.weekday,"onUpdate:modelValue":[e[0]||(e[0]=a=>t.table.tableSettings.options.weekday=a),o.getDataAxios],items:t.weekdays,"item-title":"text","item-value":"value",label:"يوم الأسبوع",variant:"outlined",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(D,{cols:"12",md:"4"},{default:n(()=>[l(P,{modelValue:t.table.tableSettings.options.course_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>t.table.tableSettings.options.course_id=a),o.getDataAxios],items:t.courseItems,"item-title":"text","item-value":"value",label:"الكورس",variant:"outlined",loading:t.coursesLoading,disabled:t.coursesLoading,clearable:""},null,8,["modelValue","items","loading","disabled","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{class:"my-4",elevation:"3",rounded:"lg"},{default:n(()=>[l(U,{class:"py-4 px-6"},{default:n(()=>[l(T,{class:"align-center"},{default:n(()=>[l(D,null,{default:n(()=>e[26]||(e[26]=[f("h3",{class:"text-h6 font-weight-bold text-center"},"الروزمانة الأسبوعية",-1)])),_:1}),l(D,{cols:"auto"},{default:n(()=>[l(q,{modelValue:t.showTable,"onUpdate:modelValue":e[2]||(e[2]=a=>t.showTable=a),inset:"",color:"primary","true-value":!0,"false-value":!1,label:"عرض كجدول"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B),l(j,null,{default:n(()=>[o.weeklyCalendar.rows.length?(r(),c("div",re,[f("div",de,[f("div",ue,[e[28]||(e[28]=f("div",{class:"week-calendar__corner"},"الوقت",-1)),(r(!0),c(V,null,S(o.weeklyCalendar.days,a=>(r(),c("div",{key:a.value,class:"week-calendar__day"},_(a.text),1))),128)),(r(!0),c(V,null,S(o.weeklyCalendar.rows,a=>(r(),c(V,{key:a.slotKey},[f("div",me,_(a.label),1),(r(!0),c(V,null,S(o.weeklyCalendar.days,g=>{var y;return r(),c("div",{key:`${a.slotKey}-${g.value}`,class:"week-calendar__cell"},[(y=a.byDay[g.value])!=null&&y.length?(r(),c("div",ce,[(r(!0),c(V,null,S(a.byDay[g.value],h=>{var E,O,K;return r(),c("div",{key:h.__calendarKey,class:"week-calendar__session",role:"button",tabindex:"0",onClick:Z=>o.editItem(h),onKeydown:[J(M(Z=>o.editItem(h),["prevent"]),["enter"]),J(M(Z=>o.editItem(h),["prevent"]),["space"])]},[f("div",fe,_(h.title||"جلسة"),1),f("div",pe,[p(_(h.course_name||((E=h.course)==null?void 0:E.name)||"")+" ",1),h.grade_name||(O=h.grade)!=null&&O.name?(r(),c("span",_e," • "+_(h.grade_name||((K=h.grade)==null?void 0:K.name)),1)):I("",!0)]),f("div",ye,[h.attendees_count!==void 0&&h.attendees_count!==null?(r(),k(z,{key:0,size:"x-small",color:"primary",variant:"tonal"},{default:n(()=>[p(_(h.attendees_count)+" طالب ",1)]),_:2},1024)):I("",!0)])],40,ge)}),128))])):(r(),c("div",he,"—"))])}),128))],64))),128))])]),f("div",we,[l(le,{variant:"accordion",class:"week-calendar__mobile"},{default:n(()=>[(r(!0),c(V,null,S(o.weeklyCalendarMobile,a=>(r(),k(ae,{key:a.dayValue},{default:n(()=>[l(oe,null,{actions:n(()=>[l(z,{size:"x-small",color:"primary",variant:"tonal"},{default:n(()=>[p(_(a.count),1)]),_:2},1024)]),default:n(()=>[p(_(a.dayText)+" ",1)]),_:2},1024),l(ne,null,{default:n(()=>[a.rows.length?(r(),c("div",De,[(r(!0),c(V,null,S(a.rows,g=>(r(),c("div",{key:`${a.dayValue}-${g.slotKey}`,class:"week-calendar__mobileSlot"},[f("div",ke,_(g.label),1),f("div",be,[(r(!0),c(V,null,S(g.sessions,y=>{var h,E,O;return r(),c("div",{key:y.__calendarKey,class:"week-calendar__session",role:"button",tabindex:"0",onClick:K=>o.editItem(y),onKeydown:[J(M(K=>o.editItem(y),["prevent"]),["enter"]),J(M(K=>o.editItem(y),["prevent"]),["space"])]},[f("div",Ve,_(y.title||"جلسة"),1),f("div",xe,[p(_(y.course_name||((h=y.course)==null?void 0:h.name)||"")+" ",1),y.grade_name||(E=y.grade)!=null&&E.name?(r(),c("span",Se," • "+_(y.grade_name||((O=y.grade)==null?void 0:O.name)),1)):I("",!0)]),f("div",Ie,[y.attendees_count!==void 0&&y.attendees_count!==null?(r(),k(z,{key:0,size:"x-small",color:"primary",variant:"tonal"},{default:n(()=>[p(_(y.attendees_count)+" طالب ",1)]),_:2},1024)):I("",!0)])],40,ve)}),128))])]))),128))])):(r(),k(F,{key:0,type:"info",variant:"tonal"},{default:n(()=>e[29]||(e[29]=[p(" لا توجد جلسات في هذا اليوم. ")])),_:1}))]),_:2},1024)]),_:2},1024))),128))]),_:1})])])):(r(),k(F,{key:0,type:"info",variant:"tonal"},{default:n(()=>e[27]||(e[27]=[p(" لا توجد جلسات لعرضها في الروزنامة. ")])),_:1}))]),_:1})]),_:1}),t.showTable?(r(),k(A,{key:0,class:"my-4",elevation:"3",rounded:"lg"},{default:n(()=>[l(U,{class:"py-4 px-6"},{default:n(()=>[l(T,{class:"align-center"},{default:n(()=>[l(D,{cols:"auto"},{default:n(()=>[l(x,{color:"primary",onClick:e[3]||(e[3]=a=>o.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small"})]),_:1}),l(D,null,{default:n(()=>e[30]||(e[30]=[f("h3",{class:"text-h6 font-weight-bold text-center"},"قائمة الجلسات",-1)])),_:1}),l(D,{cols:"auto"},{default:n(()=>[l(z,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:n(()=>[p(_(o.numberWithComma(t.table.totalItems))+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),l(B),l(j,null,{default:n(()=>[l(i,{headers:t.table.headers,items:t.table.Data,actions:t.table.actions,loading:t.table.loading,totalItems:t.table.totalItems,tableOptions:t.table.tableSettings.options,onUpdateTableOptions:o.updateTableOptions,onEditItem:o.editItem,onDeleteItem:o.deleteItem,onShowItem:o.navigateToAttendance,onShowAttendeesItem:o.openViewStudentsDialog,onAddAttendeesItem:o.openAddAttendeesDialog,onEndSessionItem:o.openEndSessionDialog},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onEditItem","onDeleteItem","onShowItem","onShowAttendeesItem","onAddAttendeesItem","onEndSessionItem"])]),_:1})]),_:1})):I("",!0),l(H,{modelValue:t.sessionDialog.open,"onUpdate:modelValue":e[11]||(e[11]=a=>t.sessionDialog.open=a),"max-width":"700"},{default:n(()=>[l(A,{title:t.sessionDialog.mode==="create"?"إضافة جلسة":"تعديل الجلسة"},{default:n(()=>[l(Y,null,{default:n(()=>[l(T,null,{default:n(()=>[l(D,{cols:"12"},{default:n(()=>[l(te,{modelValue:t.sessionDialog.form.title,"onUpdate:modelValue":e[4]||(e[4]=a=>t.sessionDialog.form.title=a),label:"عنوان الجلسة",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(D,{cols:"12",md:"6"},{default:n(()=>[l(P,{modelValue:t.sessionDialog.form.course_id,"onUpdate:modelValue":e[5]||(e[5]=a=>t.sessionDialog.form.course_id=a),items:t.courseItems,"item-title":"text","item-value":"value",label:"اختر الكورس",variant:"outlined",loading:t.coursesLoading,disabled:t.coursesLoading,clearable:""},null,8,["modelValue","items","loading","disabled"])]),_:1}),l(D,{cols:"12",md:"6"},{default:n(()=>[l(P,{modelValue:t.sessionDialog.form.weekdays,"onUpdate:modelValue":e[6]||(e[6]=a=>t.sessionDialog.form.weekdays=a),items:t.weekdays.filter(a=>a.value!==null),"item-title":"text","item-value":"value",label:"أيام الأسبوع",multiple:"",chips:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),l(D,{cols:"12",md:"3"},{default:n(()=>[l(w,{modelValue:t.sessionDialog.form.start_time,"onUpdate:modelValue":e[7]||(e[7]=a=>t.sessionDialog.form.start_time=a),label:"بداية",variant:"outlined",clearable:"",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,minuteIncrement:5}},null,8,["modelValue"])]),_:1}),l(D,{cols:"12",md:"3"},{default:n(()=>[l(w,{modelValue:t.sessionDialog.form.end_time,"onUpdate:modelValue":e[8]||(e[8]=a=>t.sessionDialog.form.end_time=a),label:"نهاية",variant:"outlined",clearable:"",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,minuteIncrement:5}},null,8,["modelValue"])]),_:1}),l(D,{cols:"12",md:"6"},{default:n(()=>[l(q,{modelValue:t.sessionDialog.form.recurrence,"onUpdate:modelValue":e[9]||(e[9]=a=>t.sessionDialog.form.recurrence=a),inset:"",color:"primary","true-value":!0,"false-value":!1,label:"تكرار أسبوعي"},null,8,["modelValue"])]),_:1})]),_:1}),l(B,{class:"my-4"})]),_:1}),l(W,null,{default:n(()=>[l(L),l(x,{variant:"text",onClick:e[10]||(e[10]=a=>t.sessionDialog.open=!1)},{default:n(()=>e[31]||(e[31]=[p("إلغاء")])),_:1}),l(x,{color:"primary",onClick:o.saveSession},{default:n(()=>[p(_(t.sessionDialog.mode==="create"?"إضافة":"تحديث"),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),l(H,{modelValue:t.attendeesDialog.open,"onUpdate:modelValue":e[15]||(e[15]=a=>t.attendeesDialog.open=a),"max-width":"720"},{default:n(()=>[l(A,null,{default:n(()=>[l(U,{class:"d-flex align-center"},{default:n(()=>[l(N,{icon:"ri-user-add-line",class:"me-2"}),e[32]||(e[32]=p(" إضافة طلاب للجلسة ")),l(L),l(x,{icon:"",variant:"text",onClick:e[12]||(e[12]=a=>t.attendeesDialog.open=!1)},{default:n(()=>[l(N,{icon:"ri-close-line"})]),_:1})]),_:1}),l(Y,null,{default:n(()=>[e[33]||(e[33]=f("div",{class:"mb-4 text-medium-emphasis"}," اختر الطلاب المؤكدين في هذا الكورس لإضافتهم إلى الجلسة. الطلاب الموجودون مسبقًا محددون تلقائيًا. ",-1)),l(T,null,{default:n(()=>[l(D,{cols:"12"},{default:n(()=>[l(P,{modelValue:t.attendeesDialog.selectedIds,"onUpdate:modelValue":e[13]||(e[13]=a=>t.attendeesDialog.selectedIds=a),items:t.attendeesDialog.candidates,"item-title":"name","item-value":"id",label:"اختر الطلاب",variant:"outlined",loading:t.attendeesDialog.loading,disabled:t.attendeesDialog.loading,multiple:"",chips:"",clearable:""},null,8,["modelValue","items","loading","disabled"])]),_:1})]),_:1}),l(B,{class:"my-4"}),e[34]||(e[34]=f("div",{class:"text-subtitle-2 mb-2"},"الطلاب الحاليون في الجلسة",-1)),t.attendeesDialog.loading?(r(),c("div",Ae," جاري التحميل... ")):(r(),c("div",Ce,[t.attendeesDialog.currentDetailed.length?(r(),c("div",Te,[(r(!0),c(V,null,S(t.attendeesDialog.currentDetailed,a=>(r(),k(z,{key:a.student_id||a,size:"small",class:"ma-1",variant:"outlined",closable:"","onClick:close":g=>s.removeOneAttendee(a.student_id||a)},{default:n(()=>[p(_(a.student_name||a),1)]),_:2},1032,["onClick:close"]))),128))])):(r(),c("div",Ne," لا توجد قائمة حضور بعد "))]))]),_:1}),l(W,null,{default:n(()=>[l(L),l(x,{variant:"text",onClick:e[14]||(e[14]=a=>t.attendeesDialog.open=!1)},{default:n(()=>e[35]||(e[35]=[p("إلغاء")])),_:1}),l(x,{color:"primary",loading:t.attendeesDialog.loading,onClick:o.submitAddAttendees},{default:n(()=>e[36]||(e[36]=[p("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(H,{modelValue:t.studentsViewDialog.open,"onUpdate:modelValue":e[18]||(e[18]=a=>t.studentsViewDialog.open=a),"max-width":"720"},{default:n(()=>[l(A,null,{default:n(()=>[l(U,{class:"d-flex align-center"},{default:n(()=>[l(N,{icon:"ri-team-line",class:"me-2"}),e[37]||(e[37]=p(" طلاب الجلسة ")),l(L),l(x,{icon:"",variant:"text",onClick:e[16]||(e[16]=a=>t.studentsViewDialog.open=!1)},{default:n(()=>[l(N,{icon:"ri-close-line"})]),_:1})]),_:1}),l(Y,null,{default:n(()=>[t.studentsViewDialog.loading?(r(),c("div",Ue," جاري التحميل... ")):(r(),c("div",Be,[t.studentsViewDialog.students.length?(r(),k(T,{key:1},{default:n(()=>[(r(!0),c(V,null,S(t.studentsViewDialog.students,a=>(r(),k(D,{cols:"12",md:"6",key:a.student_id},{default:n(()=>[l(A,{variant:"tonal",class:"pa-3 d-flex align-center justify-space-between"},{default:n(()=>[f("div",null,[f("div",Ee,_(a.student_name),1),f("div",Oe,_(a.grade_name)+" • "+_(a.study_year),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),k(F,{key:0,type:"info",variant:"tonal"},{default:n(()=>e[38]||(e[38]=[p(" لا يوجد طلاب مسجلون في هذه الجلسة بعد. ")])),_:1}))]))]),_:1}),l(W,null,{default:n(()=>[l(L),l(x,{color:"primary",variant:"tonal",onClick:e[17]||(e[17]=a=>t.studentsViewDialog.open=!1)},{default:n(()=>e[39]||(e[39]=[p("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.endDialog.open?(r(),k(b,{key:1,modelValue:t.endDialog.open,"onUpdate:modelValue":e[19]||(e[19]=a=>t.endDialog.open=a),messages:t.endDialog.messages,title:t.endDialog.title,confirmButtonText:t.endDialog.confirmButtonText,onConfirm:o.handleEndSession},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"])):I("",!0),t.deleteDialog.open?(r(),k(b,{key:2,modelValue:t.deleteDialog.open,"onUpdate:modelValue":e[20]||(e[20]=a=>t.deleteDialog.open=a),messages:t.deleteDialog.messages,title:t.deleteDialog.title,confirmButtonText:t.deleteDialog.confirmButtonText,onConfirm:o.handleDelete},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"])):I("",!0),t.alert.open?(r(),k(C,{key:3,modelValue:t.alert.open,"onUpdate:modelValue":e[21]||(e[21]=a=>t.alert.open=a),type:t.alert.type,message:t.alert.message,closable:!0,"close-text":"موافق",onClose:e[22]||(e[22]=a=>t.alert.open=!1)},null,8,["modelValue","type","message"])):I("",!0)])}const ut=se(ie,[["render",Ke],["__scopeId","data-v-10993053"]]);export{ut as default};
