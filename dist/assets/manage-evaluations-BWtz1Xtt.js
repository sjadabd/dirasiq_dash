import{_ as L}from"./BaseAlert-DoKdMpQw.js";import{_ as O}from"./SmartTable-Dz8Zr6aJ.js";import{_ as S}from"./AppDateTimePicker-CMgdfasL.js";import{_ as x}from"./AppBreadcrumbs-CGDMHBEQ.js";import{T as _}from"./teacher_api-B0aW0cjW.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as c,b,a as v}from"./VCard-q0Xiefi9.js";import{c as C,b as t,f as D,x as N,e as s,o as V,d as g,k,A as w,q as Y,t as I}from"./index-B-ugD3CV.js";import{V as y}from"./VDivider-0jTJqE-a.js";import{V as h,a as m}from"./VRow-_6XExfSs.js";import{V as T}from"./VSelect-BF-InOJ4.js";import{V as B}from"./VChip-CqnLjyZp.js";import{V as U}from"./VCardText-Dz05REAW.js";import"./VDialog-tPozjQ9z.js";import"./number-DRUmGIrN.js";import"./VDataTable-BKmv_R-I.js";import"./VTable-CytjlrFV.js";import"./filter-t3VeyftY.js";import"./VTooltip-DBiBnYrr.js";import"./axios-D6DdSkOE.js";import"./VAvatar-BSxHYKKi.js";import"./VImg-CPt2aJgH.js";import"./VList-Dy5AF_mx.js";const F={name:"teacher-evaluations-manage-evaluations",data(){return{keyName:"teacher-manage-evaluations",results:JSON.parse(localStorage.getItem("user")),loading:!1,progress:0,breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"تقييمات الطلاب",disabled:!0}],studyYears:[],yearsLoading:!1,filters:{studyYear:"",from:null,to:null},table:{headers:[{title:"#",type:"strong",key:"num",sortable:!1},{title:"الطالب",type:"strong",key:"student_name",sortable:!0},{title:"الدورة",type:"strong",key:"course_name",sortable:!1},{title:"التاريخ",type:"date",key:"eval_date",sortable:!0},{title:"علمي",type:"strong",key:"scientific_level_label",sortable:!1},{title:"سلوكي",type:"strong",key:"behavioral_level_label",sortable:!1},{title:"حضور",type:"strong",key:"attendance_level_label",sortable:!1},{title:"واجب",type:"strong",key:"homework_preparation_label",sortable:!1},{title:"مشاركة",type:"strong",key:"participation_level_label",sortable:!1},{title:"اتباع التعليمات",type:"strong",key:"instruction_following_label",sortable:!1}],actions:["عرض","تعديل"],items:[],total:0,loading:!1,options:{page:1,limit:10,search:null}},alert:{open:!1,type:"success",message:""}}},computed:{total(){return Number(this.table.total||0)}},created(){const a=JSON.parse(localStorage.getItem(this.keyName));a!=null&&a.filters&&(this.filters={...this.filters,...a.filters}),a!=null&&a.tableOptions&&(this.table.options={...this.table.options,...a.tableOptions}),this.loadAcademicYears()},methods:{showAlert(a,l){Object.assign(this.alert,{type:a,message:l,open:!0})},levelLabel(a){return{excellent:"ممتاز",very_good:"جيد جدًا",good:"جيد",fair:"مقبول",weak:"ضعيف"}[String(a||"").toLowerCase()]||"—"},async loadAcademicYears(){var a;try{this.yearsLoading=!0;const l=await _.getAcademicYears(),n=((a=l==null?void 0:l.data)==null?void 0:a.data)||{},p=Array.isArray(n.years)?n.years:[],e=n.active||null;this.studyYears=p.map(o=>({label:o.year,value:o.year})),this.filters.studyYear||(this.filters.studyYear=(e==null?void 0:e.year)||"")}catch{}finally{this.yearsLoading=!1,this.getData()}},async getData(){var a,l,n,p;try{this.table.loading=!0,localStorage.setItem(this.keyName,JSON.stringify({filters:this.filters,tableOptions:this.table.options}));const e={page:this.table.options.page,limit:this.table.options.limit};this.filters.studyYear&&(e.studyYear=this.filters.studyYear),this.filters.from&&(e.from=this.filters.from),this.filters.to&&(e.to=this.filters.to);const o=await _.listEvaluations(e),u=((a=o==null?void 0:o.data)==null?void 0:a.data)||[],d=((l=o==null?void 0:o.data)==null?void 0:l.pagination)||{total:u.length};this.table.total=d.total||0,this.table.items=u.map((i,f)=>{var r;return{...i,num:(this.table.options.page-1)*this.table.options.limit+(f+1),student_name:((r=i.student)==null?void 0:r.name)||i.student_name||"—",scientific_level_label:this.levelLabel(i.scientific_level),behavioral_level_label:this.levelLabel(i.behavioral_level),attendance_level_label:this.levelLabel(i.attendance_level),homework_preparation_label:this.levelLabel(i.homework_preparation),participation_level_label:this.levelLabel(i.participation_level),instruction_following_label:this.levelLabel(i.instruction_following)}})}catch(e){this.showAlert("error",((p=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:p.message)||"فشل جلب التقييمات")}finally{this.table.loading=!1}},updateOptions(a){this.table.options={...this.table.options,...a},this.getData()},applyFilters(){this.table.options.page=1,this.getData()},resetFilters(){this.filters={studyYear:this.filters.studyYear||"",from:null,to:null},this.applyFilters()},reload(){this.table.options={page:1,limit:10,search:null},this.getData()},openDetails(a){this.$router.push({name:"teacher-evaluations-evaluation-details",query:{id:a.id}})},goToBulk(){this.$router.push({name:"teacher-evaluations-bulk-upsert-evaluations"})}}};function z(a,l,n,p,e,o){const u=x,d=S,i=O,f=L;return V(),C("div",null,[t(u,{items:e.breadcrumbItems},null,8,["items"]),t(c,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:s(()=>[t(b,{class:"d-flex align-center py-4 px-6"},{default:s(()=>[t(k,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),l[5]||(l[5]=g("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),t(y),t(v,null,{default:s(()=>[t(h,{class:"align-center justify-start pa-2"},{default:s(()=>[t(w,{color:"primary",class:"ms-3","prepend-icon":"ri-add-line",onClick:o.goToBulk},{default:s(()=>l[6]||(l[6]=[Y("إضافة تقييمات ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(c,{class:"my-4 filter-card",elevation:"3",rounded:"lg"},{default:s(()=>[t(b,{class:"d-flex align-center py-4 px-6"},{default:s(()=>[t(k,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),l[7]||(l[7]=g("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),t(y),t(v,null,{default:s(()=>[t(h,{style:{"padding-block":"10px"}},{default:s(()=>[t(m,{cols:"12",md:"3"},{default:s(()=>[t(T,{modelValue:e.filters.studyYear,"onUpdate:modelValue":[l[0]||(l[0]=r=>e.filters.studyYear=r),o.applyFilters],items:e.studyYears,"item-title":"label","item-value":"value",label:"السنة الدراسية",variant:"outlined",loading:e.yearsLoading},null,8,["modelValue","onUpdate:modelValue","items","loading"])]),_:1}),t(m,{cols:"12",md:"3"},{default:s(()=>[t(d,{modelValue:e.filters.from,"onUpdate:modelValue":[l[1]||(l[1]=r=>e.filters.from=r),o.getData],clearable:"",label:"من تاريخ",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{cols:"12",md:"3"},{default:s(()=>[t(d,{modelValue:e.filters.to,"onUpdate:modelValue":[l[2]||(l[2]=r=>e.filters.to=r),o.getData],clearable:"",label:"إلى تاريخ",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(c,{class:"my-4"},{default:s(()=>[t(b,{class:"py-4 px-6"},{default:s(()=>[t(h,{class:"align-center"},{default:s(()=>[t(m,{cols:"auto"},{default:s(()=>[t(w,{color:"primary",onClick:l[3]||(l[3]=r=>o.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small",class:"rotate-on-hover"})]),_:1}),t(m,null,{default:s(()=>l[8]||(l[8]=[g("h3",{class:"text-h5 font-weight-bold text-center"},"تقييمات الطلاب",-1)])),_:1}),t(m,{cols:"auto"},{default:s(()=>[t(B,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:s(()=>[Y(I(Number(o.total).toLocaleString())+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(y),t(U,null,{default:s(()=>[t(i,{headers:e.table.headers,items:e.table.items,actions:e.table.actions,loading:e.table.loading,totalItems:e.table.total,tableOptions:e.table.options,onUpdateTableOptions:o.updateOptions,onShowItem:o.openDetails},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onShowItem"])]),_:1})]),_:1}),e.alert.open?(V(),D(f,{key:0,modelValue:e.alert.open,"onUpdate:modelValue":l[4]||(l[4]=r=>e.alert.open=r),type:e.alert.type,message:e.alert.message,closable:!0,"close-text":"موافق"},null,8,["modelValue","type","message"])):N("",!0)])}const ne=A(F,[["render",z]]);export{ne as default};
