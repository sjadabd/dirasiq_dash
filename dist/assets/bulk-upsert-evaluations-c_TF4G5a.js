import{_ as B}from"./BaseAlert-CIbD5vpV.js";import{_ as D}from"./AppDateTimePicker-Csyw9e3Q.js";import{_ as T}from"./AppBreadcrumbs-4YtabGru.js";import f from"./teacher_api-nZLuEPFA.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as v,a as h,c as w}from"./VCard-5UFuo9Gy.js";import{c as p,b as l,f as x,n as V,e as s,o as c,d as a,p as g,v as N,s as y,V as E,aZ as F,F as j,x as z,t as k,a_ as U}from"./index-Dmazqufq.js";import{V as b}from"./VDivider-BLGk5e6u.js";import{V as A,a as S}from"./VRow-Cfs-sVJ7.js";import{V as m}from"./VSelect-Ci3tM8yu.js";import{V as M}from"./VCardText-CjxXXCA6.js";import{V as P}from"./VTable-DFA04fiE.js";import"./VDialog-DbDU-h44.js";import"./axios-BuMR_4uE.js";import"./VAvatar-Dibs5cVm.js";import"./VImg-CpbG_9zB.js";import"./VList-2eAnxCjm.js";import"./VChip-mqYz0viO.js";const R={name:"teacher-evaluations-bulk-upsert-evaluations",data(){const i=new Date,t=i.getFullYear(),n=String(i.getMonth()+1).padStart(2,"0"),u=String(i.getDate()).padStart(2,"0");return{breadcrumbs:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"تقييمات الطلاب",disabled:!1,to:"/teacher/evaluations/manage-evaluations"},{title:"إضافة تقييمات يومية",disabled:!0}],form:{date:`${t}-${n}-${u}`,course_id:null},levelOptions:[{title:"ممتاز",value:"excellent"},{title:"جيد جدًا",value:"very_good"},{title:"جيد",value:"good"},{title:"مقبول",value:"fair"},{title:"ضعيف",value:"weak"}],students:[],loading:!1,saving:!1,alert:{open:!1,type:"success",message:""},courseItems:[],coursesLoading:!1}},created(){this.loadCourses()},watch:{"form.date"(i){i&&this.form.course_id&&this.loadStudents()},"form.course_id"(i){i&&this.form.date&&this.loadStudents()}},methods:{showAlert(i,t){Object.assign(this.alert,{type:i,message:t,open:!0})},async loadCourses(){var i;try{this.coursesLoading=!0;const t=await f.getCourseNames();this.courseItems=(((i=t==null?void 0:t.data)==null?void 0:i.data)||[]).map(n=>({text:n.name,value:n.id}))}catch{}finally{this.coursesLoading=!1}},async loadStudents(){var i,t,n;try{if(!this.form.date||!this.form.course_id){this.showAlert("info","اختر التاريخ والدورة أولاً");return}this.loading=!0;const u={date:this.form.date,courseId:this.form.course_id,page:1,limit:200},e=await f.getStudentsWithEval(u),_=((i=e==null?void 0:e.data)==null?void 0:i.data)||[];this.students=_.map(r=>({student_id:r.student_id,student_name:r.student_name,scientific_level:r.scientific_level,behavioral_level:r.behavioral_level,attendance_level:r.attendance_level,homework_preparation:r.homework_preparation,participation_level:r.participation_level,instruction_following:r.instruction_following,guidance:r.guidance,notes:r.notes}))}catch(u){this.showAlert("error",((n=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:n.message)||"فشل جلب الطلاب")}finally{this.loading=!1}},async saveAll(){var i,t;try{if(!this.form.date){this.showAlert("error","التاريخ مطلوب");return}const n=this.students.filter(e=>e.student_id).map(e=>({student_id:e.student_id,scientific_level:e.scientific_level||null,behavioral_level:e.behavioral_level||null,attendance_level:e.attendance_level||null,homework_preparation:e.homework_preparation||null,participation_level:e.participation_level||null,instruction_following:e.instruction_following||null,guidance:e.guidance||null,notes:e.notes||null}));if(!n.length){this.showAlert("error","أضف طالبًا واحدًا على الأقل");return}this.saving=!0;const u=new Date(`${this.form.date}T00:00:00`).toISOString();await f.bulkUpsertEvaluations({eval_date:u,items:n}),this.showAlert("success","تم حفظ التقييمات وإرسال الإشعارات")}catch(n){this.showAlert("error",((t=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:t.message)||"فشل حفظ التقييمات")}finally{this.saving=!1}}}},W={"data-label":"#"},Y={"data-label":"الطالب"},Z={"data-label":"علمي"},q={"data-label":"سلوكي"},G={"data-label":"حضور"},H={"data-label":"واجب"},J={"data-label":"مشاركة"},K={"data-label":"اتباع التعليمات"},Q={"data-label":"توجيه"},X={"data-label":"ملاحظات"},$={key:0};function ee(i,t,n,u,e,_){const r=T,C=D,O=B;return c(),p("div",null,[l(r,{items:e.breadcrumbs},null,8,["items"]),l(v,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:s(()=>[l(h,{class:"d-flex align-center py-4 px-6"},{default:s(()=>[l(g,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),t[3]||(t[3]=a("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),l(b),l(w,null,{default:s(()=>[l(A,{class:"align-center justify-start pa-2"},{default:s(()=>[l(N,{color:"primary",loading:e.saving,"prepend-icon":"ri-save-3-line",onClick:_.saveAll},{default:s(()=>t[4]||(t[4]=[y("حفظ التقييمات")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1}),l(v,{class:"my-4 filter-card",elevation:"3",rounded:"lg"},{default:s(()=>[l(h,{class:"d-flex align-center py-4 px-6"},{default:s(()=>[l(g,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),t[5]||(t[5]=a("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),l(b),l(w,null,{default:s(()=>[l(A,{style:{"padding-block":"10px"}},{default:s(()=>[l(S,{cols:"12",md:"3"},{default:s(()=>[l(C,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=o=>e.form.date=o),type:"date",label:"تاريخ التقييم",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(S,{cols:"12",md:"3"},{default:s(()=>[l(m,{modelValue:e.form.course_id,"onUpdate:modelValue":t[1]||(t[1]=o=>e.form.course_id=o),items:e.courseItems,"item-title":"text","item-value":"value",label:"الدورة",density:"comfortable",loading:e.coursesLoading},null,8,["modelValue","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),l(v,{class:"my-4"},{default:s(()=>[l(h,{class:"d-flex align-center"},{default:s(()=>[l(g,{class:"me-2"},{default:s(()=>t[6]||(t[6]=[y("ri-award-line")])),_:1}),t[7]||(t[7]=a("span",{class:"text-h6"},"إضافة تقييمات يومية (مجموعة)",-1)),l(E)]),_:1}),l(b),l(M,null,{default:s(()=>[!e.form.date||!e.form.course_id?(c(),x(F,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:s(()=>t[8]||(t[8]=[y(' اختر التاريخ والدورة. سيتم جلب الطلاب تلقائيًا عند اكتمال الاختيار، أو اضغط "تحديث الطلاب" يدويًا. ')])),_:1})):V("",!0),l(P,{density:"comfortable"},{default:s(()=>[t[10]||(t[10]=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"الطالب"),a("th",null,"علمي"),a("th",null,"سلوكي"),a("th",null,"حضور"),a("th",null,"واجب"),a("th",null,"مشاركة"),a("th",null,"اتباع التعليمات"),a("th",null,"توجيه"),a("th",null,"ملاحظات")])],-1)),a("tbody",null,[(c(!0),p(j,null,z(e.students,(o,I)=>(c(),p("tr",{key:o.student_id},[a("td",W,k(I+1),1),a("td",Y,k(o.student_name),1),a("td",Z,[l(m,{items:e.levelOptions,modelValue:o.scientific_level,"onUpdate:modelValue":d=>o.scientific_level=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",q,[l(m,{items:e.levelOptions,modelValue:o.behavioral_level,"onUpdate:modelValue":d=>o.behavioral_level=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",G,[l(m,{items:e.levelOptions,modelValue:o.attendance_level,"onUpdate:modelValue":d=>o.attendance_level=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",H,[l(m,{items:e.levelOptions,modelValue:o.homework_preparation,"onUpdate:modelValue":d=>o.homework_preparation=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",J,[l(m,{items:e.levelOptions,modelValue:o.participation_level,"onUpdate:modelValue":d=>o.participation_level=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",K,[l(m,{items:e.levelOptions,modelValue:o.instruction_following,"onUpdate:modelValue":d=>o.instruction_following=d,"item-title":"title","item-value":"value",density:"compact","hide-details":""},null,8,["items","modelValue","onUpdate:modelValue"])]),a("td",Q,[l(U,{modelValue:o.guidance,"onUpdate:modelValue":d=>o.guidance=d,density:"compact","hide-details":"",placeholder:"توجيه (اختياري)"},null,8,["modelValue","onUpdate:modelValue"])]),a("td",X,[l(U,{modelValue:o.notes,"onUpdate:modelValue":d=>o.notes=d,density:"compact","hide-details":"",placeholder:"ملاحظات (اختياري)"},null,8,["modelValue","onUpdate:modelValue"])])]))),128)),!e.loading&&!e.students.length?(c(),p("tr",$,t[9]||(t[9]=[a("td",{colspan:"10",class:"text-center text-medium-emphasis"},"لا يوجد طلاب لعرضهم",-1)]))):V("",!0)])]),_:1})]),_:1})]),_:1}),e.alert.open?(c(),x(O,{key:0,modelValue:e.alert.open,"onUpdate:modelValue":t[2]||(t[2]=o=>e.alert.open=o),type:e.alert.type,message:e.alert.message,closable:!0,"close-text":"موافق"},null,8,["modelValue","type","message"])):V("",!0)])}const ge=L(R,[["render",ee],["__scopeId","data-v-bd32c9aa"]]);export{ge as default};
