import{r as C,k as O,m as U,c as x,o as m,d as c,f as I,b as o,h as $,b7 as W,e as a,F as D,x as E,D as G,A as H,s as h,B as K,p as N,t as v,n as T,v as F}from"./index-DzRnBGoW.js";import z from"./teacher_api-DSYadeDI.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Y,V as Z}from"./VRow-1sXKMjVm.js";import{V as Q}from"./VCard-DkKUq9Xw.js";import{V as w}from"./VCardText-DxpVkpnf.js";import{V as ee}from"./VChip-BxDWJl9X.js";import{V as te,a as se,b as ae}from"./VList-C_vO-TC7.js";import{V as re}from"./VSnackbar-qXnOCxfQ.js";const oe={class:"text-center mb-6"},ie={class:"text-h3 pricing-title pb-2"},le={key:0,class:"text-center py-10"},ne={class:"text-h4 mb-1"},ce={class:"mb-0 text-body-1"},de={class:"d-flex justify-center align-center"},ue={class:"text-h1 font-weight-medium text-primary"},me={key:0,class:"text-body-1 font-weight-medium align-self-end ms-2"},fe={key:0,class:"text-caption mt-2"},ye={__name:"AppPricing",props:{title:{type:String,default:"خطط التسعير"},cols:{type:[Number,String],default:12},sm:{type:[Number,String],default:6},md:{type:[Number,String],default:4},lg:{type:[Number,String],default:4},xl:{type:[Number,String],default:4}},setup(R){const b=R,_=C([]),S=C(!1),y=C({show:!1,message:"",color:"error"}),j=O();async function A(){var i,t,e;S.value=!0;try{const d=await z.getActivePackages(),u=((t=(i=d.data)==null?void 0:i.data)==null?void 0:t.data)||((e=d.data)==null?void 0:e.data)||d,k=Array.isArray(u==null?void 0:u.data)?u.data:u;if(!Array.isArray(k))throw new Error("Invalid response data");const f=k.map(s=>{const l=s.isFree||s.price===0,p=l?0:s.price;return{id:s.id,name:s.name,tagLine:s.description||(l?"مجاناً للمعلمين الجدد":"ميزات متقدمة"),logo:l?"/images/gift-icon.png":"/images/star-icon.png",monthlyPrice:p,yearlyPrice:p*12,isPopular:!1,current:!!s.current,features:[`حتى ${s.maxStudents} طالب`,s.description||(l?"مجاناً للمعلمين الجدد":"ميزات متقدمة"),s.durationDays===30?"اشتراك شهري":`اشتراك ${s.durationDays} يوم`,"دعم فني مخصص"]}}),P=f.findIndex(s=>{var l,p;return((l=s.name)==null?void 0:l.trim())==="الباقة الاحترافية"||((p=s.name)==null?void 0:p.toLowerCase().includes("professional"))});if(P!==-1)f.forEach(s=>s.isPopular=!1),f[P].isPopular=!0;else{const s=f.findIndex(l=>l.monthlyPrice!==0);s!==-1&&(f[s].isPopular=!0)}_.value=f}catch(d){y.value={show:!0,message:"تعذر تحميل الباقات. يرجى المحاولة لاحقًا",color:"error"},console.warn("⚠️ Failed to fetch pricing plans:",d)}finally{S.value=!1}}async function q(i){var t,e,d,u,k,f,P,s,l,p;if(!i.current)try{if(i.monthlyPrice===0){const n=await z.activateSubscriptionPackage(i.id),L=((t=n==null?void 0:n.data)==null?void 0:t.success)||(n==null?void 0:n.success),M=((e=n==null?void 0:n.data)==null?void 0:e.message)||(n==null?void 0:n.message)||`تم تفعيل باقة ${i.name} بنجاح`;y.value={show:!0,message:M,color:L?"success":"error"},L&&(_.value=_.value.map(B=>({...B,current:B.id===i.id})));return}const r=await z.createWaylSubscriptionLink(i.id),J=((d=r==null?void 0:r.data)==null?void 0:d.success)||(r==null?void 0:r.success),V=((u=r==null?void 0:r.data)==null?void 0:u.data)||(r==null?void 0:r.data)||r;if(!J||!(V!=null&&V.url))throw new Error(((k=r==null?void 0:r.data)==null?void 0:k.message)||"تعذر إنشاء رابط الدفع");localStorage.setItem("pending_wayl_action",JSON.stringify({type:"subscription",createdAt:Date.now(),packageId:i.id})),j.push({path:"/teacher/payment/redirecting",query:{url:V.url}})}catch(g){console.warn("Failed to activate subscription package:",g);const r=((P=(f=g==null?void 0:g.response)==null?void 0:f.data)==null?void 0:P.message)||((p=(l=(s=g==null?void 0:g.response)==null?void 0:s.data)==null?void 0:l.errors)==null?void 0:p[0])||"تعذر تفعيل الباقة، يرجى المحاولة لاحقًا";y.value={show:!0,message:r,color:"error"}}}return U(()=>{A()}),(i,t)=>(m(),x("div",null,[c("div",oe,[$(i.$slots,"heading",{},()=>[c("h3",ie,v(b.title),1)],!0),$(i.$slots,"subtitle",{},()=>[t[2]||(t[2]=c("p",{class:"mb-0"},[h(" تتضمن جميع الباقات أكثر من عدد طلاب. "),c("br"),h(" اختر الباقة الأنسب لاحتياجاتك. ")],-1))],!0)]),S.value?(m(),x("div",le,[o(W,{indeterminate:"",color:"primary",size:"64"}),t[3]||(t[3]=c("p",{class:"mt-4 text-body-1"},"جاري تحميل الباقات...",-1))])):_.value.length>0?(m(),I(Z,{key:1},{default:a(()=>[(m(!0),x(D,null,E(_.value,e=>(m(),I(Y,{key:e.id,cols:b.cols,sm:b.sm,md:b.md,lg:b.lg,xl:b.xl},{default:a(()=>[o(Q,{flat:"",border:"",class:G([e.isPopular?"border-primary border-opacity-100":"","h-100"])},{default:a(()=>[o(w,{class:"text-end pt-4",style:{"block-size":"3.75rem"}},{default:a(()=>[H(o(ee,{color:"primary",size:"small"},{default:a(()=>t[4]||(t[4]=[h(" الأكثر شعبية ")])),_:2},1536),[[K,e.isPopular]])]),_:2},1024),o(w,{class:"text-center"},{default:a(()=>[o(N,{icon:e.monthlyPrice===0?"mdi-gift":"mdi-star",color:e.monthlyPrice===0?"success":"primary",size:"80",class:"mb-5"},null,8,["icon","color"]),c("h4",ne,v(e.name),1),c("p",ce,v(e.tagLine),1)]),_:2},1024),o(w,{class:"position-relative text-center"},{default:a(()=>[c("div",null,[c("div",de,[c("h1",ue,v(e.monthlyPrice===0?"مجاناً":new Intl.NumberFormat("en-IQ").format(e.monthlyPrice)),1),e.monthlyPrice!==0?(m(),x("span",me," دينار/شهر ")):T("",!0)]),e.monthlyPrice!==0?(m(),x("div",fe,v(new Intl.NumberFormat("en-IQ").format(e.yearlyPrice))+" دينار/سنة ",1)):T("",!0)])]),_:2},1024),o(w,{class:"pt-2"},{default:a(()=>[o(te,{class:"card-list pb-5"},{default:a(()=>[(m(!0),x(D,null,E(e.features,(d,u)=>(m(),I(se,{key:u},{prepend:a(()=>[o(N,{size:14,icon:"mdi-check-circle",color:"success",class:"me-2"})]),default:a(()=>[o(ae,{class:"text-body-1"},{default:a(()=>[h(v(d),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),o(F,{block:"",color:e.current?"success":"primary",variant:e.isPopular?"elevated":"outlined",size:"large",onClick:d=>q(e)},{default:a(()=>[h(v(e.current?"باقتك الحالية":e.monthlyPrice===0?"ابدأ مجاناً":"اشترك الآن"),1)]),_:2},1032,["color","variant","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1032,["cols","sm","md","lg","xl"]))),128))]),_:1})):(m(),I(Q,{key:2,flat:"",border:"",class:"text-center py-10"},{default:a(()=>[o(w,null,{default:a(()=>[o(N,{icon:"mdi-package-variant",size:"64",color:"grey",class:"mb-4"}),t[6]||(t[6]=c("h4",{class:"text-h5 mb-2"},"لا توجد باقات متاحة",-1)),t[7]||(t[7]=c("p",{class:"text-body-2 text-medium-emphasis"}," لم يتم العثور على أي باقات في الوقت الحالي ",-1)),o(F,{color:"primary",variant:"outlined",class:"mt-4",onClick:A},{default:a(()=>t[5]||(t[5]=[h(" إعادة المحاولة ")])),_:1})]),_:1})]),_:1})),o(re,{modelValue:y.value.show,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value.show=e),color:y.value.color,location:"top",timeout:5e3},{actions:a(()=>[o(F,{variant:"text",onClick:t[0]||(t[0]=e=>y.value.show=!1)},{default:a(()=>t[8]||(t[8]=[h(" إغلاق ")])),_:1})]),default:a(()=>[h(v(y.value.message)+" ",1)]),_:1},8,["modelValue","color"])]))}},we=X(ye,[["__scopeId","data-v-e9900680"]]);export{we as _};
