import{_ as J}from"./BaseAlert-DMDZYgBb.js";import{_ as z}from"./ConfirmDangerDialog-DiOiWQFz.js";import{a as h}from"./admin_api-uHzwahkJ.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as D,a as V,b as T,c as A}from"./VCard-DkKUq9Xw.js";import{f as y,o as c,e as a,b as l,d as v,p as g,a_ as p,V as C,v as b,s as m,c as Y,n as k,t as j}from"./index-DzRnBGoW.js";import{V as x}from"./VDivider-DOU2dJa1.js";import{V as F}from"./VCardText-DxpVkpnf.js";import{V as U}from"./VContainer-DDIA6_I2.js";import{V as B}from"./VForm-Bv_PGfyt.js";import{V as S,a as u}from"./VRow-1sXKMjVm.js";import{V as O}from"./VTextarea-DEXJEkcd.js";import{V as N}from"./VDialog-B-d6xDxs.js";import{_ as L}from"./SmartTable-DRD1z7i0.js";import{_ as M}from"./AppBreadcrumbs-5PWjj0AR.js";import{n as W}from"./number-DRUmGIrN.js";import{V as w}from"./VSelect-DPU1_UF_.js";import{V as R}from"./VChip-BxDWJl9X.js";import"./axios-CwDcW8lj.js";import"./VAvatar-gDhFptrY.js";import"./VImg-DAcp9xse.js";import"./VDataTable-DKHI-dYN.js";import"./VPagination-DPnje41R.js";import"./VTable-CGzAcL7O.js";import"./filter-BD0O1YfX.js";import"./VTooltip-CZZ_rwxI.js";import"./VList-C_vO-TC7.js";const G={name:"AddStudyYearDialog",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,required:!0}},emits:["update:modelValue","close","dataAdded","error","showAlert"],data(){return{loading:!1,isDragOver:!1,formData:{name:null,description:null,maxStudents:null,price:null,durationDays:null,isFree:!1}}},created(){this.formData=this.data},computed:{dialog:{get(){return this.modelValue},set(s){this.$emit("update:modelValue",s)}},rules(){return{required:[s=>!!s||"هذا الحقل مطلوب"]}}},watch:{modelValue(s){s&&this.resetForm()}},methods:{resetForm(){this.formData={id:null,name:null,description:null,maxStudents:null,price:null,durationDays:null,isFree:!1},this.isDragOver=!1},closeDialog(){this.resetForm(),this.$emit("close")},async saveNote(){var e,d,r;const{valid:s}=await this.$refs.noteForm.validate();if(s){this.loading=!0;try{const t={name:this.formData.name,description:this.formData.description,maxStudents:this.formData.maxStudents,price:this.formData.price,durationDays:this.formData.durationDays,isFree:this.formData.isFree},o=await h.editSubscriptionPackage(this.formData.id,t);this.$emit("showAlert","success",o.data.message||"تم تعديل الباقة بنجاح"),this.$emit("dataAdded",o.data.message),this.closeDialog()}catch(t){let o="حدث خطأ أثناء تعديل الباقة";((e=t.response)==null?void 0:e.status)===401?o="غير مصرح لك بالعملية":(r=(d=t.response)==null?void 0:d.data)!=null&&r.message&&(o=t.response.data.message),this.$emit("showAlert","error",o)}finally{this.loading=!1}}}}};function H(s,e,d,r,t,o){return c(),y(N,{modelValue:o.dialog,"onUpdate:modelValue":e[5]||(e[5]=i=>o.dialog=i),"max-width":"900px"},{default:a(()=>[l(D,null,{default:a(()=>[l(V,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[l(g,{icon:"ri-add-line",color:"primary",class:"me-2",size:"24"}),e[6]||(e[6]=v("h3",{class:"text-h5 font-weight-bold"},"إضافة",-1))]),_:1}),l(x),l(F,null,{default:a(()=>[l(U,null,{default:a(()=>[l(B,{ref:"noteForm"},{default:a(()=>[l(S,null,{default:a(()=>[l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.formData.name=i),rules:o.rules.required,label:"اسم الباقة",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.maxStudents,"onUpdate:modelValue":e[1]||(e[1]=i=>t.formData.maxStudents=i),rules:o.rules.required,label:"عدد الطلاب",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.price,"onUpdate:modelValue":e[2]||(e[2]=i=>t.formData.price=i),rules:o.rules.required,label:"المبلغ",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.durationDays,"onUpdate:modelValue":e[3]||(e[3]=i=>t.formData.durationDays=i),rules:o.rules.required,label:"عدد الأيام",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"12"},{default:a(()=>[l(O,{modelValue:t.formData.description,"onUpdate:modelValue":e[4]||(e[4]=i=>t.formData.description=i),rules:o.rules.required,label:"وصف الباقة",outlined:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),l(T,{class:"px-6 pb-4"},{default:a(()=>[l(C),l(b,{color:"grey",variant:"outlined",onClick:o.closeDialog,disabled:t.loading},{default:a(()=>[l(g,{start:""},{default:a(()=>e[7]||(e[7]=[m("ri-close-line")])),_:1}),e[8]||(e[8]=m(" الغاء "))]),_:1},8,["onClick","disabled"]),l(b,{color:"primary",loading:t.loading,onClick:o.saveNote,variant:"elevated"},{default:a(()=>[l(g,{start:""},{default:a(()=>e[9]||(e[9]=[m("ri-save-line")])),_:1}),e[10]||(e[10]=m(" حفظ "))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const K=_(G,[["render",H],["__scopeId","data-v-450c2a39"]]),Q={name:"AddStudyYearDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","close","dataAdded","error","showAlert"],data(){return{loading:!1,isDragOver:!1,formData:{name:null,description:null,maxStudents:null,price:null,durationDays:null,isFree:!1}}},computed:{dialog:{get(){return this.modelValue},set(s){this.$emit("update:modelValue",s)}},rules(){return{required:[s=>!!s||"هذا الحقل مطلوب"]}}},watch:{modelValue(s){s&&this.resetForm()}},methods:{resetForm(){this.formData={name:null,description:null,maxStudents:null,price:null,durationDays:null,isFree:!1},this.isDragOver=!1},closeDialog(){this.resetForm(),this.$emit("close")},async saveNote(){var e,d,r;const{valid:s}=await this.$refs.noteForm.validate();if(s){this.loading=!0;try{const t={name:this.formData.name,description:this.formData.description,maxStudents:this.formData.maxStudents,price:this.formData.price,durationDays:this.formData.durationDays,isFree:this.formData.isFree},o=await h.createSubscriptionPackage(t);this.$emit("showAlert","success",o.data.message||"تم إضافة الباقة بنجاح"),this.$emit("dataAdded",o.data.message),this.closeDialog()}catch(t){let o="حدث خطأ أثناء إضافة الباقة";((e=t.response)==null?void 0:e.status)===401?o="غير مصرح لك بالعملية":(r=(d=t.response)==null?void 0:d.data)!=null&&r.message&&(o=t.response.data.message),this.$emit("showAlert","error",o)}finally{this.loading=!1}}}}};function X(s,e,d,r,t,o){return c(),y(N,{modelValue:o.dialog,"onUpdate:modelValue":e[5]||(e[5]=i=>o.dialog=i),"max-width":"900px"},{default:a(()=>[l(D,null,{default:a(()=>[l(V,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[l(g,{icon:"ri-add-line",color:"primary",class:"me-2",size:"24"}),e[6]||(e[6]=v("h3",{class:"text-h5 font-weight-bold"},"إضافة",-1))]),_:1}),l(x),l(F,null,{default:a(()=>[l(U,null,{default:a(()=>[l(B,{ref:"noteForm"},{default:a(()=>[l(S,null,{default:a(()=>[l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.formData.name=i),rules:o.rules.required,label:"اسم الباقة",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.maxStudents,"onUpdate:modelValue":e[1]||(e[1]=i=>t.formData.maxStudents=i),rules:o.rules.required,label:"عدد الطلاب",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.price,"onUpdate:modelValue":e[2]||(e[2]=i=>t.formData.price=i),rules:o.rules.required,label:"المبلغ",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[l(p,{modelValue:t.formData.durationDays,"onUpdate:modelValue":e[3]||(e[3]=i=>t.formData.durationDays=i),rules:o.rules.required,label:"عدد الأيام",outlined:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"12"},{default:a(()=>[l(O,{modelValue:t.formData.description,"onUpdate:modelValue":e[4]||(e[4]=i=>t.formData.description=i),rules:o.rules.required,label:"وصف الباقة",outlined:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),l(T,{class:"px-6 pb-4"},{default:a(()=>[l(C),l(b,{color:"grey",variant:"outlined",onClick:o.closeDialog,disabled:t.loading},{default:a(()=>[l(g,{start:""},{default:a(()=>e[7]||(e[7]=[m("ri-close-line")])),_:1}),e[8]||(e[8]=m(" الغاء "))]),_:1},8,["onClick","disabled"]),l(b,{color:"primary",loading:t.loading,onClick:o.saveNote,variant:"elevated"},{default:a(()=>[l(g,{start:""},{default:a(()=>e[9]||(e[9]=[m("ri-save-line")])),_:1}),e[10]||(e[10]=m(" حفظ "))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Z=_(Q,[["render",X],["__scopeId","data-v-1c0ce677"]]),$={data(){return{keyName:"show-getSubscriptionPackage",results:JSON.parse(localStorage.getItem("user")),breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"باقات الاشتراك",disabled:!0}],loading:!1,progress:0,table:{totalItems:0,Data:[],actions:["اعادة تفعيل","تعديل","ايقاف"],loading:!1,headers:[{title:"#",type:"strong",sortable:!0,key:"num"},{title:"اسم الباقة",type:"link",sortable:!0,key:"name"},{title:"مبلغ الباقة",type:"number",sortable:!0,key:"price"},{title:"عدد الطلاب المسموح به",type:"number",sortable:!0,key:"maxStudents"},{title:"عدد الايام المسموح به",type:"number",sortable:!0,key:"durationDays"},{title:"مجانية؟",type:"strong",sortable:!0,key:"isFree"},{title:"التفاصيل",type:"strong",sortable:!0,key:"description"},{title:"الحالة",type:"strong",sortable:!0,key:"isActive"},{title:"العمليات",type:"strong",sortable:!0,key:"actions"}],tableSettings:{options:{page:1,limit:10,scroll:0,sortBy:"",search:null,isActive:null,isFree:null,deleted:null,sort:'{"key":"createdAt","order":"desc"}'}}},gradeLevelAll:[],courseIsDisabled:[{text:"الكل",value:null},{text:"مفعل",value:!0},{text:"معطل",value:!1}],isFreeOptions:[{text:"الكل",value:null},{text:"مجانية",value:!0},{text:"مدفوعة",value:!1}],deletedOptions:[{text:"الكل",value:null},{text:"محذوفة",value:!0},{text:"مفعلة",value:!1}],Actions:{open:!1,data:null},editSubscriptionPackages:{open:!1,data:null},enableDialog:{open:!1,data:null,messages:[],title:null,confirmButtonText:null},deactivateDialog:{open:!1,data:null,messages:[],title:null,confirmButtonText:null},alert:{open:!1,message:null,type:"success"}}},created(){const s=JSON.parse(localStorage.getItem(this.keyName));this.table.tableSettings=s||this.table.tableSettings,this.tempScrollTop=(s==null?void 0:s.scrollTop)||0},mounted(){window.addEventListener("scroll",this.handleScroll),this.$watch(()=>this.table.Data,s=>{(s==null?void 0:s.length)>0&&this.tempScrollTop&&setTimeout(()=>{window.scrollTo({top:this.tempScrollTop,behavior:"smooth"}),this.tempScrollTop=0},300)},{deep:!0})},beforeUnmount(){var s;(s=this.unwatch)==null||s.call(this),window.removeEventListener("scroll",this.handleScroll)},methods:{numberWithComma:W,handleDataAdded(s){this.getDataAxios(),this.showAlert("success",s)},handleScroll(){const s=window.scrollY||window.pageYOffset,e=JSON.parse(localStorage.getItem(this.keyName))||{};e.scrollTop=s,localStorage.setItem(this.keyName,JSON.stringify(e))},reload(){localStorage.removeItem(this.keyName),this.table.tableSettings.options={page:1,limit:10,scroll:0,sortBy:"",search:null,isActive:null,isFree:null,deleted:null,sort:JSON.stringify({key:"createdAt",order:"desc"})},this.getDataAxios()},updateTableOptions(s){this.table.tableSettings.options={...this.table.tableSettings.options,...s,search:s.search?s.search:null},this.getDataAxios()},async getDataAxios(){var e,d,r;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const{sortBy:t=[],sortDesc:o=[]}=this.table.tableSettings.options,i={key:Array.isArray(t)&&t[0]?t[0]:"createdAt",order:(Array.isArray(o)&&o[0],"desc")};this.table.tableSettings.options.sort=JSON.stringify(i),localStorage.setItem(this.keyName,JSON.stringify(this.table.tableSettings));const f=await h.getSubscriptionPackage(this.table.tableSettings);if((e=f.data)!=null&&e.error)return this.showAlert("error",f.data.message||"حدث خطأ أثناء جلب البيانات");this.table.Data=f.data.data,this.table.totalItems=f.data.data.length}catch(t){this.showAlert("error",((r=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:r.message)||"حدث خطأ أثناء جلب البيانات")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0},500)}},editItem(s){this.editSubscriptionPackages.data=s,this.editSubscriptionPackages.open=!0},enableItem(s){this.enableDialog.data=s,this.enableDialog.messages=["سيتم تفعيل الباقة","لا يمكنك التراجع بعد التفعيل"],this.enableDialog.title="تأكيد التفعيل",this.enableDialog.confirmButtonText="تفعيل",this.enableDialog.open=!0},async handleEnable(){var e,d;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const r=await h.activateSubscriptionPackage(this.enableDialog.data.id);this.showAlert("success",r.data.message||"تم التفعيل بنجاح"),this.getDataAxios()}catch(r){this.showAlert("error",((d=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:d.message)||"حدث خطأ أثناء عملية التفعيل")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.enableDialog.open=!1},500)}},deactivateItem(s){this.deactivateDialog.data=s,this.deactivateDialog.messages=["سيتم ايقاف الباقة","لا يمكنك التراجع بعد ايقاف"],this.deactivateDialog.title="تأكيد ايقاف",this.deactivateDialog.confirmButtonText="ايقاف",this.deactivateDialog.open=!0},async handleDeactivate(){var e,d;this.progress=0,this.loading=!0;const s=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const r=await h.deactivateSubscriptionPackage(this.deactivateDialog.data.id);this.showAlert("success",r.data.message||"تم ايقاف بنجاح"),this.getDataAxios()}catch(r){this.showAlert("error",((d=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:d.message)||"حدث خطأ أثناء عملية ايقاف")}finally{clearInterval(s),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.deactivateDialog.open=!1},500)}},showAlert(s,e){Object.assign(this.alert,{type:s,message:e,open:!0})}}};function ee(s,e,d,r,t,o){const i=M,f=L,P=Z,q=K,I=z,E=J;return c(),Y("div",null,[l(i,{items:t.breadcrumbItems},null,8,["items"]),l(D,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:a(()=>[l(V,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[l(g,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),e[13]||(e[13]=v("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),l(x),l(A,null,{default:a(()=>[l(S,{class:"align-center justify-start pa-2"},{default:a(()=>[l(b,{color:"primary",class:"ma-2","prepend-icon":"ri-add-line",rounded:"pill",elevation:"2",size:"default",onClick:e[0]||(e[0]=n=>t.Actions.open=!0)},{default:a(()=>e[14]||(e[14]=[m(" إضافة باقة اشتراك جديدة ")])),_:1})]),_:1})]),_:1})]),_:1}),l(D,{class:"my-4 filter-card",elevation:"3",rounded:"lg"},{default:a(()=>[l(V,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[l(g,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),e[15]||(e[15]=v("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),l(x),l(A,null,{default:a(()=>[l(S,{style:{"padding-block":"10px"}},{default:a(()=>[l(u,{cols:"12",md:"4"},{default:a(()=>[l(w,{modelValue:t.table.tableSettings.options.isActive,"onUpdate:modelValue":[e[1]||(e[1]=n=>t.table.tableSettings.options.isActive=n),o.getDataAxios],items:t.courseIsDisabled,"item-title":"text","item-value":"value",label:"حالة السنة",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:a(()=>[l(w,{modelValue:t.table.tableSettings.options.isFree,"onUpdate:modelValue":[e[2]||(e[2]=n=>t.table.tableSettings.options.isFree=n),o.getDataAxios],items:t.isFreeOptions,"item-title":"text","item-value":"value",label:"نوع الباقة",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:a(()=>[l(w,{modelValue:t.table.tableSettings.options.deleted,"onUpdate:modelValue":[e[3]||(e[3]=n=>t.table.tableSettings.options.deleted=n),o.getDataAxios],items:t.deletedOptions,"item-title":"text","item-value":"value",label:"حالة الباقة",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{class:"my-4 data-table-card",elevation:"3",rounded:"lg"},{default:a(()=>[l(V,{class:"py-4 px-6"},{default:a(()=>[l(S,{class:"align-center"},{default:a(()=>[l(u,{cols:"auto"},{default:a(()=>[l(b,{color:"primary",onClick:e[4]||(e[4]=n=>o.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small",class:"rotate-on-hover"})]),_:1}),l(u,null,{default:a(()=>e[16]||(e[16]=[v("h3",{class:"text-h5 font-weight-bold text-center"},"باقات الاشتراك",-1)])),_:1}),l(u,{cols:"auto"},{default:a(()=>[l(R,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:a(()=>[m(j(o.numberWithComma(t.table.totalItems))+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),l(x),l(A,null,{default:a(()=>[l(f,{headers:t.table.headers,items:t.table.Data,actions:t.table.actions,loading:t.table.loading,totalItems:t.table.totalItems,tableOptions:t.table.tableSettings.options,onUpdateTableOptions:o.updateTableOptions,onEnableItem:o.enableItem,onEditItem:o.editItem,onDeactivateItem:o.deactivateItem,class:"reservation-table"},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onEnableItem","onEditItem","onDeactivateItem"])]),_:1})]),_:1}),t.Actions.open?(c(),y(P,{key:0,modelValue:t.Actions.open,"onUpdate:modelValue":e[5]||(e[5]=n=>t.Actions.open=n),onClose:e[6]||(e[6]=n=>t.Actions.open=!1),onDataAdded:o.handleDataAdded,onShowAlert:o.showAlert},null,8,["modelValue","onDataAdded","onShowAlert"])):k("",!0),t.editSubscriptionPackages.open?(c(),y(q,{key:1,modelValue:t.editSubscriptionPackages.open,"onUpdate:modelValue":e[7]||(e[7]=n=>t.editSubscriptionPackages.open=n),data:t.editSubscriptionPackages.data,onClose:e[8]||(e[8]=n=>t.editSubscriptionPackages.open=!1),onDataAdded:o.handleDataAdded,onShowAlert:o.showAlert},null,8,["modelValue","data","onDataAdded","onShowAlert"])):k("",!0),l(I,{modelValue:t.enableDialog.open,"onUpdate:modelValue":e[9]||(e[9]=n=>t.enableDialog.open=n),messages:t.enableDialog.messages,title:t.enableDialog.title,confirmButtonText:t.enableDialog.confirmButtonText,onConfirm:o.handleEnable},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"]),l(I,{modelValue:t.deactivateDialog.open,"onUpdate:modelValue":e[10]||(e[10]=n=>t.deactivateDialog.open=n),messages:t.deactivateDialog.messages,title:t.deactivateDialog.title,confirmButtonText:t.deactivateDialog.confirmButtonText,onConfirm:o.handleDeactivate},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"]),t.alert.open?(c(),y(E,{key:2,modelValue:t.alert.open,"onUpdate:modelValue":e[11]||(e[11]=n=>t.alert.open=n),type:t.alert.type,message:t.alert.message,closable:!0,"close-text":"موافق",onClose:e[12]||(e[12]=n=>t.alert.open=!1)},null,8,["modelValue","type","message"])):k("",!0)])}const Ie=_($,[["render",ee]]);export{Ie as default};
