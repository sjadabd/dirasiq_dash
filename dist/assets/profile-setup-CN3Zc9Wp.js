const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-DKrzrpRK.js","assets/_commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{r as y,m as Xe,M as He,f as R,o as S,e as l,d as i,b as t,p as D,s as c,a_ as ye,cl as Ze,v as te,n as q,be as et,b6 as Je,t as F,L as We,Y as tt,z as X,w as he,c as re,aZ as me,F as De,x as lt,W as Le,at,az as Ie,ab as ot,ac as nt,ak as st,am as _e,ap as Ne,b0 as it,bt as rt,ch as ut,ad as dt,y as ke,bf as ct,b4 as vt,bg as mt,ci as ft,ce as Ge,bK as pt,ct as gt,q as yt,ck as ht,as as bt,cj as xt}from"./index-29qi_UQ_.js";import{_ as Ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ne,a as Me}from"./VCard-CuxbDPG0.js";import Te from"./teacher_api-BOlvZjR_.js";import{V as ue}from"./VCardText-BeUkytjM.js";import{V as Ue}from"./VAvatar-DvEORS4j.js";import{V as wt}from"./VImg-C7IBKxMt.js";import{V as ze}from"./VChip-DINik-E3.js";import{V as kt}from"./VDialog-CmixzWYu.js";import{V as Pe,a as H}from"./VRow-CEbwTv1E.js";import{_ as Vt}from"./AppDateTimePicker-Da6vmnPO.js";import{V as _t}from"./VContainer-B_61HfoY.js";import{V as Dt}from"./VForm-BZMeM-n_.js";import{V as St}from"./VFileInput-B1Hh7orF.js";import{u as Lt,d as Ct,e as zt,a as Pt,V as It}from"./VSelect-DpGux4zn.js";import{V as Mt}from"./VTextarea-B5B_aFAz.js";import{u as Tt,m as Ut}from"./filter-BF9Hz_O8.js";import{e as Ft,V as At,a as Ke}from"./VList-gNfvHVTv.js";import"./axios-BG8wWk5D.js";import"./VDivider-CFfaHbXO.js";const Rt={class:"d-flex align-center mb-4"},Et={class:"d-flex gap-2 mb-4"},Ot={class:"position-relative"},Bt={class:"text-center"},jt={class:"mt-4 text-body-2 text-medium-emphasis"},qt={__name:"MapPicker",props:{initialLat:{type:Number,default:31.2001},initialLng:{type:Number,default:29.9187}},emits:["locationUpdate"],setup(a,{emit:o}){const r=a,f=o,n=y(null),x=y(null),M=y(null),Y=y(""),O=y(!0),v=y({latitude:r.initialLat,longitude:r.initialLng}),T=(z,p)=>{v.value={latitude:parseFloat(z.toFixed(6)),longitude:parseFloat(p.toFixed(6))},f("locationUpdate",v.value)},w=async()=>{if(Y.value.trim())try{const p=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(Y.value)}&limit=1`)).json();if(p.length>0&&x.value&&M.value){const P=parseFloat(p[0].lat),B=parseFloat(p[0].lon);x.value.setView([P,B],15),M.value.setLatLng([P,B]),T(P,B)}}catch(z){console.error("Search error:",z)}},_=()=>{if(!navigator.geolocation){alert("المتصفح لا يدعم تحديد الموقع.");return}navigator.geolocation.getCurrentPosition(z=>{const{latitude:p,longitude:P}=z.coords;x.value&&M.value&&(x.value.setView([p,P],15),M.value.setLatLng([p,P]),T(p,P))},z=>{console.error("Geolocation error:",z),alert("تعذّر الحصول على موقعك الحالي.")},{enableHighAccuracy:!0})};return Xe(async()=>{if(!(typeof window>"u"))try{const z=(await We(async()=>{const{default:P}=await import("./leaflet-src-DKrzrpRK.js").then(B=>B.l);return{default:P}},__vite__mapDeps([0,1]))).default,p=document.createElement("link");if(p.rel="stylesheet",p.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(p),n.value&&!x.value){const P=z.map(n.value,{attributionControl:!1}).setView([r.initialLat,r.initialLng],13);z.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(P);const B=z.divIcon({html:`<div class="bg-primary text-white rounded-circle pa-2 elevation-4" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                 <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                   <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                 </svg>
               </div>`,className:"custom-marker",iconSize:[40,40],iconAnchor:[20,40]}),le=z.marker([r.initialLat,r.initialLng],{draggable:!0,icon:B}).addTo(P);le.on("moveend",Z=>{const{lat:C,lng:m}=Z.target.getLatLng();T(C,m)}),P.on("click",Z=>{const{lat:C,lng:m}=Z.latlng;le.setLatLng([C,m]),T(C,m)}),x.value=P,M.value=le,O.value=!1}}catch(z){console.error("Error loading map:",z),O.value=!1}}),He(()=>{x.value&&x.value.remove()}),(z,p)=>(S(),R(ne,{class:"pa-4"},{default:l(()=>[i("div",Rt,[t(D,{color:"primary",class:"me-2"},{default:l(()=>p[1]||(p[1]=[c("mdi-map-marker")])),_:1}),p[2]||(p[2]=i("span",{class:"text-h6"},"تحديد الموقع",-1))]),p[5]||(p[5]=i("div",{class:"text-body-2 text-medium-emphasis mb-4"}," يرجى تحديد موقعك بدقة والموافقة على صلاحيات الموقع في متصفحك. سيتم استخدام موقعك لإرسال إشعارات للطلاب القريبين منك، ولاقتراح الدروس والخدمات لجميع الطلاب بناءً على موقعك الجغرافي. ",-1)),i("div",Et,[t(ye,{modelValue:Y.value,"onUpdate:modelValue":p[0]||(p[0]=P=>Y.value=P),placeholder:"ابحث عن موقع...",variant:"outlined",density:"compact",onKeyup:Ze(w,["enter"]),class:"flex-grow-1"},null,8,["modelValue"]),t(te,{onClick:w,icon:"mdi-magnify",variant:"outlined",size:"small"}),t(te,{onClick:_,icon:"mdi-crosshairs-gps",variant:"outlined",size:"small",color:"primary",title:"تحديد موقعي الحالي"})]),i("div",Ot,[i("div",{ref_key:"mapContainer",ref:n,class:"map-container"},null,512),O.value?(S(),R(et,{key:0,contained:"",class:"d-flex align-center justify-center"},{default:l(()=>[i("div",Bt,[t(Je,{indeterminate:"",color:"primary",class:"mb-2"}),p[3]||(p[3]=i("div",{class:"text-body-2"},"جاري تحميل الخريطة...",-1))])]),_:1})):q("",!0)]),i("div",jt,[i("div",null,"خط العرض: "+F(v.value.latitude),1),i("div",null,"خط الطول: "+F(v.value.longitude),1),p[4]||(p[4]=i("div",{class:"text-caption mt-1"}," يمكنك سحب العلامة أو النقر على الخريطة لتحديد الموقع ",-1))])]),_:1}))}},Nt=Ye(qt,[["__scopeId","data-v-a3b58e2e"]]),Wt={key:0,class:"d-flex align-center justify-space-between mb-4"},Yt={class:"d-flex align-center gap-3"},Gt={class:"d-flex align-center gap-2"},Kt={class:"text-caption text-medium-emphasis mt-1"},Xt={class:"d-flex gap-2"},Ht={class:"video-container rounded-lg overflow-hidden bg-black"},Jt=["poster"],$t={key:1,class:"text-center py-12"},Qt={class:"text-caption text-medium-emphasis mt-2"},Zt={key:2,class:"d-flex flex-column gap-4"},el={class:"video-container rounded-lg overflow-hidden bg-black"},tl=["src"],ll={class:"text-h4 font-weight-bold"},al={class:"text-h4 font-weight-bold",style:{color:"white"}},ol={class:"text-h4 font-weight-bold"},nl={class:"d-flex align-center gap-2 mb-3"},sl={class:"d-flex align-start gap-2"},il={class:"text-caption",style:{"list-style-position":"inside"}},rl={class:"d-flex h-100"},ul=["src","alt"],dl={style:{position:"absolute",inset:"0","pointer-events":"none"}},cl={style:{position:"absolute",display:"flex","align-items":"center","justify-content":"center",border:"2px solid white","border-radius":"50%",background:"#2196f3","block-size":"28px","box-shadow":"0 2px 8px rgba(0, 0, 0, 30%)","inline-size":"28px"}},vl={class:"middle-hover",style:{position:"absolute",display:"flex","align-items":"center","justify-content":"center",inset:"0",opacity:"0",transition:"opacity 0.2s"}},ml={style:{padding:"8px","border-radius":"50%",background:"rgba(33, 150, 243, 90%)","box-shadow":"0 2px 8px rgba(0, 0, 0, 30%)"}},fl={style:{position:"absolute",display:"flex","justify-content":"space-between","inset-block-start":"-28px","inset-inline":"0","padding-block":"0","padding-inline":"8px","pointer-events":"none"}},pl={class:"px-2 py-1 rounded text-caption font-weight-bold",style:{background:"#2196f3","box-shadow":"0 2px 4px rgba(0, 0, 0, 20%)",color:"white"}},gl={class:"px-2 py-1 rounded text-caption font-weight-bold",style:{background:"#2196f3","box-shadow":"0 2px 4px rgba(0, 0, 0, 20%)",color:"white"}},yl={style:{position:"absolute",display:"flex","align-items":"center","justify-content":"center",border:"2px solid white","border-radius":"50%",background:"#2196f3","block-size":"28px","box-shadow":"0 2px 8px rgba(0, 0, 0, 30%)","inline-size":"28px"}},hl={class:"d-flex align-center justify-space-between mt-4"},bl={class:"d-flex align-center gap-2"},xl={class:"text-body-2 font-weight-medium"},wl={key:0,class:"text-caption font-weight-medium",style:{color:"#f57c00"}},kl={key:0,class:"text-caption text-medium-emphasis"},Vl={class:"d-flex gap-2 mt-4"},_l={class:"d-flex gap-2",style:{"flex-direction":"column"}},Dl={class:"d-flex align-center gap-3"},Sl={class:"flex-grow-1"},Ll={class:"font-weight-medium mb-1"},Ce=!0,ve=128*1024*1024,Cl=tt({__name:"VideoUploadEditor",props:{maxDuration:{default:120},minDuration:{default:1},numberOfFrames:{default:10}},setup(a){const o=a,r=y(null),f=y(null),n=y(null),x=y(null),M=y(""),Y=y(0);let O=null;const v=y(0),T=y(0),w=y(0),_=y(!1),fe=y(0),z=y(!1),p=y(""),P=y(!1),B=y(!1),le=y(""),Z=y(!1),C=y([]),m=y(0),G=y(0),N=y(0),de=y(!1),ce=y(null),J=y(0),ee=y(0),$=y(0),K=y(null),be=y(null),pe=y(null),se=y(null),xe=X(()=>w.value-T.value),Fe=X(()=>r.value?ae(r.value.size*(xe.value/v.value)):"0 MB"),Ae=X(()=>{const s=f.value||"";return!!r.value||s.startsWith("data:")}),Re=()=>B.value?le.value:_.value?`جاري الرفع... ${fe.value}%`:"رفع الفيديو",Q=s=>{if(!s||isNaN(s))return"00:00";const e=Math.floor(s/60),d=Math.floor(s%60);return`${e.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`},ae=s=>{if(s===0)return"0 Bytes";const e=1024,d=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,b)*100)/100+" "+d[b]},Ee=s=>{var b;const d=(b=s.target.files)==null?void 0:b[0];if(d){if(!d.type.startsWith("video/")){p.value="يرجى اختيار ملف فيديو صالح";return}r.value=d,f.value=URL.createObjectURL(d),p.value="",z.value=!1,r.value.size>ve&&(p.value=`حجم الفيديو ${ae(r.value.size)} أكبر من الحد المسموح ${ae(ve)}، يرجى اختيار فيديو آخر أصغر.`)}},Se=()=>{se.value&&se.value.click()},Oe=async()=>{const s=K.value;if(!s||!pe.value)return;const d=pe.value.offsetWidth;m.value=d;const b=Math.floor(d/o.numberOfFrames),g=document.createElement("canvas"),k=g.getContext("2d");if(!k)return;const L=s.videoHeight/s.videoWidth;g.width=b,g.height=b*L;const ge=[];for(let ie=0;ie<o.numberOfFrames;ie++){const we=ie/(o.numberOfFrames-1)*v.value;await new Promise(Qe=>{s.currentTime=we,s.onseeked=()=>{k.drawImage(s,0,0,g.width,g.height),ge.push(g.toDataURL("image/jpeg",.7)),Qe()}})}C.value=ge,s.currentTime=T.value},Be=()=>{if(!m.value||!v.value)return;const s=T.value/v.value,e=w.value/v.value;G.value=s*m.value,N.value=(e-s)*m.value},je=()=>{if(!m.value||!v.value)return;const s=G.value/m.value,e=(G.value+N.value)/m.value,d=Math.max(0,s*v.value);let b=Math.min(v.value,e*v.value);b-d<o.minDuration&&(b=Math.min(v.value,d+o.minDuration)),T.value=d,w.value=b},qe=async()=>{const s=K.value;if(!s)return;const e=s.duration;v.value=e,e>o.maxDuration?(T.value=0,w.value=o.maxDuration,P.value=!0):(T.value=0,w.value=e,P.value=!1),await Ie(),setTimeout(()=>{Oe()},100)},Ve=s=>{const e=s.target;e.currentTime>=w.value&&(e.pause(),e.currentTime=T.value)},W=(s,e)=>{e.preventDefault(),de.value=!0,ce.value=s,J.value="touches"in e?e.touches[0].clientX:e.clientX,ee.value=G.value,$.value=N.value},u=s=>{if(!de.value||!ce.value)return;s.preventDefault();const d=("touches"in s?s.touches[0].clientX:s.clientX)-J.value,b=o.minDuration/v.value*m.value,g=o.maxDuration/v.value*m.value;if(ce.value==="left"){let k=ee.value+d,L=$.value-d;k=Math.max(0,k),k=Math.min(k,ee.value+$.value-b),L=ee.value+$.value-k,L>g&&(L=g,k=ee.value+$.value-g),G.value=k,N.value=L}else if(ce.value==="right"){let k=$.value+d;k=Math.max(b,k),k=Math.min(k,m.value-G.value),k>g&&(k=g),N.value=k}else if(ce.value==="middle"){let k=ee.value+d;k=Math.max(0,k),k=Math.min(k,m.value-N.value),G.value=k}},h=()=>{de.value&&(de.value=!1,ce.value=null,je(),K.value&&(K.value.currentTime=T.value))},U=()=>{T.value=0,v.value>o.maxDuration?(w.value=o.maxDuration,P.value=!0):(w.value=v.value,P.value=!1),K.value&&(K.value.currentTime=0)},V=()=>{K.value&&(K.value.currentTime=T.value,K.value.play())},I=()=>{r.value&&f.value&&f.value.startsWith("blob:")&&URL.revokeObjectURL(f.value),r.value=null,f.value=n.value,v.value=0,T.value=0,w.value=0,C.value=[],p.value="",z.value=!1,se.value&&(se.value.value="")},j=async()=>{var s,e,d,b,g,k;if(r.value){_.value=!1,fe.value=0,p.value="",z.value=!1;try{if(r.value.size>ve){p.value=`حجم الفيديو ${ae(r.value.size)} أكبر من الحد المسموح ${ae(ve)}، يرجى اختيار فيديو آخر أصغر.`;return}const L=r.value;_.value=!0,le.value="جاري رفع الفيديو...";const ge=new FormData;ge.append("video",L),console.log("[v0] جاري إرسال الطلب إلى الخادم (multipart/form-data)..."),await Te.uploadIntroVideo(ge,{timeout:6e5,onUploadProgress:ie=>{if(ie.total){const we=Math.round(ie.loaded*100/ie.total);fe.value=we,console.log("[v0] تقدم الرفع:",we+"%")}}}),console.log("[v0] تم الرفع بنجاح"),z.value=!0,await E(),I(),setTimeout(()=>{z.value=!1},3e3)}catch(L){const ge=(s=L==null?void 0:L.response)==null?void 0:s.status,ie=Array.isArray((d=(e=L==null?void 0:L.response)==null?void 0:e.data)==null?void 0:d.errors)?L.response.data.errors.join("، "):"",we=((g=(b=L==null?void 0:L.response)==null?void 0:b.data)==null?void 0:g.message)||(L==null?void 0:L.message)||"حدث خطأ أثناء رفع الفيديو";p.value=[we,ie].filter(Boolean).join(" - "),console.error("[v0] upload error",{status:ge,data:(k=L==null?void 0:L.response)==null?void 0:k.data,err:L})}finally{_.value=!1,B.value=!1,le.value=""}}},A=async()=>{Z.value=!0,await Ie();const s=be.value;if(!s||!n.value)return;if(!n.value.endsWith(".m3u8")){s.src=n.value;return}if(s.canPlayType("application/vnd.apple.mpegurl")){s.src=n.value;return}try{const d=await We(()=>import("./hls-BrJ-n9j-.js"),[]),b=d.default||d;if(b&&b.isSupported()){const g=new b;g.loadSource(n.value),g.attachMedia(s),he(Z,k=>{!k&&g&&g.destroy()})}}catch(d){console.error("[v0] HLS preview error:",d)}},E=async()=>{var s,e;try{const d=await Te.getIntroVideo(),b=((s=d==null?void 0:d.data)==null?void 0:s.content_url)||"",g=((e=d==null?void 0:d.data)==null?void 0:e.data)||{};M.value=(g==null?void 0:g.status)||"",Y.value=Number((g==null?void 0:g.durationSeconds)||0);const k=g!=null&&g.manifestUrl?`${b}${g.manifestUrl}`:null,L=g!=null&&g.thumbnailUrl?`${b}${g.thumbnailUrl}`:null;k?(n.value=k,f.value=k,x.value=L||null,oe()):(n.value=null,x.value=null,r.value||(f.value=null))}catch{n.value=null}},oe=async()=>{const s=K.value;if(!(!s||!f.value||!(typeof f.value=="string"&&f.value.endsWith(".m3u8")))){if(O){try{O.destroy()}catch{}O=null}if(s.canPlayType("application/vnd.apple.mpegurl")){s.src=f.value;return}try{const d=await We(()=>import("./hls-BrJ-n9j-.js"),[]),b=d.default||d;b&&b.isSupported()&&(O=new b,O.loadSource(f.value),O.attachMedia(s))}catch{}}};return he([T,w],()=>{Be()}),Xe(()=>{document.addEventListener("mousemove",u),document.addEventListener("mouseup",h),document.addEventListener("touchmove",u),document.addEventListener("touchend",h),E()}),He(()=>{if(document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",h),f.value&&URL.revokeObjectURL(f.value),O){try{O.destroy()}catch{}O=null}}),he(f,()=>{oe()}),(s,e)=>(S(),R(ne,null,{default:l(()=>[t(Me,{class:"d-flex align-center gap-2"},{default:l(()=>[t(D,{color:"primary"},{default:l(()=>e[9]||(e[9]=[c("mdi-video")])),_:1}),e[10]||(e[10]=c(" فيديو التعريف (اختياري) "))]),_:1}),t(ue,null,{default:l(()=>[i("input",{ref_key:"fileInputRef",ref:se,type:"file",accept:"video/*",onChange:Ee,style:{display:"none"},id:"video-upload"},null,544),n.value&&!r.value?(S(),re("div",Wt,[i("div",Yt,[t(Ue,{size:"56",rounded:""},{default:l(()=>[t(wt,{src:x.value||n.value,alt:"thumbnail"},null,8,["src"])]),_:1}),i("div",null,[i("div",Gt,[M.value==="ready"?(S(),R(ze,{key:0,size:"small",color:"success"},{default:l(()=>e[11]||(e[11]=[c("جاهز")])),_:1})):M.value==="processing"?(S(),R(ze,{key:1,size:"small",color:"warning"},{default:l(()=>e[12]||(e[12]=[c("قيد المعالجة")])),_:1})):(S(),R(ze,{key:2,size:"small",color:"info"},{default:l(()=>[c(F(M.value||"غير معروف"),1)]),_:1}))]),i("div",Kt," المدة: "+F(Q(Y.value||0)),1)])]),i("div",Xt,[t(te,{size:"small",variant:"tonal",color:"primary",onClick:A},{default:l(()=>[t(D,{start:""},{default:l(()=>e[13]||(e[13]=[c("mdi-play")])),_:1}),e[14]||(e[14]=c(" معاينة "))]),_:1}),t(te,{size:"small",variant:"tonal",color:"primary",onClick:Se},{default:l(()=>[t(D,{start:""},{default:l(()=>e[15]||(e[15]=[c("mdi-upload")])),_:1}),e[16]||(e[16]=c(" استبدال الفيديو "))]),_:1})])])):q("",!0),t(kt,{modelValue:Z.value,"onUpdate:modelValue":e[1]||(e[1]=d=>Z.value=d),"max-width":"800"},{default:l(()=>[t(ne,null,{default:l(()=>[t(Me,{class:"d-flex align-center justify-space-between"},{default:l(()=>[e[18]||(e[18]=i("span",null,"معاينة الفيديو",-1)),t(te,{icon:"",variant:"text",onClick:e[0]||(e[0]=d=>Z.value=!1)},{default:l(()=>[t(D,null,{default:l(()=>e[17]||(e[17]=[c("mdi-close")])),_:1})]),_:1})]),_:1}),t(ue,null,{default:l(()=>[i("div",Ht,[i("video",{ref_key:"previewVideoRef",ref:be,poster:x.value||void 0,class:"w-100",style:{"max-block-size":"500px"},controls:"",playsinline:""},null,8,Jt)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),f.value?Ae.value?(S(),re("div",Zt,[!Ce&&P.value?(S(),R(me,{key:0,type:"warning",variant:"tonal",density:"compact"},{prepend:l(()=>[t(D,null,{default:l(()=>e[24]||(e[24]=[c("mdi-alert")])),_:1})]),default:l(()=>[c(" تم قص الفيديو تلقائياً إلى "+F(Q(s.maxDuration))+" (الحد الأقصى المسموح). يمكنك تحريك المقطع المحدد إلى أي جزء من الفيديو باستخدام السحب. ",1)]),_:1})):Ce?q("",!0):(S(),R(me,{key:1,type:"info",variant:"tonal",density:"compact"},{prepend:l(()=>[t(D,null,{default:l(()=>e[25]||(e[25]=[c("mdi-information")])),_:1})]),default:l(()=>[c(" اسحب الحدود لتحديد الجزء المطلوب، أو اسحب المنطقة الوسطى لتحريك المقطع بالكامل. الحد الأقصى: "+F(Q(s.maxDuration)),1)]),_:1})),r.value&&r.value.size>ve?(S(),R(me,{key:2,type:"error",variant:"tonal",density:"compact"},{prepend:l(()=>[t(D,null,{default:l(()=>e[26]||(e[26]=[c("mdi-alert")])),_:1})]),default:l(()=>[c(" حجم الفيديو: "+F(ae(r.value.size))+". الحد الأقصى المسموح للرفع هو "+F(ae(ve))+". يرجى اختيار فيديو آخر أصغر. ",1)]),_:1})):q("",!0),i("div",el,[i("video",{ref_key:"videoRef",ref:K,src:f.value,class:"w-100",style:{"max-block-size":"400px"},controls:"",onLoadedmetadata:qe,onTimeupdate:Ve},null,40,tl)]),Ce?q("",!0):(S(),R(Pe,{key:3},{default:l(()=>[t(H,{cols:"12",md:"4"},{default:l(()=>[t(ne,null,{default:l(()=>[t(ue,{class:"text-center"},{default:l(()=>[e[27]||(e[27]=i("p",{class:"text-caption text-medium-emphasis"},"المدة الأصلية",-1)),i("p",ll,F(Q(v.value)),1)]),_:1})]),_:1})]),_:1}),t(H,{cols:"12",md:"4"},{default:l(()=>[t(ne,{color:"primary"},{default:l(()=>[t(ue,{class:"text-center"},{default:l(()=>[e[28]||(e[28]=i("p",{class:"text-caption",style:{color:"white"}},"المدة بعد القص",-1)),i("p",al,F(Q(xe.value)),1)]),_:1})]),_:1})]),_:1}),t(H,{cols:"12",md:"4"},{default:l(()=>[t(ne,null,{default:l(()=>[t(ue,{class:"text-center"},{default:l(()=>[e[29]||(e[29]=i("p",{class:"text-caption text-medium-emphasis"},"الحجم التقريبي",-1)),i("p",ol,F(Fe.value),1)]),_:1})]),_:1})]),_:1})]),_:1})),Ce?q("",!0):(S(),R(ne,{key:4},{default:l(()=>[t(ue,null,{default:l(()=>[i("div",nl,[t(D,{size:"small"},{default:l(()=>e[30]||(e[30]=[c("mdi-content-cut")])),_:1}),e[31]||(e[31]=i("span",{class:"text-body-2 font-weight-medium"},"قص الفيديو",-1))]),t(me,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:l(()=>[i("div",sl,[t(D,{size:"small"},{default:l(()=>e[32]||(e[32]=[c("mdi-information")])),_:1}),i("div",null,[e[35]||(e[35]=i("p",{class:"font-weight-medium mb-1"},"كيفية الاستخدام:",-1)),i("ul",il,[e[33]||(e[33]=i("li",null,"اسحب الحدود اليمنى أو اليسرى لتغيير طول المقطع",-1)),e[34]||(e[34]=i("li",null,"اسحب المنطقة الوسطى (بين الحدود) لتحريك المقطع بالكامل",-1)),i("li",null,"لا يمكن توسيع المقطع أكثر من "+F(Q(s.maxDuration)),1)])])])]),_:1}),i("div",{ref_key:"timelineRef",ref:pe,class:"timeline-container rounded-lg overflow-hidden",style:{position:"relative",background:"#1a1a1a","block-size":"80px","user-select":"none"}},[i("div",rl,[(S(!0),re(De,null,lt(C.value,(d,b)=>(S(),re("img",{key:b,src:d,alt:`Frame ${b}`,class:"h-100",style:Le([{"border-inline-end":"1px solid rgba(255, 255, 255, 10%)","object-fit":"cover"},{width:`${100/s.numberOfFrames}%`}])},null,12,ul))),128))]),i("div",dl,[i("div",{style:Le([{position:"absolute",background:"rgba(0, 0, 0, 70%)","block-size":"100%","inset-block-start":"0","inset-inline-start":"0"},{width:`${G.value}px`}])},null,4),i("div",{style:Le([{position:"absolute","block-size":"100%","border-block-end":"2px solid #2196f3","border-block-start":"2px solid #2196f3","inset-block-start":"0"},{left:`${G.value}px`,width:`${N.value}px`}])},[i("div",{class:"handle-left",style:{position:"absolute",display:"flex","align-items":"center","justify-content":"center","border-radius":"4px 0 0 4px",background:"#2196f3","block-size":"100%",cursor:"ew-resize","inline-size":"12px","inset-block-start":"0","inset-inline-start":"-6px","pointer-events":"auto"},onMousedown:e[2]||(e[2]=d=>W("left",d)),onTouchstart:e[3]||(e[3]=d=>W("left",d))},[e[37]||(e[37]=i("div",{style:{background:"rgba(255, 255, 255, 80%)","block-size":"100%","inline-size":"2px"}},null,-1)),i("div",cl,[t(D,{size:"small",color:"white"},{default:l(()=>e[36]||(e[36]=[c("mdi-chevron-right")])),_:1})])],32),i("div",{class:"handle-middle",style:{position:"absolute",cursor:"move",inset:"0","margin-block":"0","margin-inline":"12px","pointer-events":"auto"},onMousedown:e[4]||(e[4]=d=>W("middle",d)),onTouchstart:e[5]||(e[5]=d=>W("middle",d))},[i("div",vl,[i("div",ml,[t(D,{color:"white"},{default:l(()=>e[38]||(e[38]=[c("mdi-arrow-all")])),_:1})])])],32),i("div",fl,[i("span",pl,F(Q(T.value)),1),i("span",gl,F(Q(w.value)),1)]),i("div",{class:"handle-right",style:{position:"absolute",display:"flex","align-items":"center","justify-content":"center","border-radius":"0 4px 4px 0",background:"#2196f3","block-size":"100%",cursor:"ew-resize","inline-size":"12px","inset-block-start":"0","inset-inline-end":"-6px","pointer-events":"auto"},onMousedown:e[6]||(e[6]=d=>W("right",d)),onTouchstart:e[7]||(e[7]=d=>W("right",d))},[e[40]||(e[40]=i("div",{style:{background:"rgba(255, 255, 255, 80%)","block-size":"100%","inline-size":"2px"}},null,-1)),i("div",yl,[t(D,{size:"small",color:"white"},{default:l(()=>e[39]||(e[39]=[c("mdi-chevron-left")])),_:1})])],32)],4),i("div",{style:Le([{position:"absolute",background:"rgba(0, 0, 0, 70%)","block-size":"100%","inset-block-start":"0"},{left:`${G.value+N.value}px`,width:`${m.value-G.value-N.value}px`}])},null,4)])],512),i("div",hl,[i("div",bl,[t(D,{size:"small",color:"primary"},{default:l(()=>e[41]||(e[41]=[c("mdi-clock-outline")])),_:1}),i("span",xl," المدة المحددة: "+F(Q(xe.value)),1),xe.value===s.maxDuration?(S(),re("span",wl," (الحد الأقصى) ")):q("",!0)]),v.value>s.maxDuration?(S(),re("div",kl," من أصل "+F(Q(v.value)),1)):q("",!0)]),i("div",Vl,[t(te,{variant:"outlined",size:"small",onClick:U},{default:l(()=>[t(D,{start:""},{default:l(()=>e[42]||(e[42]=[c("mdi-refresh")])),_:1}),e[43]||(e[43]=c(" إعادة تعيين "))]),_:1}),t(te,{variant:"outlined",size:"small",onClick:V},{default:l(()=>[t(D,{start:""},{default:l(()=>e[44]||(e[44]=[c("mdi-play")])),_:1}),e[45]||(e[45]=c(" معاينة القص "))]),_:1})])]),_:1})]),_:1})),i("div",_l,[t(te,{color:"primary",disabled:_.value||!r.value||B.value||r.value&&r.value.size>ve,loading:_.value||B.value,block:"",onClick:j},{default:l(()=>[t(D,{start:""},{default:l(()=>e[46]||(e[46]=[c("mdi-upload")])),_:1}),c(" "+F(Re()),1)]),_:1},8,["disabled","loading"]),t(te,{variant:"outlined",disabled:_.value||B.value,onClick:I},{default:l(()=>[t(D,{start:""},{default:l(()=>e[47]||(e[47]=[c("mdi-close")])),_:1}),e[48]||(e[48]=c(" إلغاء "))]),_:1},8,["disabled"])]),B.value?(S(),R(ne,{key:5,color:"info",variant:"tonal"},{default:l(()=>[t(ue,null,{default:l(()=>[i("div",Dl,[t(Je,{indeterminate:"",color:"info",size:"24"}),i("div",Sl,[i("p",Ll,F(le.value),1),e[49]||(e[49]=i("p",{class:"text-caption text-medium-emphasis"},"قد يستغرق هذا بضع ثوانٍ...",-1))])])]),_:1})]),_:1})):q("",!0),_.value?(S(),R(at,{key:6,"model-value":fe.value,color:"primary",height:"8",rounded:""},null,8,["model-value"])):q("",!0),z.value?(S(),R(me,{key:7,type:"success",variant:"tonal",density:"compact"},{prepend:l(()=>[t(D,null,{default:l(()=>e[50]||(e[50]=[c("mdi-check-circle")])),_:1})]),default:l(()=>[e[51]||(e[51]=c(" تم رفع الفيديو بنجاح! جاري معالجته على الخادم... "))]),_:1})):q("",!0),p.value?(S(),R(me,{key:8,type:"error",variant:"tonal",density:"compact",closable:"","onClick:close":e[8]||(e[8]=d=>p.value="")},{prepend:l(()=>[t(D,null,{default:l(()=>e[52]||(e[52]=[c("mdi-alert")])),_:1})]),default:l(()=>[c(" "+F(p.value),1)]),_:1})):q("",!0)])):q("",!0):(S(),re("div",$t,[t(D,{size:"64",color:"primary",class:"mb-4"},{default:l(()=>e[19]||(e[19]=[c("mdi-video")])),_:1}),e[22]||(e[22]=i("h3",{class:"text-h6 mb-2"},"ارفع فيديو تعريفي عنك",-1)),e[23]||(e[23]=i("p",{class:"text-body-2 text-medium-emphasis mb-4"}," يساعد الفيديو الطلاب على التعرف عليك بشكل أفضل ",-1)),t(te,{color:"primary",onClick:Se},{default:l(()=>[t(D,{start:""},{default:l(()=>e[20]||(e[20]=[c("mdi-upload")])),_:1}),e[21]||(e[21]=c(" اختر فيديو "))]),_:1}),i("p",Qt," يدعم: MP4, MOV, AVI. الحد الأقصى للحجم: "+F(ae(ve)),1)]))]),_:1})]),_:1}))}}),$e=Ye(Cl,[["__scopeId","data-v-07987047"]]);function zl(a,o,r){if(o==null)return a;if(Array.isArray(o))throw new Error("Multiple matches is not implemented");return typeof o=="number"&&~o?t(De,null,[t("span",{class:"v-autocomplete__unmask"},[a.substr(0,o)]),t("span",{class:"v-autocomplete__mask"},[a.substr(o,r)]),t("span",{class:"v-autocomplete__unmask"},[a.substr(o+r)])]):a}const Pl=nt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Ut({filterKeys:["title"]}),...Ct(),...mt(ft({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...vt({transition:!1})},"VAutocomplete"),Il=ot()({name:"VAutocomplete",props:Pl(),emits:{"update:focused":a=>!0,"update:search":a=>!0,"update:modelValue":a=>!0,"update:menu":a=>!0},setup(a,o){let{slots:r}=o;const{t:f}=st(),n=y(),x=_e(!1),M=_e(!0),Y=_e(!1),O=y(),v=y(),T=Ne(a,"menu"),w=X({get:()=>T.value,set:u=>{var h;T.value&&!u&&((h=O.value)!=null&&h.ΨopenChildren.size)||(T.value=u)}}),_=_e(-1),fe=X(()=>{var u;return(u=n.value)==null?void 0:u.color}),z=X(()=>w.value?a.closeText:a.openText),{items:p,transformIn:P,transformOut:B}=Ft(a),{textColorClasses:le,textColorStyles:Z}=it(fe),C=Ne(a,"search",""),m=Ne(a,"modelValue",[],u=>P(u===null?[null]:rt(u)),u=>{const h=B(u);return a.multiple?h:h[0]??null}),G=X(()=>typeof a.counterValue=="function"?a.counterValue(m.value):typeof a.counterValue=="number"?a.counterValue:m.value.length),N=ut(a),{filteredItems:de,getMatches:ce}=Tt(a,p,()=>M.value?"":C.value),J=X(()=>a.hideSelected?de.value.filter(u=>!m.value.some(h=>h.value===u.value)):de.value),ee=X(()=>!!(a.chips||r.chip)),$=X(()=>ee.value||!!r.selection),K=X(()=>m.value.map(u=>u.props.value)),be=X(()=>{var h;return(a.autoSelectFirst===!0||a.autoSelectFirst==="exact"&&C.value===((h=J.value[0])==null?void 0:h.title))&&J.value.length>0&&!M.value&&!Y.value}),pe=X(()=>a.hideNoData&&!J.value.length||N.isReadonly.value||N.isDisabled.value),se=y(),xe=Lt(se,n);function Fe(u){a.openOnClear&&(w.value=!0),C.value=""}function Ae(){pe.value||(w.value=!0)}function Re(u){pe.value||(x.value&&(u.preventDefault(),u.stopPropagation()),w.value=!w.value)}function Q(u){var h;xt(u)&&((h=n.value)==null||h.focus())}function ae(u){var V,I,j;if(N.isReadonly.value)return;const h=n.value.selectionStart,U=m.value.length;if((_.value>-1||["Enter","ArrowDown","ArrowUp"].includes(u.key))&&u.preventDefault(),["Enter","ArrowDown"].includes(u.key)&&(w.value=!0),["Escape"].includes(u.key)&&(w.value=!1),be.value&&["Enter","Tab"].includes(u.key)&&!m.value.some(A=>{let{value:E}=A;return E===J.value[0].value})&&W(J.value[0]),u.key==="ArrowDown"&&be.value&&((V=se.value)==null||V.focus("next")),["Backspace","Delete"].includes(u.key)){if(!a.multiple&&$.value&&m.value.length>0&&!C.value)return W(m.value[0],!1);if(~_.value){const A=_.value;W(m.value[_.value],!1),_.value=A>=U-1?U-2:A}else u.key==="Backspace"&&!C.value&&(_.value=U-1)}if(a.multiple){if(u.key==="ArrowLeft"){if(_.value<0&&h>0)return;const A=_.value>-1?_.value-1:U-1;m.value[A]?_.value=A:(_.value=-1,n.value.setSelectionRange((I=C.value)==null?void 0:I.length,(j=C.value)==null?void 0:j.length))}if(u.key==="ArrowRight"){if(_.value<0)return;const A=_.value+1;m.value[A]?_.value=A:(_.value=-1,n.value.setSelectionRange(0,0))}}}function Ee(u){if(Ge(n.value,":autofill")||Ge(n.value,":-webkit-autofill")){const h=p.value.find(U=>U.title===u.target.value);h&&W(h)}}function Se(){var u;a.eager&&((u=v.value)==null||u.calculateVisibleItems())}function Oe(){var u;x.value&&(M.value=!0,(u=n.value)==null||u.focus())}function Be(u){x.value=!0,setTimeout(()=>{Y.value=!0})}function je(u){Y.value=!1}function qe(u){(u==null||u===""&&!a.multiple&&!$.value)&&(m.value=[])}const Ve=_e(!1);function W(u){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!u||u.props.disabled))if(a.multiple){const U=m.value.findIndex(I=>a.valueComparator(I.value,u.value)),V=h??!~U;if(~U){const I=V?[...m.value,u]:[...m.value];I.splice(U,1),m.value=I}else V&&(m.value=[...m.value,u]);a.clearOnSelect&&(C.value="")}else{const U=h!==!1;m.value=U?[u]:[],C.value=U&&!$.value?u.title:"",Ie(()=>{w.value=!1,M.value=!0})}}return he(x,(u,h)=>{var U;u!==h&&(u?(Ve.value=!0,C.value=a.multiple||$.value?"":String(((U=m.value.at(-1))==null?void 0:U.props.title)??""),M.value=!0,Ie(()=>Ve.value=!1)):(!a.multiple&&C.value==null&&(m.value=[]),w.value=!1,m.value.some(V=>{let{title:I}=V;return I===C.value})||(C.value=""),_.value=-1))}),he(C,u=>{!x.value||Ve.value||(u&&(w.value=!0),M.value=!u)}),he(w,()=>{if(!a.hideSelected&&w.value&&m.value.length){const u=J.value.findIndex(h=>m.value.some(U=>h.value===U.value));pt&&window.requestAnimationFrame(()=>{var h;u>=0&&((h=v.value)==null||h.scrollToIndex(u))})}}),he(()=>a.items,(u,h)=>{w.value||x.value&&!h.length&&u.length&&(w.value=!0)}),dt(()=>{const u=!!(!a.hideNoData||J.value.length||r["prepend-item"]||r["append-item"]||r["no-data"]),h=m.value.length>0,U=ye.filterProps(a);return t(ye,ke({ref:n},U,{modelValue:C.value,"onUpdate:modelValue":[V=>C.value=V,qe],focused:x.value,"onUpdate:focused":V=>x.value=V,validationValue:m.externalValue,counterValue:G.value,dirty:h,onChange:Ee,class:["v-autocomplete",`v-autocomplete--${a.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":w.value,"v-autocomplete--chips":!!a.chips,"v-autocomplete--selection-slot":!!$.value,"v-autocomplete--selecting-index":_.value>-1},a.class],style:a.style,readonly:N.isReadonly.value,placeholder:h?void 0:a.placeholder,"onClick:clear":Fe,"onMousedown:control":Ae,onKeydown:ae}),{...r,default:()=>t(De,null,[t(yt,ke({ref:O,modelValue:w.value,"onUpdate:modelValue":V=>w.value=V,activator:"parent",contentClass:"v-autocomplete__content",disabled:pe.value,eager:a.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:a.transition,onAfterEnter:Se,onAfterLeave:Oe},a.menuProps),{default:()=>[u&&t(At,ke({ref:se,selected:K.value,selectStrategy:a.multiple?"independent":"single-independent",onMousedown:V=>V.preventDefault(),onKeydown:Q,onFocusin:Be,onFocusout:je,tabindex:"-1","aria-live":"polite",color:a.itemColor??a.color},xe,a.listProps),{default:()=>{var V,I,j;return[(V=r["prepend-item"])==null?void 0:V.call(r),!J.value.length&&!a.hideNoData&&(((I=r["no-data"])==null?void 0:I.call(r))??t(Ke,{title:f(a.noDataText)},null)),t(zt,{ref:v,renderless:!0,items:J.value},{default:A=>{var d;let{item:E,index:oe,itemRef:s}=A;const e=ke(E.props,{ref:s,key:oe,active:be.value&&oe===0?!0:void 0,onClick:()=>W(E,null)});return((d=r.item)==null?void 0:d.call(r,{item:E,index:oe,props:e}))??t(Ke,ke(e,{role:"option"}),{prepend:b=>{let{isSelected:g}=b;return t(De,null,[a.multiple&&!a.hideSelected?t(Pt,{key:E.value,modelValue:g,ripple:!1,tabindex:"-1"},null):void 0,E.props.prependAvatar&&t(Ue,{image:E.props.prependAvatar},null),E.props.prependIcon&&t(D,{icon:E.props.prependIcon},null)])},title:()=>{var b,g;return M.value?E.title:zl(E.title,(b=ce(E))==null?void 0:b.title,((g=C.value)==null?void 0:g.length)??0)}})}}),(j=r["append-item"])==null?void 0:j.call(r)]}})]}),m.value.map((V,I)=>{function j(s){s.stopPropagation(),s.preventDefault(),W(V,!1)}const A={"onClick:close":j,onKeydown(s){s.key!=="Enter"&&s.key!==" "||(s.preventDefault(),s.stopPropagation(),j(s))},onMousedown(s){s.preventDefault(),s.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},E=ee.value?!!r.chip:!!r.selection,oe=E?ht(ee.value?r.chip({item:V,index:I,props:A}):r.selection({item:V,index:I})):void 0;if(!(E&&!oe))return t("div",{key:V.value,class:["v-autocomplete__selection",I===_.value&&["v-autocomplete__selection--selected",le.value]],style:I===_.value?Z.value:{}},[ee.value?r.chip?t(bt,{key:"chip-defaults",defaults:{VChip:{closable:a.closableChips,size:"small",text:V.title}}},{default:()=>[oe]}):t(ze,ke({key:"chip",closable:a.closableChips,size:"small",text:V.title,disabled:V.props.disabled},A),null):oe??t("span",{class:"v-autocomplete__selection-text"},[V.title,a.multiple&&I<m.value.length-1&&t("span",{class:"v-autocomplete__selection-comma"},[c(",")])])])})]),"append-inner":function(){var A;for(var V=arguments.length,I=new Array(V),j=0;j<V;j++)I[j]=arguments[j];return t(De,null,[(A=r["append-inner"])==null?void 0:A.call(r,...I),a.menuIcon?t(D,{class:"v-autocomplete__menu-icon",icon:a.menuIcon,onMousedown:Re,onClick:gt,"aria-label":f(z.value),title:f(z.value),tabindex:"-1"},null):void 0])}})}),ct({isFocused:x,isPristine:M,menu:w,search:C,filteredItems:de,select:W},n)}}),Ml={name:"StudentProfileForm",components:{VideoUploadEditor:$e},data(){return{user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{},form:null,isLoading:!1,error:"",success:"",formData:{name:"",phone:"",studyYear:localStorage.getItem("studyYear")?JSON.parse(localStorage.getItem("studyYear")):null,bio:"",experienceYears:"",gradeIds:[],address:"",gender:null,birthDate:null,latitude:31.2001,longitude:29.9187,profileImageBase64:null},grades:[],genderOptions:[{text:"ذكر",value:"male"},{text:"أنثى",value:"female"}],rules:{required:a=>!!a||"هذا الحقل مطلوب",phone:a=>/^[0-9]{10,15}$/.test(a)||"رقم الهاتف غير صحيح"},avatarPreviewSrc:null}},created(){var a,o,r;if(this.getAllGrades(),this.formData.name=this.user.name,this.formData.phone=this.user.phone,this.formData.bio=this.user.bio,this.formData.experienceYears=this.user.experienceYears,this.formData.address=this.user.address,this.formData.gender=this.user.gender,this.formData.latitude=(a=this.user.location)!=null&&a.latitude?parseFloat(this.user.location.latitude):31.2001,this.formData.longitude=(o=this.user.location)!=null&&o.longitude?parseFloat(this.user.location.longitude):29.9187,this.formData.birthDate=this.user.birthDate,this.user.teacherGrades&&this.user.teacherGrades.length&&(this.formData.gradeIds=this.user.teacherGrades.map(f=>f.gradeId)),(r=this.user)!=null&&r.profileImagePath){const f=localStorage.getItem("content_url")||"",n=this.user.profileImagePath.trim();n.startsWith("data:image/")?this.avatarPreviewSrc=n:n.startsWith("http")?this.avatarPreviewSrc=n:this.avatarPreviewSrc=`${f}${n.startsWith("/")?"":"/"}${n}`}},methods:{handleLocationUpdate(a){this.formData.latitude=a.latitude,this.formData.longitude=a.longitude},async onAvatarSelected(a){var o,r;try{const f=Array.isArray(a)?a[0]:((r=(o=a==null?void 0:a.target)==null?void 0:o.files)==null?void 0:r[0])||a;if(!f)return;const n=await this.fileToBase64(f);this.formData.profileImageBase64=n,this.avatarPreviewSrc=n}catch(f){console.error("avatar select error",f),this.error="تعذر قراءة الصورة المختارة"}},fileToBase64(a){return new Promise((o,r)=>{const f=new FileReader;f.onload=()=>o(f.result),f.onerror=r,f.readAsDataURL(a)})},handleVideoUploadSuccess(a){this.success="تم رفع الفيديو بنجاح! سيتم معالجته قريباً."},validateForm(){return this.formData.name.trim()?this.formData.phone.trim()?this.formData.bio.trim()?!this.formData.experienceYears&&this.formData.experienceYears!==0?"سنوات الخبرة مطلوبة":!this.formData.gradeIds||!this.formData.gradeIds.length?"الصف الدراسي مطلوب":this.formData.address.trim()?this.formData.gender?this.formData.birthDate?null:"تاريخ الميلاد مطلوب":"الجنس مطلوب":"العنوان مطلوب":"النبذة مطلوبة":"رقم هاتف مطلوب":"اسم الطالب مطلوب"},async getAllGrades(){var a,o;try{const r=await Te.getAllGrades();this.grades=r.data.data}catch(r){console.error("Error saving profile:",r),this.error=((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"حدث خطأ أثناء حفظ البيانات. يرجى المحاولة مرة أخرى."}finally{this.isLoading=!1}},async handleSubmit(){var r,f;const{valid:a}=await this.$refs.form.validate();if(!a)return;const o=this.validateForm();if(o){this.error=o;return}this.isLoading=!0,this.error="",this.success="";try{const n={...this.formData},x=await Te.completeProfile(n);if(x.status===200||x.status===201){const M=x.data.data.user||this.formData;localStorage.setItem("user",JSON.stringify(M)),localStorage.setItem("isProfileComplete",x.data.data.isProfileComplete),this.success="تم حفظ بيانات المعلم بنجاح!",this.$router.push("/teacher/dashboard")}}catch(n){console.error("Error saving profile:",n),this.error=((f=(r=n.response)==null?void 0:r.data)==null?void 0:f.message)||"حدث خطأ أثناء حفظ البيانات. يرجى المحاولة مرة أخرى."}finally{this.isLoading=!1}}}},Tl={class:"text-center mb-8"},Ul=["src"],Fl={class:"d-flex align-center flex-wrap ga-4"},Al=["src"],Rl={class:"text-center pt-6"};function El(a,o,r,f,n,x){const M=Vt,Y=$e,O=Nt;return S(),R(_t,{fluid:"",class:"min-height-screen pa-8",style:{background:`linear-gradient(
      135deg,
      rgba(16, 185, 129, 5%) 0%,
      rgba(255, 255, 255, 100%) 50%,
      rgba(34, 197, 94, 5%) 100%
    )`}},{default:l(()=>[t(Pe,{justify:"center"},{default:l(()=>[t(H,{cols:"12",md:"10",lg:"8"},{default:l(()=>[i("div",Tl,[t(Ue,{size:"96",class:"mb-4",variant:"elevated"},{default:l(()=>[n.avatarPreviewSrc?(S(),re("img",{key:0,style:{"inline-size":"100px"},src:n.avatarPreviewSrc,alt:"Teacher Avatar"},null,8,Ul)):(S(),R(D,{key:1,size:"48",color:"primary"},{default:l(()=>o[10]||(o[10]=[c("mdi-account")])),_:1}))]),_:1}),o[11]||(o[11]=i("h1",{class:"text-h3 font-weight-bold mb-2"},"إعداد ملف الشخصي",-1)),o[12]||(o[12]=i("p",{class:"text-h6 text-medium-emphasis"}," يرجى إكمال البيانات التالية لإنشاء ملف الشخصي ",-1))]),t(Dt,{ref:"form"},{default:l(()=>[n.error?(S(),R(me,{key:0,type:"error",variant:"tonal",class:"mb-6",closable:"","onClick:close":o[0]||(o[0]=v=>n.error="")},{default:l(()=>[c(F(n.error),1)]),_:1})):q("",!0),n.success?(S(),R(me,{key:1,type:"success",variant:"tonal",class:"mb-6",closable:"","onClick:close":o[1]||(o[1]=v=>n.success="")},{default:l(()=>[c(F(n.success),1)]),_:1})):q("",!0),t(ne,{class:"mb-6",elevation:"2"},{default:l(()=>[t(Me,{class:"d-flex align-center"},{default:l(()=>[t(D,{color:"primary",class:"me-2"},{default:l(()=>o[13]||(o[13]=[c("mdi-account")])),_:1}),o[14]||(o[14]=c(" المعلومات الشخصية "))]),_:1}),t(ue,null,{default:l(()=>[t(Pe,null,{default:l(()=>[t(H,{cols:"12"},{default:l(()=>[i("div",Fl,[t(Ue,{size:"72"},{default:l(()=>[n.avatarPreviewSrc?(S(),re("img",{key:0,style:{"inline-size":"100px"},src:n.avatarPreviewSrc,alt:"Teacher Avatar"},null,8,Al)):(S(),R(D,{key:1,size:"36"},{default:l(()=>o[15]||(o[15]=[c("mdi-account")])),_:1}))]),_:1}),i("div",null,[o[16]||(o[16]=i("div",{class:"text-body-2 mb-2"},"صورة الملف الشخصي (اختياري)",-1)),t(St,{accept:"image/*",variant:"outlined",density:"comfortable","show-size":"","prepend-icon":"mdi-image",label:"اختر صورة",onChange:x.onAvatarSelected},null,8,["onChange"]),o[17]||(o[17]=i("div",{class:"text-caption text-medium-emphasis mt-1"},"يدعم: PNG, JPG. الحجم الموصى به أقل من 2MB. ",-1))])])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(ye,{modelValue:n.formData.name,"onUpdate:modelValue":o[2]||(o[2]=v=>n.formData.name=v),label:"اسم الكامل *",placeholder:"أدخل اسم الكامل",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(ye,{modelValue:n.formData.phone,"onUpdate:modelValue":o[3]||(o[3]=v=>n.formData.phone=v),label:"رقم الهاتف *",placeholder:"أدخل رقم الهاتف",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(It,{modelValue:n.formData.gender,"onUpdate:modelValue":o[4]||(o[4]=v=>n.formData.gender=v),label:"الجنس *",items:n.genderOptions,"item-title":"text","item-value":"value",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(M,{id:"invoiceStartDate",modelValue:n.formData.birthDate,"onUpdate:modelValue":o[5]||(o[5]=v=>n.formData.birthDate=v),label:"تاريخ الميلاد *",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(ye,{modelValue:n.formData.experienceYears,"onUpdate:modelValue":o[6]||(o[6]=v=>n.formData.experienceYears=v),label:"سنوات الخبرة *",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(H,{cols:"12",md:"6"},{default:l(()=>[t(ye,{modelValue:n.formData.address,"onUpdate:modelValue":o[7]||(o[7]=v=>n.formData.address=v),label:"العنوان *",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(H,{cols:"12",md:"12"},{default:l(()=>[t(Mt,{modelValue:n.formData.bio,"onUpdate:modelValue":o[8]||(o[8]=v=>n.formData.bio=v),label:"نبذة عن نفسك *",variant:"outlined",rules:[n.rules.required],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ne,{class:"mb-6",elevation:"2"},{default:l(()=>[t(Me,{class:"d-flex align-center"},{default:l(()=>[t(D,{color:"primary",class:"me-2"},{default:l(()=>o[18]||(o[18]=[c("mdi-school-outline")])),_:1}),o[19]||(o[19]=c(" المعلومات الأكاديمية "))]),_:1}),t(ue,null,{default:l(()=>[t(Pe,null,{default:l(()=>[t(H,{cols:"12",md:"6"},{default:l(()=>[t(Il,{modelValue:n.formData.gradeIds,"onUpdate:modelValue":o[9]||(o[9]=v=>n.formData.gradeIds=v),label:"الصفوف التي تدرسها *",items:n.grades,"item-title":"name","item-value":"id",variant:"outlined",rules:[n.rules.required],chips:"",multiple:"",required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Y,{onUploadSuccess:x.handleVideoUploadSuccess,class:"mb-6"},null,8,["onUploadSuccess"]),t(O,{"initial-lat":n.formData.latitude,"initial-lng":n.formData.longitude,onLocationUpdate:x.handleLocationUpdate,class:"mb-6"},null,8,["initial-lat","initial-lng","onLocationUpdate"])]),_:1},512),i("div",Rl,[t(te,{type:"submit",color:"primary",size:"large",loading:n.isLoading,disabled:n.isLoading,onClick:x.handleSubmit,class:"px-12"},{default:l(()=>[t(D,{start:""},{default:l(()=>o[20]||(o[20]=[c("mdi-school")])),_:1}),o[21]||(o[21]=c(" حفظ بيانات "))]),_:1},8,["loading","disabled","onClick"])])]),_:1})]),_:1})]),_:1})}const na=Ye(Ml,[["render",El],["__scopeId","data-v-00fd7e57"]]);export{na as default};
