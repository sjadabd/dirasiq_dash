import{_ as U}from"./AppBreadcrumbs-CGDMHBEQ.js";import{T as B}from"./teacher_api-B0aW0cjW.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as x,b as V,c as q}from"./VCard-q0Xiefi9.js";import{V as F}from"./VDialog-tPozjQ9z.js";import{c as u,b as t,e as s,o,d as l,k as v,V as C,A as y,q as m,t as d,f as b,x as A,F as I,s as T}from"./index-B-ugD3CV.js";import{V as h}from"./VDivider-0jTJqE-a.js";import{V as k}from"./VCardText-Dz05REAW.js";import{V as z,a as g}from"./VRow-_6XExfSs.js";import{V as P}from"./VChip-CqnLjyZp.js";import{V as L}from"./VImg-CPt2aJgH.js";import"./axios-D6DdSkOE.js";import"./VAvatar-BSxHYKKi.js";const R={name:"teacher-assignments-assignment-overview",data(){return{breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"الواجبات",disabled:!1,to:"/teacher/assignments/manage-assignments"},{title:"تفاصيل الواجب",disabled:!0}],loading:!1,assignment:null,recipients:[],submissions:[],imagePreview:{open:!1,src:"",title:""}}},created(){const a=this.$route.query.id;a&&this.fetchOverview(a)},methods:{async fetchOverview(a){var e,w;try{this.loading=!0;const p=await B.getAssignmentOverview(a),i=((e=p==null?void 0:p.data)==null?void 0:e.data)||{};this.assignment=i.assignment||null,this.recipients=Array.isArray(i.recipients)?i.recipients:[],this.submissions=Array.isArray(i.submissions)?i.submissions:[]}catch(p){console.error("Failed to fetch assignment overview",((w=p==null?void 0:p.response)==null?void 0:w.data)||p)}finally{this.loading=!1}},formatDateTime(a){if(!a)return"";const e=new Date(a);return Number.isNaN(e.getTime())?"":e.toLocaleString("ar-IQ")},resolveUrl(a){if(!a)return"";if(/^https?:\/\//i.test(a))return a;try{const e=JSON.parse(localStorage.getItem("results")||"{}"),w=(e==null?void 0:e.content_url)||"https://api.mulhimiq.com";return new URL(a,w).href}catch{return"https://api.mulhimiq.com".replace(/\/$/,"")+(String(a).startsWith("/")?"":"/")+String(a)}},submissionTypeLabel(a){return{paper:"ورقي",online:"إلكتروني",mixed:"مختلط"}[String(a||"").toLowerCase()]||"—"},openImage(a){const e=this.resolveUrl(a==null?void 0:a.url);this.imagePreview={open:!0,src:e,title:(a==null?void 0:a.name)||""}},closeImage(){this.imagePreview.open=!1}}},j={class:"text-h6"},E={class:"text-body-2",style:{"white-space":"pre-wrap"}},J={class:"text-body-2"},Q={class:"text-body-2"},W={class:"text-body-2"},G={class:"text-body-2"},H={key:0},K={key:1},M={key:1,class:"text-caption text-medium-emphasis"},X={class:"d-flex flex-wrap ga-2"},Y={class:"d-flex align-center justify-space-between flex-wrap mb-2"},Z={class:"d-flex align-center ga-2"},$={class:"text-subtitle-2"},ee={class:"d-flex align-center ga-2"},te={class:"text-caption"},se={key:0,class:"mb-2"},le={class:"text-body-2 mt-1",style:{"white-space":"pre-wrap"}},ie={key:1,class:"mb-2"},ne=["href"],re={key:2,class:"mb-2"},ae={key:0},oe={key:1},de={class:"d-flex align-center ga-3"},me={key:0},ue={class:"d-flex flex-wrap ga-2"},ce={class:"text-h6"};function fe(a,e,w,p,i,f){const N=U;return o(),u("div",null,[t(N,{items:i.breadcrumbItems},null,8,["items"]),t(x,{class:"my-4",elevation:"3",rounded:"lg"},{default:s(()=>[t(V,{class:"d-flex align-center py-4 px-6"},{default:s(()=>[t(v,{icon:"ri-file-list-3-line",color:"primary",class:"me-2",size:"24"}),e[3]||(e[3]=l("h3",{class:"text-h5 font-weight-bold"},"تفاصيل الواجب",-1)),t(C),t(y,{variant:"tonal","prepend-icon":"ri-arrow-go-back-line",onClick:e[0]||(e[0]=n=>a.$router.back())},{default:s(()=>e[2]||(e[2]=[m("رجوع")])),_:1})]),_:1}),t(h),t(k,null,{default:s(()=>[t(z,null,{default:s(()=>[t(g,{cols:"12",md:"8"},{default:s(()=>[t(x,{variant:"tonal",class:"mb-4"},{default:s(()=>[t(V,{class:"d-flex align-center"},{default:s(()=>{var n,r;return[t(v,{class:"me-2"},{default:s(()=>e[4]||(e[4]=[m("ri-task-line")])),_:1}),l("span",j,d(((n=i.assignment)==null?void 0:n.title)||"-"),1),t(C),t(P,{color:(r=i.assignment)!=null&&r.is_active?"success":"error",size:"small",variant:"flat"},{default:s(()=>{var _;return[m(d((_=i.assignment)!=null&&_.is_active?"مفعل":"معطل"),1)]}),_:1},8,["color"])]}),_:1}),t(h),t(k,null,{default:s(()=>[t(z,null,{default:s(()=>{var n;return[t(g,{cols:"12"},{default:s(()=>{var r;return[e[5]||(e[5]=l("div",{class:"text-subtitle-2 mb-1"},"الوصف",-1)),l("div",E,d(((r=i.assignment)==null?void 0:r.description)||"—"),1)]}),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>{var r;return[e[6]||(e[6]=l("div",{class:"text-subtitle-2 mb-1"},"تاريخ الإسناد",-1)),l("div",J,d(f.formatDateTime((r=i.assignment)==null?void 0:r.assigned_date)||"—"),1)]}),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>{var r;return[e[7]||(e[7]=l("div",{class:"text-subtitle-2 mb-1"},"تاريخ التسليم",-1)),l("div",Q,d(f.formatDateTime((r=i.assignment)==null?void 0:r.due_date)||"—"),1)]}),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>{var r;return[e[8]||(e[8]=l("div",{class:"text-subtitle-2 mb-1"},"طريقة التسليم",-1)),l("div",W,d(f.submissionTypeLabel((r=i.assignment)==null?void 0:r.submission_type)),1)]}),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>{var r;return[e[9]||(e[9]=l("div",{class:"text-subtitle-2 mb-1"},"الدرجة القصوى",-1)),l("div",G,d(((r=i.assignment)==null?void 0:r.max_score)??"—"),1)]}),_:1}),t(g,{cols:"12"},{default:s(()=>{var r,_;return[e[10]||(e[10]=l("div",{class:"text-subtitle-2 mb-2"},"المرفقات",-1)),Array.isArray((_=(r=i.assignment)==null?void 0:r.attachments)==null?void 0:_.files)&&i.assignment.attachments.files.length?(o(),b(z,{key:0,class:"ga-2"},{default:s(()=>[(o(!0),u(I,null,T(i.assignment.attachments.files,(c,D)=>(o(),b(g,{key:D,cols:"12",sm:"6",md:"4"},{default:s(()=>[(c.type||"").toLowerCase()==="image"?(o(),u("div",H,[t(L,{src:f.resolveUrl(c.url),alt:c.name,height:"160",cover:"",class:"rounded",style:{cursor:"pointer"},onClick:S=>f.openImage({url:c.url,name:c.name})},null,8,["src","alt","onClick"])])):(o(),u("div",K,[t(y,{href:f.resolveUrl(c.url),target:"_blank",rel:"noopener",variant:"tonal",size:"small","prepend-icon":"ri-attachment-2"},{default:s(()=>[m(d(c.name||"ملف"),1)]),_:2},1032,["href"])]))]),_:2},1024))),128))]),_:1})):(o(),u("div",M,"لا توجد مرفقات"))]}),_:1}),Array.isArray((n=i.assignment)==null?void 0:n.resources)&&i.assignment.resources.length?(o(),b(g,{key:0,cols:"12"},{default:s(()=>[e[11]||(e[11]=l("div",{class:"text-subtitle-2 mb-2"},"الموارد",-1)),l("div",X,[(o(!0),u(I,null,T(i.assignment.resources,(r,_)=>(o(),b(y,{key:_,href:r.url,target:"_blank",rel:"noopener",size:"small",variant:"outlined","prepend-icon":"ri-link-m"},{default:s(()=>[m(d(r.title||r.url),1)]),_:2},1032,["href"]))),128))])]),_:1})):A("",!0)]}),_:1})]),_:1})]),_:1}),t(x,{variant:"tonal"},{default:s(()=>[t(V,{class:"d-flex align-center"},{default:s(()=>[t(v,{class:"me-2"},{default:s(()=>e[12]||(e[12]=[m("ri-file-upload-line")])),_:1}),e[13]||(e[13]=l("span",{class:"text-h6"},"تسليمات الطلاب",-1)),t(C),t(P,{size:"small",variant:"flat",style:{color:"white"}},{default:s(()=>[m(d(i.submissions.length)+" تسليم",1)]),_:1})]),_:1}),t(h),t(k,null,{default:s(()=>[t(z,{class:"ga-3"},{default:s(()=>[(o(!0),u(I,null,T(i.submissions,n=>(o(),b(g,{key:n.id,cols:"12"},{default:s(()=>[t(x,null,{default:s(()=>[t(k,null,{default:s(()=>{var r,_;return[l("div",Y,[l("div",Z,[t(v,{size:"18"},{default:s(()=>e[14]||(e[14]=[m("ri-user-line")])),_:1}),l("span",$,d(((r=n.student)==null?void 0:r.name)||"طالب"),1)]),l("div",ee,[t(P,{size:"x-small",color:n.status==="graded"?"success":n.status==="submitted"?"primary":"default",variant:"flat"},{default:s(()=>[m(d(n.status),1)]),_:2},1032,["color"]),l("span",te,d(f.formatDateTime(n.submitted_at)),1)])]),n.content_text?(o(),u("div",se,[e[15]||(e[15]=l("strong",null,"النص:",-1)),l("div",le,d(n.content_text),1)])):A("",!0),n.link_url?(o(),u("div",ie,[e[16]||(e[16]=l("strong",null,"رابط:",-1)),l("a",{href:n.link_url,target:"_blank",rel:"noopener",class:"ms-1"},"فتح الرابط",8,ne)])):A("",!0),Array.isArray(n.attachments)&&n.attachments.length?(o(),u("div",re,[e[17]||(e[17]=l("strong",{class:"d-block mb-1"},"المرفقات:",-1)),t(z,{class:"ga-2"},{default:s(()=>[(o(!0),u(I,null,T(n.attachments,(c,D)=>(o(),b(g,{key:D,cols:"12",sm:"6",md:"4"},{default:s(()=>[(c.type||"").toLowerCase()==="image"?(o(),u("div",ae,[t(L,{src:f.resolveUrl(c.url),alt:c.name,height:"140",cover:"",class:"rounded",style:{cursor:"pointer"},onClick:S=>f.openImage(c)},null,8,["src","alt","onClick"])])):(o(),u("div",oe,[t(y,{href:f.resolveUrl(c.url),target:"_blank",rel:"noopener",variant:"tonal",size:"small","prepend-icon":"ri-attachment-2"},{default:s(()=>[m(d(c.name||"ملف"),1)]),_:2},1032,["href"])]))]),_:2},1024))),128))]),_:2},1024)])):A("",!0),l("div",de,[l("div",null,[e[18]||(e[18]=l("strong",null,"الدرجة:",-1)),m(" "+d(n.score??"—")+" / "+d(((_=i.assignment)==null?void 0:_.max_score)??"—"),1)]),n.feedback?(o(),u("div",me,[e[19]||(e[19]=l("strong",null,"ملاحظات:",-1)),m(" "+d(n.feedback),1)])):A("",!0)])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(g,{cols:"12",md:"4"},{default:s(()=>[t(x,{variant:"tonal",class:"mb-4"},{default:s(()=>[t(V,{class:"d-flex align-center"},{default:s(()=>[t(v,{class:"me-2"},{default:s(()=>e[20]||(e[20]=[m("ri-team-line")])),_:1}),e[21]||(e[21]=l("span",{class:"text-h6"},"المستلمون",-1))]),_:1}),t(h),t(k,null,{default:s(()=>[l("div",ue,[(o(!0),u(I,null,T(i.recipients,n=>(o(),b(P,{key:n.id,size:"small",color:"primary",variant:"outlined"},{default:s(()=>[m(d(n.name),1)]),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{modelValue:i.imagePreview.open,"onUpdate:modelValue":e[1]||(e[1]=n=>i.imagePreview.open=n),"max-width":"900"},{default:s(()=>[t(x,null,{default:s(()=>[t(V,{class:"d-flex align-center"},{default:s(()=>[t(v,{class:"me-2"},{default:s(()=>e[22]||(e[22]=[m("ri-image-line")])),_:1}),l("span",ce,d(i.imagePreview.title||"معاينة الصورة"),1),t(C),t(y,{icon:"",variant:"text",onClick:f.closeImage},{default:s(()=>[t(v,null,{default:s(()=>e[23]||(e[23]=[m("ri-close-line")])),_:1})]),_:1},8,["onClick"])]),_:1}),t(h),t(k,null,{default:s(()=>[t(L,{src:i.imagePreview.src,alt:i.imagePreview.title,height:"70vh",contain:"",class:"rounded"},null,8,["src","alt"])]),_:1}),t(h),t(q,null,{default:s(()=>[t(C),t(y,{href:i.imagePreview.src,target:"_blank",rel:"noopener",variant:"tonal","prepend-icon":"ri-download-2-line"},{default:s(()=>e[24]||(e[24]=[m("فتح/تحميل")])),_:1},8,["href"]),t(y,{color:"primary",onClick:f.closeImage},{default:s(()=>e[25]||(e[25]=[m("إغلاق")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ie=O(R,[["render",fe],["__scopeId","data-v-a7d36467"]]);export{Ie as default};
