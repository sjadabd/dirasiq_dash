import{_ as W}from"./BaseAlert-DMDZYgBb.js";import{_ as j}from"./ConfirmDangerDialog-DiOiWQFz.js";import{_ as Z}from"./SmartTable-DRD1z7i0.js";import{m as q}from"./vue3-apexcharts-CP5s7iRT.js";import{V as G,a as H,b as K,c as Q}from"./VExpansionPanels-CgE8lQWL.js";import{V as I,a as u}from"./VRow-1sXKMjVm.js";import{V,a as C,c as Y,b as L}from"./VCard-DkKUq9Xw.js";import{z,f as A,e as l,o as D,b as t,s as g,t as U,d as b,p as w,i as X,c as P,n as T,a as $,v,V as M,a_ as h,aZ as E,F as B,x as F}from"./index-DzRnBGoW.js";import{_ as ee}from"./AppBreadcrumbs-5PWjj0AR.js";import N from"./teacher_api-DSYadeDI.js";import{n as te}from"./number-DRUmGIrN.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as R}from"./VDialog-B-d6xDxs.js";import{V as O}from"./VDivider-DOU2dJa1.js";import{V as _}from"./VSelect-DPU1_UF_.js";import{V as oe}from"./VChip-BxDWJl9X.js";import{V as S}from"./VCardText-DxpVkpnf.js";import"./VDataTable-DKHI-dYN.js";import"./VPagination-DPnje41R.js";import"./VTable-CGzAcL7O.js";import"./filter-BD0O1YfX.js";import"./VTooltip-CZZ_rwxI.js";import"./VAvatar-gDhFptrY.js";import"./VImg-DAcp9xse.js";import"./axios-CwDcW8lj.js";import"./VList-C_vO-TC7.js";const ae={class:"text-h6 font-weight-bold text-white"},ie={class:"text-h6 font-weight-bold text-white"},ne={class:"text-h6 font-weight-bold text-white"},se={class:"text-h6 font-weight-bold text-white"},re={class:"text-h6 font-weight-bold text-white"},J={__name:"report-invoices",props:{report:{type:Object,default:()=>({studyYear:"2025-2026",counts:{totalPaid:0,totalPending:0,totalDiscounted:0},totals:{totalAmount:0,totalPaidAmount:0,discountAmount:0,remainingAmount:0}})}},setup(i){const e=q,n=i,s=y=>(y==null?void 0:y.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))||"0",o=z(()=>{var p,d,r,a;const y=((d=(p=n.report)==null?void 0:p.totals)==null?void 0:d.totalAmount)||0,f=((a=(r=n.report)==null?void 0:r.totals)==null?void 0:a.discountAmount)||0;return Math.max(0,Number(y)-Number(f))}),m=z(()=>{var y,f,p,d,r,a,x,c;return[((f=(y=n.report)==null?void 0:y.totals)==null?void 0:f.totalAmount)||0,((d=(p=n.report)==null?void 0:p.totals)==null?void 0:d.discountAmount)||0,((a=(r=n.report)==null?void 0:r.totals)==null?void 0:a.totalPaidAmount)||0,((c=(x=n.report)==null?void 0:x.totals)==null?void 0:c.remainingAmount)||0]}),k=z(()=>({chart:{type:"donut",fontFamily:"Cairo, sans-serif"},labels:["الإجمالي","الخصم","المدفوع","المتبقي"],colors:["#0B2545","#3FA9F5","#6EF2B4","#FF8A00"],legend:{position:"bottom",horizontalAlign:"center",fontSize:"14px",fontFamily:"Cairo, sans-serif"},dataLabels:{enabled:!0,style:{fontSize:"14px",fontFamily:"Cairo, sans-serif"}},tooltip:{y:{formatter:y=>s(y)+" د.ع"}},plotOptions:{pie:{donut:{size:"65%",labels:{show:!0,total:{show:!0,label:"الإجمالي",fontSize:"16px",fontFamily:"Cairo, sans-serif",formatter:function(y){return y.globals.seriesTotals.reduce((f,p)=>f+p,0)}}}}}},responsive:[{breakpoint:480,options:{chart:{width:280},legend:{position:"bottom"}}}]}));return(y,f)=>(D(),A(G,null,{default:l(()=>[t(H,null,{default:l(()=>[t(K,null,{default:l(()=>{var p;return[g(" تقرير فواتير الطلاب ("+U(((p=i.report)==null?void 0:p.studyYear)||"2025-2026")+") ",1)]}),_:1}),t(Q,null,{default:l(()=>[t(I,{class:"mb-6"},{default:l(()=>[t(u,{cols:"12",sm:"6",md:"2"},{default:l(()=>[t(V,{class:"pa-4 text-center stat-card",elevation:"2",color:"primary"},{default:l(()=>{var p,d;return[t(w,{size:"32",class:"mb-2",color:"white"},{default:l(()=>f[0]||(f[0]=[g("mdi-cash-multiple")])),_:1}),f[1]||(f[1]=b("div",{class:"text-body-2 text-white mb-1"},"إجمالي المبالغ",-1)),b("div",ae,U(s(((d=(p=i.report)==null?void 0:p.totals)==null?void 0:d.totalAmount)||0))+" د.ع",1)]}),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"2"},{default:l(()=>[t(V,{class:"pa-4 text-center stat-card",elevation:"2",color:"info"},{default:l(()=>{var p,d;return[t(w,{size:"32",class:"mb-2",color:"white"},{default:l(()=>f[2]||(f[2]=[g("mdi-ticket-percent")])),_:1}),f[3]||(f[3]=b("div",{class:"text-body-2 text-white mb-1"},"إجمالي الخصم",-1)),b("div",ie,U(s(((d=(p=i.report)==null?void 0:p.totals)==null?void 0:d.discountAmount)||0))+" د.ع",1)]}),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{class:"pa-4 text-center stat-card",elevation:"2",color:"secondary"},{default:l(()=>[t(w,{size:"32",class:"mb-2",color:"white"},{default:l(()=>f[4]||(f[4]=[g("mdi-calculator")])),_:1}),f[5]||(f[5]=b("div",{class:"text-body-2 text-white mb-1"},"الإجمالي بعد الخصم",-1)),b("div",ne,U(s(o.value))+" د.ع",1)]),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"2"},{default:l(()=>[t(V,{class:"pa-4 text-center stat-card",elevation:"2",color:"success"},{default:l(()=>{var p,d;return[t(w,{size:"32",class:"mb-2",color:"white"},{default:l(()=>f[6]||(f[6]=[g("mdi-cash-check")])),_:1}),f[7]||(f[7]=b("div",{class:"text-body-2 text-white mb-1"},"إجمالي المدفوع",-1)),b("div",se,U(s(((d=(p=i.report)==null?void 0:p.totals)==null?void 0:d.totalPaidAmount)||0))+" د.ع",1)]}),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{class:"pa-4 text-center stat-card",elevation:"2",color:"error"},{default:l(()=>{var p,d;return[t(w,{size:"32",class:"mb-2",color:"white"},{default:l(()=>f[8]||(f[8]=[g("mdi-cash-remove")])),_:1}),f[9]||(f[9]=b("div",{class:"text-body-2 text-white mb-1"},"المتبقي",-1)),b("div",re,U(s(((d=(p=i.report)==null?void 0:p.totals)==null?void 0:d.remainingAmount)||0))+" د.ع",1)]}),_:1})]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(u,{cols:"12"},{default:l(()=>[t(V,{class:"pa-4",elevation:"2"},{default:l(()=>[f[10]||(f[10]=b("h4",{class:"text-h6 font-weight-bold mb-4 text-center"},"تفصيل المبالغ",-1)),t(X(e),{type:"donut",options:k.value,series:m.value,height:"350"},null,8,["options","series"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},de={components:{ReportInvoices:J,ConfirmDangerDialog:j},data(){return{keyName:"teacher-manage-invoices",results:JSON.parse(localStorage.getItem("user")),breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"فواتير الطلاب",disabled:!0}],progress:0,loading:!1,studyYears:[],yearsLoading:!1,filters:{studyYear:JSON.parse(localStorage.getItem("studyYear"))||"",status:"",deleted:!1},statusItems:[{text:"الكل",value:""},{text:"مدفوعة",value:"paid"},{text:"غير مدفوعة",value:"unpaid"},{text:"جزئية",value:"partial"},{text:"متأخرة",value:"overdue"}],deletedItems:[{text:"محذوف",value:!0},{text:"غير محذوف",value:!1}],report:{},editDialog:{open:!1,invoiceId:null,current:{amountPaid:0,totalDiscount:0,remaining:0},form:{dueDate:"",notes:"",invoiceType:"",paymentMode:"",amountDue:null,installments:[],payments:[],additionalDiscounts:[]}},headers:[{title:"#",type:"strong",sortable:!1,key:"num"},{title:"اسم الطالب",type:"link",sortable:!0,key:"student_name"},{title:"طريقة الدفع",type:"strong",sortable:!0,key:"payment_mode"},{title:"الصف والجلسة",type:"session_title",sortable:!0,key:"grade_name"},{title:"المبلغ المستحق",type:"number",sortable:!0,key:"amount_due"},{title:"إجمالي الخصومات",type:"number",sortable:!0,key:"discount_total"},{title:"المدفوع",type:"number",sortable:!0,key:"amount_paid"},{title:"المتبقي",type:"number",sortable:!0,key:"remaining_amount"},{title:"الحالة",type:"status",sortable:!0,key:"invoice_status"},{title:"العمليات",type:"strong",sortable:!1,key:"actions"}],items:[],tableActions:["تعديل","حذف","اعادة تفعيل"],loadingTable:!1,totalItems:0,tableOptions:{page:1,limit:10,search:null},payDialog:{open:!1,invoiceId:null,form:{amount:null,paymentMethod:"cash",installmentId:"",paidAt:"",notes:""}},discDialog:{open:!1,invoiceId:null,form:{amount:null,notes:""}},paymentMethods:[{text:"نقد",value:"cash"},{text:"تحويل بنكي",value:"bank_transfer"},{text:"بطاقة",value:"card"}],saving:!1,deleteDialog:{open:!1,loading:!1,id:null,messages:[],title:null,confirmButtonText:null},restoreDialog:{open:!1,loading:!1,id:null,messages:[],title:null,confirmButtonText:null,checkboxLabel:null},alert:{open:!1,type:"success",message:""}}},created(){const i=JSON.parse(localStorage.getItem(this.keyName));i&&(i.filters&&(this.filters={...this.filters,...i.filters}),i.tableOptions&&(this.tableOptions={...this.tableOptions,...i.tableOptions})),this.loadAcademicYears()},methods:{reload(){localStorage.removeItem(this.keyName),this.filters={studyYear:"",status:"",deleted:!1},this.tableOptions={page:1,limit:10,search:null},this.loadAcademicYears()},numberWithComma:te,async loadAcademicYears(){var i;try{this.yearsLoading=!0;const e=await N.getAcademicYears(),n=((i=e==null?void 0:e.data)==null?void 0:i.data)||{},s=Array.isArray(n.years)?n.years:[],o=n.active||null;this.studyYears=s.map(m=>({label:m.year,value:m.year})),this.filters.studyYear||(this.filters.studyYear=(o==null?void 0:o.year)||""),await this.fetchInvoices()}catch{await this.fetchInvoices()}finally{this.yearsLoading=!1}},goToProfile(i){const e=i==null?void 0:i.id;e&&this.$router.push({path:`/teacher/invoices/${e}`,state:i})},async fetchInvoices(){var i,e;this.loadingTable=!0;try{const n={studyYear:this.filters.studyYear,status:this.filters.status,page:this.tableOptions.page,limit:this.tableOptions.limit};this.filters.deleted===!0&&(n.deleted=!0),localStorage.setItem(this.keyName,JSON.stringify({filters:this.filters,tableOptions:this.tableOptions}));const{data:s}=await N.listInvoices(n),o=(s==null?void 0:s.data)||[];this.totalItems=o.length,this.items=o.map((m,k)=>({...m,num:(this.tableOptions.page-1)*this.tableOptions.limit+k+1,detailsText:"تفاصيل",detailsLink:`/teacher/invoices/${m.id}`,is_deleted:typeof m.is_deleted<"u"?m.is_deleted:!!m.deleted_at})),this.fetchInvoicesReport()}catch(n){this.showAlert("error",((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||"تعذر جلب الفواتير")}finally{this.loadingTable=!1}},async fetchInvoicesReport(){var i,e;this.loadingTable=!0;try{const n={studyYear:this.filters.studyYear,status:this.filters.status,page:this.tableOptions.page,limit:this.tableOptions.limit};this.filters.deleted===!0&&(n.deleted=!0);const{data:s}=await N.getInvoicesSummary(n),o=(s==null?void 0:s.data)||null;o?this.report={studyYear:this.filters.studyYear||void 0,counts:{totalPaid:Number(o.paidCount||0),totalPending:Number(o.remainingCount||0),totalDiscounted:Number(o.discountCount||0)},totals:{totalAmount:Number(o.totalAmount||0),totalPaidAmount:Number(o.totalPaid||0),discountAmount:Number(o.totalDiscount||0),remainingAmount:Number(o.totalRemaining||0)}}:this.report=null}catch(n){this.showAlert("error",((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||"تعذر جلب الفواتير")}finally{this.loadingTable=!1}},onUpdateTableOptions(i){this.tableOptions={...this.tableOptions,...i},this.fetchInvoices()},openAddPayment(i){this.payDialog.invoiceId=i.id,this.payDialog.form={amount:null,paymentMethod:"cash",installmentId:"",paidAt:"",notes:""},this.payDialog.open=!0},async handleAddPayment(){var i,e;if(!this.payDialog.invoiceId||!this.payDialog.form.amount){this.showAlert("error","الرجاء إدخال مبلغ صحيح");return}this.saving=!0;try{const n={amount:Number(this.payDialog.form.amount),paymentMethod:this.payDialog.form.paymentMethod,installmentId:this.payDialog.form.installmentId||void 0,paidAt:this.payDialog.form.paidAt||void 0,notes:this.payDialog.form.notes||void 0,studyYear:this.filters.studyYear||void 0};await N.addInvoicePayment(this.payDialog.invoiceId,n),this.showAlert("success","تمت إضافة الدفعة"),this.payDialog.open=!1,this.fetchInvoices()}catch(n){this.showAlert("error",((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||"تعذر إضافة الدفعة")}finally{this.saving=!1}},openAddDiscount(i){this.discDialog.invoiceId=i.id,this.discDialog.form={amount:null,notes:""},this.discDialog.open=!0},openDeleteDialog(i){this.deleteDialog.id=(i==null?void 0:i.id)||null,this.deleteDialog.messages=["سيتم حذف الفاتورة حذفًا منطقيًا (Soft Delete).","يمكن استرجاعها لاحقًا من خلال عملية الاسترجاع."],this.deleteDialog.title="تأكيد الحذف",this.deleteDialog.confirmButtonText="حذف الفاتورة",this.deleteDialog.open=!!this.deleteDialog.id},openRestoreDialog(i){this.restoreDialog.id=(i==null?void 0:i.id)||null,this.restoreDialog.messages=["سيتم استرجاع الفاتورة مع أقساطها وقيودها.","ستتمكن من تعديلها واستخدامها كما كانت."],this.restoreDialog.title="تأكيد الاسترجاع",this.restoreDialog.confirmButtonText="استرجاع الفاتورة",this.restoreDialog.checkboxLabel="أفهم التحذير وأؤكد الاسترجاع",this.restoreDialog.open=!!this.restoreDialog.id},async handleDelete(){var i,e,n;if(this.deleteDialog.id){this.deleteDialog.loading=!0;try{const s=await N.softDeleteInvoice(this.deleteDialog.id);this.showAlert("success",((i=s==null?void 0:s.data)==null?void 0:i.message)||"تم الحذف"),this.deleteDialog.open=!1,this.fetchInvoices()}catch(s){this.showAlert("error",((n=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:n.message)||"تعذر الحذف")}finally{this.deleteDialog.loading=!1}}},async handleRestore(){var i,e,n;if(this.restoreDialog.id){this.restoreDialog.loading=!0;try{const s=await N.restoreInvoice(this.restoreDialog.id);this.showAlert("success",((i=s==null?void 0:s.data)==null?void 0:i.message)||"تم الاسترجاع"),this.restoreDialog.open=!1,this.fetchInvoices()}catch(s){this.showAlert("error",((n=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:n.message)||"تعذر الاسترجاع")}finally{this.restoreDialog.loading=!1}}},async handleAddDiscount(){var i,e;if(!this.discDialog.invoiceId||!this.discDialog.form.amount){this.showAlert("error","الرجاء إدخال مبلغ صحيح");return}this.saving=!0;try{const n={amount:Number(this.discDialog.form.amount),notes:this.discDialog.form.notes||void 0,studyYear:this.filters.studyYear||void 0};await N.addInvoiceDiscount(this.discDialog.invoiceId,n),this.showAlert("success","تمت إضافة الخصم"),this.discDialog.open=!1,this.fetchInvoices()}catch(n){this.showAlert("error",((e=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:e.message)||"تعذر إضافة الخصم")}finally{this.saving=!1}},openEditInvoice(i){i!=null&&i.id&&this.$router.push({path:`/teacher/invoices/edit/${i.id}`,state:i})},addEditInstallment(){this.editDialog.form.installments.push({installmentNumber:this.editDialog.form.installments.length+1,plannedAmount:null,dueDate:"",initialPaidAmount:0})},removeEditInstallment(i){this.editDialog.form.installments.splice(i,1)},addEditPayment(){this.editDialog.form.payments.push({amount:null,paymentMethod:"cash",installmentNumber:void 0,paidAt:"",notes:""})},removeEditPayment(i){this.editDialog.form.payments.splice(i,1)},addEditAdditionalDiscount(){this.editDialog.form.additionalDiscounts.push({amount:null,notes:""})},removeEditAdditionalDiscount(i){this.editDialog.form.additionalDiscounts.splice(i,1)},async handleUpdateInvoice(){var y,f,p;if(!this.editDialog.invoiceId)return;const i=this.editDialog.invoiceId,e=this.editDialog.form,n=this.editDialog.current,s={};if(e.dueDate===null)s.dueDate=null;else if(e.dueDate&&e.dueDate.trim()!==""){const d=new Date(e.dueDate+"T00:00:00Z").toISOString();s.dueDate=d}if(e.notes===null?s.notes=null:typeof e.notes=="string"&&e.notes.trim()!==""&&(s.notes=e.notes.trim()),e.invoiceType&&(s.invoiceType=e.invoiceType),e.paymentMode&&(s.paymentMode=e.paymentMode),e.amountDue!=null&&e.amountDue!==""){const d=Number(e.amountDue),r=Number(n.amountPaid)+Number(n.totalDiscount);if(isNaN(d)){this.showAlert("error","المبلغ المستحق غير صالح");return}if(d<r){this.showAlert("error",`المبلغ المستحق يجب ألا يقل عن مجموع المدفوع (${n.amountPaid}) + الخصومات (${n.totalDiscount})`);return}s.amountDue=d}if(Array.isArray(e.installments)&&e.installments.length>0){const d=[];for(const r of e.installments)if(r&&Number.isFinite(Number(r.installmentNumber))&&Number.isFinite(Number(r.plannedAmount))&&r.dueDate){const a=new Date(r.dueDate).toISOString();d.push({installmentNumber:Number(r.installmentNumber),plannedAmount:Number(r.plannedAmount),dueDate:a,...r.notes?{notes:String(r.notes)}:{},...r.initialPaidAmount!=null&&r.initialPaidAmount!==""?{initialPaidAmount:Number(r.initialPaidAmount)}:{}})}d.length>0&&(s.installments=d)}let o=0;if(Array.isArray(e.payments)&&e.payments.length>0){const d=[];for(const r of e.payments)if(r&&Number.isFinite(Number(r.amount))&&r.paymentMethod){const a={amount:Number(r.amount),paymentMethod:String(r.paymentMethod)};if(r.installmentNumber!=null&&r.installmentNumber!==""&&(a.installmentNumber=Number(r.installmentNumber)),r.paidAt){const x=r.paidAt.includes("T")?new Date(r.paidAt).toISOString():new Date(r.paidAt+"T00:00:00Z").toISOString();a.paidAt=x}r.notes&&(a.notes=String(r.notes)),o+=a.amount,d.push(a)}d.length>0&&(s.payments=d)}let m=0;if(Array.isArray(e.additionalDiscounts)&&e.additionalDiscounts.length>0){const d=[];for(const r of e.additionalDiscounts)if(r&&Number.isFinite(Number(r.amount))){const a={amount:Number(r.amount)};r.notes&&(a.notes=String(r.notes)),m+=a.amount,d.push(a)}d.length>0&&(s.additionalDiscounts=d)}(y=this.filters)!=null&&y.studyYear&&(s.studyYear=this.filters.studyYear);const k=Number(o)+Number(m);if(k>Number(n.remaining)){this.showAlert("error",`إجمالي الدفعات والخصومات الإضافية (${k}) يتجاوز المتبقي الحالي (${n.remaining})`);return}if(Object.keys(s).length===0){this.showAlert("error","لم يتم تحديد أي تعديل لإرساله");return}this.saving=!0;try{await N.updateInvoice(i,s),this.showAlert("success","تم تعديل الفاتورة بنجاح"),this.editDialog.open=!1,await this.fetchInvoices()}catch(d){this.showAlert("error",((p=(f=d==null?void 0:d.response)==null?void 0:f.data)==null?void 0:p.message)||"تعذر تعديل الفاتورة")}finally{this.saving=!1}},showAlert(i,e){Object.assign(this.alert,{open:!0,type:i,message:e})}}};function ue(i,e,n,s,o,m){const k=ee,y=J,f=$("RouterLink"),p=Z,d=j,r=W;return D(),P("div",null,[t(k,{items:o.breadcrumbItems},null,8,["items"]),e[43]||(e[43]=b("br",null,null,-1)),t(y,{report:o.report},null,8,["report"]),t(V,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:l(()=>[t(C,{class:"d-flex align-center py-4 px-6"},{default:l(()=>[t(w,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),e[24]||(e[24]=b("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),t(O),t(Y,null,{default:l(()=>[t(I,{class:"align-center justify-start pa-2"},{default:l(()=>[t(f,{to:{name:"teacher-invoices-create-invoice"}},{default:l(()=>[t(v,{color:"primary","prepend-icon":"ri-add-line"},{default:l(()=>e[25]||(e[25]=[g("إنشاء فاتورة")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(V,{class:"my-4",elevation:"3",rounded:"lg"},{default:l(()=>[t(C,{class:"d-flex align-center py-4 px-6"},{default:l(()=>[t(w,{icon:"ri-filter-3-line",color:"primary",class:"me-2",size:"24"}),e[26]||(e[26]=b("h3",{class:"text-h6 font-weight-bold"},"تصفية",-1)),t(M)]),_:1}),t(O),t(Y,null,{default:l(()=>[t(I,{class:"py-3"},{default:l(()=>[t(u,{cols:"12",md:"4"},{default:l(()=>[t(_,{modelValue:o.filters.studyYear,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.filters.studyYear=a),m.fetchInvoices],items:o.studyYears,"item-title":"label","item-value":"value",label:"السنة الدراسية",variant:"outlined",loading:o.yearsLoading},null,8,["modelValue","items","loading","onUpdate:modelValue"])]),_:1}),t(u,{cols:"12",md:"4"},{default:l(()=>[t(_,{modelValue:o.filters.status,"onUpdate:modelValue":[e[1]||(e[1]=a=>o.filters.status=a),m.fetchInvoices],items:o.statusItems,"item-title":"text","item-value":"value",label:"حالة الفاتورة",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(u,{cols:"12",md:"4",class:"d-flex align-center"},{default:l(()=>[t(_,{modelValue:o.filters.deleted,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.filters.deleted=a),m.fetchInvoices],items:o.deletedItems,"item-title":"text","item-value":"value",label:"حالة حذف الفاتورة",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(V,{class:"my-4",elevation:"3",rounded:"lg"},{default:l(()=>[t(C,{class:"py-4 px-6"},{default:l(()=>[t(I,{class:"align-center"},{default:l(()=>[t(u,{cols:"auto"},{default:l(()=>[t(v,{color:"primary",onClick:e[3]||(e[3]=a=>m.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small",class:"rotate-on-hover"})]),_:1}),t(u,null,{default:l(()=>e[27]||(e[27]=[b("h3",{class:"text-h5 font-weight-bold text-center"},"فواتير الطلاب",-1)])),_:1}),t(u,{cols:"auto",class:"d-flex gap-2"},{default:l(()=>[t(oe,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:l(()=>[g(U(m.numberWithComma(o.totalItems))+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(O),t(Y,null,{default:l(()=>[t(p,{headers:o.headers,items:o.items,actions:o.tableActions,loading:o.loadingTable,totalItems:o.totalItems,tableOptions:o.tableOptions,onUpdateTableOptions:m.onUpdateTableOptions,onEditItem:m.openEditInvoice,onUpdateResponseItem:m.openAddDiscount,onDeleteItem:m.openDeleteDialog,onEnableItem:m.openRestoreDialog,onShowItem:m.goToProfile},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onEditItem","onUpdateResponseItem","onDeleteItem","onEnableItem","onShowItem"])]),_:1})]),_:1}),t(R,{modelValue:o.payDialog.open,"onUpdate:modelValue":e[10]||(e[10]=a=>o.payDialog.open=a),"max-width":"520"},{default:l(()=>[t(V,{title:"إضافة دفعة"},{default:l(()=>[t(S,null,{default:l(()=>[t(I,null,{default:l(()=>[t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.payDialog.form.amount,"onUpdate:modelValue":e[4]||(e[4]=a=>o.payDialog.form.amount=a),modelModifiers:{number:!0},type:"number",label:"المبلغ",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(_,{modelValue:o.payDialog.form.paymentMethod,"onUpdate:modelValue":e[5]||(e[5]=a=>o.payDialog.form.paymentMethod=a),items:o.paymentMethods,"item-title":"text","item-value":"value",label:"طريقة الدفع",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.payDialog.form.paidAt,"onUpdate:modelValue":e[6]||(e[6]=a=>o.payDialog.form.paidAt=a),type:"datetime-local",label:"تاريخ الدفع",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.payDialog.form.installmentId,"onUpdate:modelValue":e[7]||(e[7]=a=>o.payDialog.form.installmentId=a),label:"معرّف القسط (اختياري)",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.payDialog.form.notes,"onUpdate:modelValue":e[8]||(e[8]=a=>o.payDialog.form.notes=a),label:"ملاحظات",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(L,null,{default:l(()=>[t(v,{onClick:e[9]||(e[9]=a=>o.payDialog.open=!1)},{default:l(()=>e[28]||(e[28]=[g("إلغاء")])),_:1}),t(v,{color:"primary",loading:o.saving,onClick:m.handleAddPayment},{default:l(()=>e[29]||(e[29]=[g("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o.restoreDialog.open?(D(),A(d,{key:0,modelValue:o.restoreDialog.open,"onUpdate:modelValue":e[11]||(e[11]=a=>o.restoreDialog.open=a),messages:o.restoreDialog.messages,title:o.restoreDialog.title,confirmButtonText:o.restoreDialog.confirmButtonText,checkboxLabel:o.restoreDialog.checkboxLabel,onConfirm:m.handleRestore},null,8,["modelValue","messages","title","confirmButtonText","checkboxLabel","onConfirm"])):T("",!0),o.deleteDialog.open?(D(),A(d,{key:1,modelValue:o.deleteDialog.open,"onUpdate:modelValue":e[12]||(e[12]=a=>o.deleteDialog.open=a),messages:o.deleteDialog.messages,title:o.deleteDialog.title,confirmButtonText:o.deleteDialog.confirmButtonText,onConfirm:m.handleDelete},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"])):T("",!0),t(R,{modelValue:o.editDialog.open,"onUpdate:modelValue":e[21]||(e[21]=a=>o.editDialog.open=a),"max-width":"520"},{default:l(()=>[t(V,{title:"تعديل الفاتورة"},{default:l(()=>[t(S,null,{default:l(()=>[t(I,null,{default:l(()=>[t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.editDialog.form.dueDate,"onUpdate:modelValue":e[13]||(e[13]=a=>o.editDialog.form.dueDate=a),type:"date",label:"تاريخ الاستحقاق",variant:"outlined",hint:"اتركه فارغًا لإبقاءه كما هو، أو احذف القيمة (null) من زر أدناه","persistent-hint":""},null,8,["modelValue"]),t(v,{variant:"text",size:"small",onClick:e[14]||(e[14]=a=>o.editDialog.form.dueDate=null)},{default:l(()=>e[30]||(e[30]=[g("إزالة التاريخ (null)")])),_:1})]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.editDialog.form.notes,"onUpdate:modelValue":e[15]||(e[15]=a=>o.editDialog.form.notes=a),label:"ملاحظات",variant:"outlined",hint:"اتركه فارغًا لإبقاءه كما هو، أو اضغط إزالة لمسح القيمة (null)","persistent-hint":""},null,8,["modelValue"]),t(v,{variant:"text",size:"small",onClick:e[16]||(e[16]=a=>o.editDialog.form.notes=null)},{default:l(()=>e[31]||(e[31]=[g("إزالة الملاحظات (null)")])),_:1})]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(_,{modelValue:o.editDialog.form.invoiceType,"onUpdate:modelValue":e[17]||(e[17]=a=>o.editDialog.form.invoiceType=a),items:[{text:"عربون حجز",value:"reservation"},{text:"كورس",value:"course"},{text:"قسط",value:"installment"},{text:"غرامة",value:"penalty"}],"item-title":"text","item-value":"value",label:"نوع الفاتورة",variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(_,{modelValue:o.editDialog.form.paymentMode,"onUpdate:modelValue":e[18]||(e[18]=a=>o.editDialog.form.paymentMode=a),items:[{text:"كاش",value:"cash"},{text:"أقساط",value:"installments"}],"item-title":"text","item-value":"value",label:"طريقة الدفع",variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:o.editDialog.form.amountDue,"onUpdate:modelValue":e[19]||(e[19]=a=>o.editDialog.form.amountDue=a),modelModifiers:{number:!0},type:"number",label:"المبلغ المستحق",variant:"outlined",hint:"يجب ألا يقل عن مجموع (المدفوع + الخصومات) الحالية","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),t(V,{variant:"tonal",class:"mt-4"},{default:l(()=>[t(C,{class:"d-flex align-center"},{default:l(()=>[t(w,{icon:"ri-calendar-schedule-line",class:"me-2"}),e[33]||(e[33]=g(" خطة الأقساط (اختياري) ")),t(M),t(v,{size:"small",variant:"tonal","prepend-icon":"ri-add-line",onClick:m.addEditInstallment},{default:l(()=>e[32]||(e[32]=[g("إضافة قسط")])),_:1},8,["onClick"])]),_:1}),t(O),t(S,null,{default:l(()=>[o.editDialog.form.installments.length?T("",!0):(D(),A(E,{key:0,type:"info",variant:"tonal"},{default:l(()=>e[34]||(e[34]=[g("لا يوجد أقساط")])),_:1})),(D(!0),P(B,null,F(o.editDialog.form.installments,(a,x)=>(D(),A(I,{key:x,class:"mb-1"},{default:l(()=>[t(u,{cols:"12",md:"2"},{default:l(()=>[t(h,{modelValue:a.installmentNumber,"onUpdate:modelValue":c=>a.installmentNumber=c,modelModifiers:{number:!0},type:"number",label:"# القسط",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"3"},{default:l(()=>[t(h,{modelValue:a.plannedAmount,"onUpdate:modelValue":c=>a.plannedAmount=c,modelModifiers:{number:!0},type:"number",label:"المبلغ المخطط",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"3"},{default:l(()=>[t(h,{modelValue:a.dueDate,"onUpdate:modelValue":c=>a.dueDate=c,type:"date",label:"تاريخ الاستحقاق",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"3"},{default:l(()=>[t(h,{modelValue:a.initialPaidAmount,"onUpdate:modelValue":c=>a.initialPaidAmount=c,modelModifiers:{number:!0},type:"number",label:"مدفوع ابتدائي",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"1",class:"d-flex align-center"},{default:l(()=>[t(v,{color:"error",size:"small",icon:"ri-delete-bin-line",variant:"text",onClick:c=>m.removeEditInstallment(x)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(V,{variant:"tonal",class:"mt-4"},{default:l(()=>[t(C,{class:"d-flex align-center"},{default:l(()=>[t(w,{icon:"ri-money-dollar-circle-line",class:"me-2"}),e[36]||(e[36]=g(" دفعات إضافية (اختياري) ")),t(M),t(v,{size:"small",variant:"tonal","prepend-icon":"ri-add-line",onClick:m.addEditPayment},{default:l(()=>e[35]||(e[35]=[g("إضافة دفعة")])),_:1},8,["onClick"])]),_:1}),t(O),t(S,null,{default:l(()=>[o.editDialog.form.payments.length?T("",!0):(D(),A(E,{key:0,type:"info",variant:"tonal"},{default:l(()=>e[37]||(e[37]=[g("لا يوجد دفعات")])),_:1})),(D(!0),P(B,null,F(o.editDialog.form.payments,(a,x)=>(D(),A(I,{key:x,class:"mb-1"},{default:l(()=>[t(u,{cols:"12",md:"3"},{default:l(()=>[t(h,{modelValue:a.amount,"onUpdate:modelValue":c=>a.amount=c,modelModifiers:{number:!0},type:"number",label:"المبلغ",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"3"},{default:l(()=>[t(_,{modelValue:a.paymentMethod,"onUpdate:modelValue":c=>a.paymentMethod=c,items:o.paymentMethods,"item-title":"text","item-value":"value",label:"طريقة الدفع",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(u,{cols:"12",md:"3"},{default:l(()=>[t(h,{modelValue:a.paidAt,"onUpdate:modelValue":c=>a.paidAt=c,type:"datetime-local",label:"تاريخ الدفع",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"2"},{default:l(()=>[t(h,{modelValue:a.installmentNumber,"onUpdate:modelValue":c=>a.installmentNumber=c,modelModifiers:{number:!0},type:"number",label:"# القسط (اختياري)",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"1",class:"d-flex align-center"},{default:l(()=>[t(v,{color:"error",size:"small",icon:"ri-delete-bin-line",variant:"text",onClick:c=>m.removeEditPayment(x)},null,8,["onClick"])]),_:2},1024),t(u,{cols:"12"},{default:l(()=>[t(h,{modelValue:a.notes,"onUpdate:modelValue":c=>a.notes=c,label:"ملاحظات",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(V,{variant:"tonal",class:"mt-4"},{default:l(()=>[t(C,{class:"d-flex align-center"},{default:l(()=>[t(w,{icon:"ri-price-tag-3-line",class:"me-2"}),e[39]||(e[39]=g(" خصومات إضافية (اختياري) ")),t(M),t(v,{size:"small",variant:"tonal","prepend-icon":"ri-add-line",onClick:m.addEditAdditionalDiscount},{default:l(()=>e[38]||(e[38]=[g("إضافة خصم ")])),_:1},8,["onClick"])]),_:1}),t(O),t(S,null,{default:l(()=>[o.editDialog.form.additionalDiscounts.length?T("",!0):(D(),A(E,{key:0,type:"info",variant:"tonal"},{default:l(()=>e[40]||(e[40]=[g("لا يوجد خصومات ")])),_:1})),(D(!0),P(B,null,F(o.editDialog.form.additionalDiscounts,(a,x)=>(D(),A(I,{key:x,class:"mb-1"},{default:l(()=>[t(u,{cols:"12",md:"4"},{default:l(()=>[t(h,{modelValue:a.amount,"onUpdate:modelValue":c=>a.amount=c,modelModifiers:{number:!0},type:"number",label:"المبلغ",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"7"},{default:l(()=>[t(h,{modelValue:a.notes,"onUpdate:modelValue":c=>a.notes=c,label:"ملاحظات",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(u,{cols:"12",md:"1",class:"d-flex align-center"},{default:l(()=>[t(v,{color:"error",size:"small",icon:"ri-delete-bin-line",variant:"text",onClick:c=>m.removeEditAdditionalDiscount(x)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(L,null,{default:l(()=>[t(v,{variant:"text",onClick:e[20]||(e[20]=a=>o.editDialog.open=!1)},{default:l(()=>e[41]||(e[41]=[g("إلغاء")])),_:1}),t(v,{color:"primary",loading:o.saving,onClick:m.handleUpdateInvoice},{default:l(()=>e[42]||(e[42]=[g("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o.alert.open?(D(),A(r,{key:2,modelValue:o.alert.open,"onUpdate:modelValue":e[22]||(e[22]=a=>o.alert.open=a),type:o.alert.type,message:o.alert.message,closable:!0,"close-text":"موافق",onClose:e[23]||(e[23]=a=>o.alert.open=!1)},null,8,["modelValue","type","message"])):T("",!0)])}const ze=le(de,[["render",ue]]);export{ze as default};
