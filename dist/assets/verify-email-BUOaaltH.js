import{k as U,l as q,r as p,c as E,o as g,b as t,e as s,s as f,f as x,n as C,i as n,b0 as w,t as _,C as F,b1 as y,v as k,V as $}from"./index-N2EhsRQt.js";import{A as S}from"./auth_api-BZWltAHM.js";import{a as j,V as D}from"./VCard-CTAW927Q.js";import{V as M}from"./VCardText-Q2eeque7.js";import{V as z}from"./VForm-QByy8A-i.js";import{V as G,a as V}from"./VRow--YcB0Yd0.js";import"./axios-CK0PAUQZ.js";import"./VAvatar-M6cRQjPV.js";import"./VImg-DOYF3Gzb.js";const H={class:"d-flex align-center justify-center min-vh-100"},Z={__name:"verify-email",setup(I){var b;const B=U(),R=q(),o=p({email:((b=R.query)==null?void 0:b.email)||"",code:"",verificationToken:""}),m=p(!1),r=p(""),u=p(""),A=async()=>{var d,a,i,c;try{u.value="",r.value="",m.value=!0;const e={email:o.value.email};if(o.value.code&&(e.code=String(o.value.code)),o.value.verificationToken&&(e.verificationToken=String(o.value.verificationToken)),!e.code&&!e.verificationToken){u.value="يرجى إدخال رمز التحقق";return}const l=await S.verifyEmail(e),v=((d=l==null?void 0:l.data)==null?void 0:d.success)||(l==null?void 0:l.success),T=((a=l==null?void 0:l.data)==null?void 0:a.message)||(l==null?void 0:l.message)||"تم تفعيل الحساب بنجاح";v?(r.value=T,setTimeout(()=>B.push({path:"/login",query:{email:o.value.email}}),1200)):u.value=T||"تعذر تفعيل الحساب"}catch(e){const l=((c=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:c.message)||(e==null?void 0:e.message);u.value=l||"تعذر تفعيل الحساب"}finally{m.value=!1}},N=async()=>{var d,a,i,c;try{if(u.value="",r.value="",!o.value.email){u.value="يرجى إدخال البريد الإلكتروني";return}m.value=!0;const e=await S.resendVerification({email:o.value.email}),l=((d=e==null?void 0:e.data)==null?void 0:d.success)||(e==null?void 0:e.success),v=((a=e==null?void 0:e.data)==null?void 0:a.message)||(e==null?void 0:e.message)||"تم إرسال رمز التحقق إلى بريدك";l?r.value=v:u.value=v||"تعذر إرسال رمز التحقق"}catch(e){const l=((c=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:c.message)||(e==null?void 0:e.message);u.value=l||"تعذر إرسال رمز التحقق"}finally{m.value=!1}};return(d,a)=>(g(),E("div",H,[t(D,{"max-width":"520",class:"pa-6 w-100"},{default:s(()=>[t(j,{class:"text-center"},{default:s(()=>a[5]||(a[5]=[f("تفعيل الحساب")])),_:1}),t(M,null,{default:s(()=>[n(u)?(g(),x(w,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":a[0]||(a[0]=i=>u.value="")},{default:s(()=>[f(_(n(u)),1)]),_:1})):C("",!0),n(r)?(g(),x(w,{key:1,type:"success",variant:"tonal",class:"mb-4",closable:"","onClick:close":a[1]||(a[1]=i=>r.value="")},{default:s(()=>[f(_(n(r)),1)]),_:1})):C("",!0),t(z,{onSubmit:F(A,["prevent"])},{default:s(()=>[t(G,null,{default:s(()=>[t(V,{cols:"12"},{default:s(()=>[t(y,{modelValue:n(o).email,"onUpdate:modelValue":a[2]||(a[2]=i=>n(o).email=i),type:"email",label:"البريد الإلكتروني"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",md:"6"},{default:s(()=>[t(y,{modelValue:n(o).code,"onUpdate:modelValue":a[3]||(a[3]=i=>n(o).code=i),label:"رمز التحقق (6 أرقام)"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",md:"6"},{default:s(()=>[t(y,{modelValue:n(o).verificationToken,"onUpdate:modelValue":a[4]||(a[4]=i=>n(o).verificationToken=i),label:"رمز بديل (إن وجد)"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",class:"d-flex gap-2"},{default:s(()=>[t(k,{type:"submit",loading:n(m),color:"primary"},{default:s(()=>a[6]||(a[6]=[f("تفعيل")])),_:1},8,["loading"]),t(k,{variant:"text",loading:n(m),onClick:N},{default:s(()=>a[7]||(a[7]=[f("إعادة إرسال الرمز")])),_:1},8,["loading"]),t($),t(k,{variant:"tonal",to:"/login"},{default:s(()=>a[8]||(a[8]=[f("عودة لتسجيل الدخول")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{Z as default};
