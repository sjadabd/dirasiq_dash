import{_ as H}from"./BaseAlert-DMDZYgBb.js";import{_ as K}from"./ConfirmDangerDialog-DiOiWQFz.js";import{_ as M}from"./AppDateTimePicker-BoMQEPRl.js";import v from"./teacher_api-DSYadeDI.js";import{f as c,o as d,e as a,b as s,d as w,p,n as b,a_ as y,C as x,D as P,s as f,c as F,F as j,x as N,v as _,V as G,t as Q}from"./index-DzRnBGoW.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as D,a as S,b as B,c as C}from"./VCard-DkKUq9Xw.js";import{V as k}from"./VDivider-DOU2dJa1.js";import{V as q}from"./VCardText-DxpVkpnf.js";import{V as E}from"./VContainer-DDIA6_I2.js";import{V as L}from"./VForm-Bv_PGfyt.js";import{V,a as u}from"./VRow-1sXKMjVm.js";import{V as A}from"./VSelect-DPU1_UF_.js";import{V as z}from"./VSwitch-MDDF1eQ7.js";import{V as J}from"./VTextarea-DEXJEkcd.js";import{V as Y}from"./VFileInput-DEnEgZEx.js";import{V as T}from"./VImg-DAcp9xse.js";import{V as R}from"./VDialog-B-d6xDxs.js";import{_ as X}from"./SmartTable-DRD1z7i0.js";import{_ as Z}from"./AppBreadcrumbs-5PWjj0AR.js";import{n as $}from"./number-DRUmGIrN.js";import{V as ee}from"./VChip-BxDWJl9X.js";import"./axios-CwDcW8lj.js";import"./VAvatar-gDhFptrY.js";import"./VList-C_vO-TC7.js";import"./VDataTable-DKHI-dYN.js";import"./VPagination-DPnje41R.js";import"./VTable-CGzAcL7O.js";import"./filter-BD0O1YfX.js";import"./VTooltip-CZZ_rwxI.js";const te={name:"EditCourse",props:{modelValue:{type:Boolean,default:!1},courseData:{type:Object,required:!0}},emits:["update:modelValue","close","dataUpdated","error","showAlert"],data(){return{loading:!1,loadingGrades:!1,loadingSubjects:!1,isDragOver:!1,selectedFiles:[],imagesPreviews:[],existingImages:[],grades:[],subjects:[],formData:{course_name:null,grade_id:null,subject_id:null,description:null,start_date:null,end_date:null,price:null,seats_count:null,has_reservation:!1,reservation_amount:null}}},computed:{dialog:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},rules(){const t=e=>{if(e===""||e===null||typeof e>"u")return null;const i=String(e).replace(/[^0-9.-]/g,""),n=Number(i);return isFinite(n)?n:null};return{required:[e=>!!e||"هذا الحقل مطلوب"],price:[e=>t(e)!=null||"هذا الحقل مطلوب",e=>(t(e)??0)>=1e4||"السعر يجب أن لا يقل عن 10000 دينار"],seats:[e=>!!e||"هذا الحقل مطلوب",e=>Number(e)>0||"عدد المقاعد يجب أن يكون أكبر من صفر"],reservation:[e=>!this.formData.has_reservation||t(e)!=null||"هذا الحقل مطلوب",e=>!this.formData.has_reservation||(t(e)??0)>=1e4||"مبلغ العربون يجب أن لا يقل عن 10000 دينار"]}}},watch:{modelValue(t){t&&(this.populateForm(),this.fetchGrades(),this.fetchSubjects())},selectedFiles(t){t&&t.length>0&&(this.imagesPreviews=[],this.processFiles(t))},courseData:{handler(){this.modelValue&&this.populateForm()},deep:!0},"formData.has_reservation"(t){t||(this.formData.reservation_amount=null)}},created(){this.populateForm(),this.fetchGrades(),this.fetchSubjects()},methods:{formatMoney(t){if(t===""||t===null||typeof t>"u")return"";const e=Number(t);return isFinite(e)?e.toLocaleString():String(t)},parseMoney(t){if(t===""||t===null||typeof t>"u")return null;const e=String(t).replace(/[^0-9.-]/g,""),i=Number(e);return isFinite(i)?i:null},onFormatMoney(t,e){const i=this.parseMoney(e);this.formData[t]=i},populateForm(){if(this.courseData){const t=i=>i?new Date(i).toISOString().split("T")[0]:null,e=i=>i?parseFloat(i):null;this.formData={course_name:this.courseData.course_name||null,grade_id:this.courseData.grade_id||null,subject_id:this.courseData.subject_id||null,description:this.courseData.description||null,start_date:t(this.courseData.start_date),end_date:t(this.courseData.end_date),price:e(this.courseData.price),seats_count:this.courseData.seats_count||null,has_reservation:!!this.courseData.has_reservation,reservation_amount:this.courseData.reservation_amount!=null?parseFloat(this.courseData.reservation_amount):null},this.existingImages=this.courseData.course_images||[],this.selectedFiles=[],this.imagesPreviews=[]}},resetForm(){this.formData={course_name:null,grade_id:null,subject_id:null,description:null,start_date:null,end_date:null,price:null,seats_count:null,has_reservation:!1,reservation_amount:null},this.selectedFiles=[],this.imagesPreviews=[],this.existingImages=[],this.isDragOver=!1},closeDialog(){this.$emit("close")},async fetchGrades(){this.loadingGrades=!0;try{const t=await v.getAllMyGrades();this.grades=t.data.data.grades||t.data||[]}catch{this.$emit("showAlert","error","خطأ في جلب المراحل الدراسية")}finally{this.loadingGrades=!1}},async fetchSubjects(){this.loadingSubjects=!0;try{const t=await v.getAllSubjects();this.subjects=t.data.data||t.data||[]}catch{this.$emit("showAlert","error","خطأ في جلب المواد")}finally{this.loadingSubjects=!1}},handleDrop(t){this.isDragOver=!1;const e=Array.from(t.dataTransfer.files);this.selectedFiles=e,this.processFiles(e)},processFiles(t){t.forEach(e=>{if(e.type.startsWith("image/")){const i=new FileReader;i.onload=n=>{this.imagesPreviews.push({url:n.target.result,base64:n.target.result,name:e.name})},i.readAsDataURL(e)}})},removeExistingImage(t){this.existingImages.splice(t,1)},removeNewImage(t){this.imagesPreviews.splice(t,1),this.selectedFiles[t]&&this.selectedFiles.splice(t,1)},async updateCourse(){var e,i,n;const{valid:t}=await this.$refs.courseForm.validate();if(t){if(this.existingImages.length===0&&this.imagesPreviews.length===0){this.$emit("showAlert","error","يجب أن تحتوي المادة على صورة واحدة على الأقل");return}this.loading=!0;try{const l=JSON.parse(localStorage.getItem("studyYear")),r=[...this.existingImages,...this.imagesPreviews.map(g=>g.base64)],h={study_year:l,grade_id:this.formData.grade_id,subject_id:this.formData.subject_id,course_name:this.formData.course_name,course_images:r,description:this.formData.description,start_date:this.formData.start_date,end_date:this.formData.end_date,price:this.formData.price!=null?Number(this.formData.price):null,seats_count:this.formData.seats_count,has_reservation:this.formData.has_reservation,reservation_amount:this.formData.has_reservation&&this.formData.reservation_amount!=null?Number(this.formData.reservation_amount):null},o=await v.editCourse(this.courseData.id,h);this.$emit("dataAdded",o.data.message||"تم تحديث الكورس بنجاح"),this.closeDialog()}catch(l){let r="حدث خطأ أثناء تحديث الكورس";((e=l.response)==null?void 0:e.status)===401?r="غير مصرح لك بالعملية":(n=(i=l.response)==null?void 0:i.data)!=null&&n.message&&(r=l.response.data.message),this.$emit("showAlert","error",r)}finally{this.loading=!1}}}}};function le(t,e,i,n,l,r){const h=M;return d(),c(R,{modelValue:r.dialog,"onUpdate:modelValue":e[13]||(e[13]=o=>r.dialog=o),"max-width":"1000px"},{default:a(()=>[s(D,null,{default:a(()=>[s(S,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[s(p,{icon:"ri-edit-line",color:"primary",class:"me-2",size:"24"}),e[14]||(e[14]=w("h3",{class:"text-h5 font-weight-bold"},"تعديل الكورس",-1))]),_:1}),s(k),s(q,null,{default:a(()=>[s(E,null,{default:a(()=>[s(L,{ref:"courseForm"},{default:a(()=>[s(V,null,{default:a(()=>[s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{modelValue:l.formData.course_name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.formData.course_name=o),rules:r.rules.required,label:"اسم الكورس",outlined:""},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(A,{modelValue:l.formData.grade_id,"onUpdate:modelValue":e[1]||(e[1]=o=>l.formData.grade_id=o),items:l.grades,rules:r.rules.required,"item-title":"gradeName","item-value":"gradeId",label:"المرحلة الدراسية",outlined:"",loading:l.loadingGrades},null,8,["modelValue","items","rules","loading"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(A,{modelValue:l.formData.subject_id,"onUpdate:modelValue":e[2]||(e[2]=o=>l.formData.subject_id=o),items:l.subjects,rules:r.rules.required,"item-title":"name","item-value":"id",label:"المادة",outlined:"",loading:l.loadingSubjects},null,8,["modelValue","items","rules","loading"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{"model-value":r.formatMoney(l.formData.price),"onUpdate:modelValue":e[3]||(e[3]=o=>r.onFormatMoney("price",o)),rules:r.rules.price,label:"السعر (دينار عراقي)",hint:"رجاءً اكتب المبلغ كاملاً مع الأصفار، مثال: 250,000 وليس 250","persistent-hint":"",outlined:""},null,8,["model-value","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(h,{modelValue:l.formData.start_date,"onUpdate:modelValue":e[4]||(e[4]=o=>l.formData.start_date=o),rules:r.rules.required,label:"تاريخ البداية",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(h,{modelValue:l.formData.end_date,"onUpdate:modelValue":e[5]||(e[5]=o=>l.formData.end_date=o),rules:r.rules.required,label:"تاريخ النهاية",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{modelValue:l.formData.seats_count,"onUpdate:modelValue":e[6]||(e[6]=o=>l.formData.seats_count=o),modelModifiers:{number:!0},rules:r.rules.seats,label:"عدد المقاعد",type:"number",outlined:""},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(z,{modelValue:l.formData.has_reservation,"onUpdate:modelValue":e[7]||(e[7]=o=>l.formData.has_reservation=o),inset:"",color:"primary","true-value":!0,"false-value":!1,label:"هل يوجد عربون؟"},null,8,["modelValue"])]),_:1}),l.formData.has_reservation?(d(),c(u,{key:0,cols:"12",md:"6"},{default:a(()=>[s(y,{"model-value":r.formatMoney(l.formData.reservation_amount),"onUpdate:modelValue":e[8]||(e[8]=o=>r.onFormatMoney("reservation_amount",o)),rules:r.rules.reservation,label:"مبلغ العربون (دينار عراقي)",hint:"رجاءً اكتب مبلغ العربون كاملاً مع الأصفار، مثال: 100,000 وليس 100","persistent-hint":"",outlined:""},null,8,["model-value","rules"])]),_:1})):b("",!0),s(u,{cols:"12"},{default:a(()=>[s(J,{modelValue:l.formData.description,"onUpdate:modelValue":e[9]||(e[9]=o=>l.formData.description=o),rules:r.rules.required,label:"وصف الكورس",outlined:"",rows:"3"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12"},{default:a(()=>[s(D,{class:P(["pa-4",{"drag-over":l.isDragOver}]),onDragover:e[11]||(e[11]=x(o=>l.isDragOver=!0,["prevent"])),onDragleave:e[12]||(e[12]=x(o=>l.isDragOver=!1,["prevent"])),onDrop:x(r.handleDrop,["prevent"])},{default:a(()=>[s(S,{class:"text-subtitle-1 pb-2"},{default:a(()=>[s(p,{icon:"ri-image-line",class:"me-2"}),e[15]||(e[15]=f(" صور الكورس "))]),_:1}),s(Y,{modelValue:l.selectedFiles,"onUpdate:modelValue":e[10]||(e[10]=o=>l.selectedFiles=o),accept:"image/*",multiple:"",label:"اختر صور جديدة (اختياري)","prepend-icon":"ri-camera-line",variant:"outlined"},null,8,["modelValue"]),l.existingImages.length>0?(d(),c(V,{key:0,class:"mt-4"},{default:a(()=>[s(u,{cols:"12"},{default:a(()=>e[16]||(e[16]=[w("div",{class:"text-subtitle-1 px-0 mb-2"}," الصور الحالية: ",-1)])),_:1}),(d(!0),F(j,null,N(l.existingImages,(o,g)=>(d(),c(u,{key:`existing-${g}`,cols:"6",md:"3"},{default:a(()=>[s(D,{class:"position-relative"},{default:a(()=>[s(T,{src:"https://api.mulhimiq.com"+o,height:"120",cover:"",class:"rounded"},null,8,["src"]),s(_,{icon:"",size:"small",color:"error",class:"position-absolute",style:{"inset-block-start":"8px","inset-inline-end":"8px"},onClick:I=>r.removeExistingImage(g)},{default:a(()=>[s(p,{size:"16"},{default:a(()=>e[17]||(e[17]=[f("ri-close-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0),l.imagesPreviews.length>0?(d(),c(V,{key:1,class:"mt-4"},{default:a(()=>[s(u,{cols:"12"},{default:a(()=>e[18]||(e[18]=[w("div",{class:"text-subtitle-1 px-0 mb-2"},"صور جديدة:",-1)])),_:1}),(d(!0),F(j,null,N(l.imagesPreviews,(o,g)=>(d(),c(u,{key:`new-${g}`,cols:"6",md:"3"},{default:a(()=>[s(D,{class:"position-relative"},{default:a(()=>[s(T,{src:o.url,height:"120",cover:"",class:"rounded"},null,8,["src"]),s(_,{icon:"",size:"small",color:"error",class:"position-absolute",style:{"inset-block-start":"8px","inset-inline-end":"8px"},onClick:I=>r.removeNewImage(g)},{default:a(()=>[s(p,{size:"16"},{default:a(()=>e[19]||(e[19]=[f("ri-close-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0)]),_:1},8,["class","onDrop"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),s(B,{class:"px-6 pb-4"},{default:a(()=>[s(G),s(_,{color:"grey",variant:"outlined",onClick:r.closeDialog,disabled:l.loading},{default:a(()=>[s(p,{start:""},{default:a(()=>e[20]||(e[20]=[f("ri-close-line")])),_:1}),e[21]||(e[21]=f(" الغاء "))]),_:1},8,["onClick","disabled"]),s(_,{color:"primary",loading:l.loading,onClick:r.updateCourse,variant:"elevated"},{default:a(()=>[s(p,{start:""},{default:a(()=>e[22]||(e[22]=[f("ri-save-line")])),_:1}),e[23]||(e[23]=f(" تحديث الكورس "))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const se=U(te,[["render",le],["__scopeId","data-v-7a33385a"]]),ae={name:"AddCourseDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","close","dataAdded","error","showAlert"],data(){return{loading:!1,loadingGrades:!1,loadingSubjects:!1,isDragOver:!1,selectedFiles:[],imagesPreviews:[],grades:[],subjects:[],formData:{course_name:null,grade_id:null,subject_id:null,description:null,start_date:null,end_date:null,price:null,seats_count:null,has_reservation:!1,reservation_amount:null}}},computed:{dialog:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},rules(){const t=e=>{if(e===""||e===null||typeof e>"u")return null;const i=String(e).replace(/[^0-9.-]/g,""),n=Number(i);return isFinite(n)?n:null};return{required:[e=>!!e||"هذا الحقل مطلوب"],price:[e=>t(e)!=null||"هذا الحقل مطلوب",e=>(t(e)??0)>=1e4||"السعر يجب أن لا يقل عن 10000 دينار"],seats:[e=>!!e||"هذا الحقل مطلوب",e=>Number(e)>0||"عدد المقاعد يجب أن يكون أكبر من صفر"],reservation:[e=>!this.formData.has_reservation||t(e)!=null||"هذا الحقل مطلوب",e=>!this.formData.has_reservation||(t(e)??0)>=1e4||"مبلغ العربون يجب أن لا يقل عن 10000 دينار"]}}},watch:{modelValue(t){t&&(this.resetForm(),this.fetchGrades(),this.fetchSubjects())},selectedFiles(t){t&&t.length>0&&(this.imagesPreviews=[],this.processFiles(t))},"formData.has_reservation"(t){t||(this.formData.reservation_amount=null)}},created(){this.resetForm(),this.fetchGrades(),this.fetchSubjects()},methods:{formatMoney(t){if(t===""||t===null||typeof t>"u")return"";const e=Number(t);return isFinite(e)?e.toLocaleString():String(t)},parseMoney(t){if(t===""||t===null||typeof t>"u")return null;const e=String(t).replace(/[^0-9.-]/g,""),i=Number(e);return isFinite(i)?i:null},onFormatMoney(t,e){const i=this.parseMoney(e);this.formData[t]=i},resetForm(){this.formData={course_name:null,grade_id:null,subject_id:null,description:null,start_date:null,end_date:null,price:null,seats_count:null,has_reservation:!1,reservation_amount:null},this.selectedFiles=[],this.imagesPreviews=[],this.isDragOver=!1},closeDialog(){this.resetForm(),this.$emit("close")},async fetchGrades(){this.loadingGrades=!0;try{const t=await v.getAllMyGrades();this.grades=t.data.data.grades||t.data||[]}catch{this.$emit("showAlert","error","خطأ في جلب المراحل الدراسية")}finally{this.loadingGrades=!1}},async fetchSubjects(){this.loadingSubjects=!0;try{const t=await v.getAllSubjects();this.subjects=t.data.data||t.data||[]}catch{this.$emit("showAlert","error","خطأ في جلب المواد")}finally{this.loadingSubjects=!1}},handleFileSelect(t){const e=t.target.files;e&&e.length>0&&(this.imagesPreviews=[],this.processFiles(Array.from(e)))},handleDrop(t){this.isDragOver=!1;const e=Array.from(t.dataTransfer.files);this.selectedFiles=e,this.processFiles(e)},processFiles(t){t.forEach((e,i)=>{if(e.type.startsWith("image/")){const n=new FileReader;n.onload=l=>{this.imagesPreviews.push({url:l.target.result,base64:l.target.result,name:e.name})},n.onerror=l=>{console.error("[v0] Error reading file:",l)},n.readAsDataURL(e)}else console.warn("[v0] Skipped non-image file:",e.name)})},removeImage(t){this.imagesPreviews.splice(t,1),this.selectedFiles[t]&&this.selectedFiles.splice(t,1)},async saveCourse(){var e,i,n;const{valid:t}=await this.$refs.courseForm.validate();if(t){this.loading=!0;try{const l=JSON.parse(localStorage.getItem("studyYear")),r=this.imagesPreviews.map(g=>g.base64),h={study_year:l,grade_id:this.formData.grade_id,subject_id:this.formData.subject_id,course_name:this.formData.course_name,course_images:r,description:this.formData.description,start_date:this.formData.start_date,end_date:this.formData.end_date,price:this.formData.price!=null?Number(this.formData.price):null,seats_count:this.formData.seats_count,has_reservation:this.formData.has_reservation,reservation_amount:this.formData.has_reservation&&this.formData.reservation_amount!=null?Number(this.formData.reservation_amount):null},o=await v.addCourse(h);this.$emit("dataAdded",o.data.message),this.closeDialog()}catch(l){let r="حدث خطأ أثناء إضافة الكورس";((e=l.response)==null?void 0:e.status)===401?r="غير مصرح لك بالعملية":(n=(i=l.response)==null?void 0:i.data)!=null&&n.message&&(r=l.response.data.message),this.$emit("showAlert","error",r)}finally{this.loading=!1}}}}};function re(t,e,i,n,l,r){const h=M;return d(),c(R,{modelValue:r.dialog,"onUpdate:modelValue":e[13]||(e[13]=o=>r.dialog=o),"max-width":"1000px"},{default:a(()=>[s(D,null,{default:a(()=>[s(S,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[s(p,{icon:"ri-add-line",color:"primary",class:"me-2",size:"24"}),e[14]||(e[14]=w("h3",{class:"text-h5 font-weight-bold"},"إضافة كورس جديد",-1))]),_:1}),s(k),s(q,null,{default:a(()=>[s(E,null,{default:a(()=>[s(L,{ref:"courseForm"},{default:a(()=>[s(V,null,{default:a(()=>[s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{modelValue:l.formData.course_name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.formData.course_name=o),rules:r.rules.required,label:"اسم الكورس",outlined:""},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(A,{modelValue:l.formData.grade_id,"onUpdate:modelValue":e[1]||(e[1]=o=>l.formData.grade_id=o),items:l.grades,rules:r.rules.required,"item-title":"gradeName","item-value":"gradeId",label:"المرحلة الدراسية",outlined:"",loading:l.loadingGrades},null,8,["modelValue","items","rules","loading"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(A,{modelValue:l.formData.subject_id,"onUpdate:modelValue":e[2]||(e[2]=o=>l.formData.subject_id=o),items:l.subjects,rules:r.rules.required,"item-title":"name","item-value":"id",label:"المادة",outlined:"",loading:l.loadingSubjects},null,8,["modelValue","items","rules","loading"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{"model-value":r.formatMoney(l.formData.price),"onUpdate:modelValue":e[3]||(e[3]=o=>r.onFormatMoney("price",o)),rules:r.rules.price,label:"السعر (دينار عراقي)",hint:"رجاءً اكتب المبلغ كاملاً مع الأصفار، مثال: 250,000 وليس 250","persistent-hint":"",outlined:""},null,8,["model-value","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(h,{modelValue:l.formData.start_date,"onUpdate:modelValue":e[4]||(e[4]=o=>l.formData.start_date=o),rules:r.rules.required,label:"تاريخ البداية",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(h,{modelValue:l.formData.end_date,"onUpdate:modelValue":e[5]||(e[5]=o=>l.formData.end_date=o),rules:r.rules.required,label:"تاريخ النهاية",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(y,{modelValue:l.formData.seats_count,"onUpdate:modelValue":e[6]||(e[6]=o=>l.formData.seats_count=o),modelModifiers:{number:!0},rules:r.rules.seats,label:"عدد المقاعد",type:"number",outlined:""},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12",md:"6"},{default:a(()=>[s(z,{modelValue:l.formData.has_reservation,"onUpdate:modelValue":e[7]||(e[7]=o=>l.formData.has_reservation=o),inset:"",color:"primary","true-value":!0,"false-value":!1,label:"هل يوجد عربون؟"},null,8,["modelValue"])]),_:1}),l.formData.has_reservation?(d(),c(u,{key:0,cols:"12",md:"6"},{default:a(()=>[s(y,{"model-value":r.formatMoney(l.formData.reservation_amount),"onUpdate:modelValue":e[8]||(e[8]=o=>r.onFormatMoney("reservation_amount",o)),rules:r.rules.reservation,label:"مبلغ العربون (دينار عراقي)",hint:"رجاءً اكتب مبلغ العربون كاملاً مع الأصفار، مثال: 100,000 وليس 100","persistent-hint":"",outlined:""},null,8,["model-value","rules"])]),_:1})):b("",!0),s(u,{cols:"12"},{default:a(()=>[s(J,{modelValue:l.formData.description,"onUpdate:modelValue":e[9]||(e[9]=o=>l.formData.description=o),rules:r.rules.required,label:"وصف الكورس",outlined:"",rows:"3"},null,8,["modelValue","rules"])]),_:1}),s(u,{cols:"12"},{default:a(()=>[s(D,{class:P(["pa-4",{"drag-over":l.isDragOver}]),onDragover:e[11]||(e[11]=x(o=>l.isDragOver=!0,["prevent"])),onDragleave:e[12]||(e[12]=x(o=>l.isDragOver=!1,["prevent"])),onDrop:x(r.handleDrop,["prevent"])},{default:a(()=>[s(S,{class:"text-subtitle-1 pb-2"},{default:a(()=>[s(p,{icon:"ri-image-line",class:"me-2"}),e[15]||(e[15]=f(" صور الكورس "))]),_:1}),s(Y,{modelValue:l.selectedFiles,"onUpdate:modelValue":e[10]||(e[10]=o=>l.selectedFiles=o),accept:"image/*",multiple:"",label:"اختر الصور","prepend-icon":"ri-camera-line",variant:"outlined"},null,8,["modelValue"]),l.imagesPreviews.length>0?(d(),c(V,{key:0,class:"mt-4"},{default:a(()=>[(d(!0),F(j,null,N(l.imagesPreviews,(o,g)=>(d(),c(u,{key:g,cols:"6",md:"3"},{default:a(()=>[s(D,{class:"position-relative"},{default:a(()=>[s(T,{src:o.url,height:"120",cover:"",class:"rounded"},null,8,["src"]),s(_,{icon:"",size:"small",color:"error",class:"position-absolute",style:{"inset-block-start":"8px","inset-inline-end":"8px"},onClick:I=>r.removeImage(g)},{default:a(()=>[s(p,{size:"16"},{default:a(()=>e[16]||(e[16]=[f("ri-close-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):b("",!0)]),_:1},8,["class","onDrop"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),s(B,{class:"px-6 pb-4"},{default:a(()=>[s(G),s(_,{color:"grey",variant:"outlined",onClick:r.closeDialog,disabled:l.loading},{default:a(()=>[s(p,{start:""},{default:a(()=>e[17]||(e[17]=[f("ri-close-line")])),_:1}),e[18]||(e[18]=f(" الغاء "))]),_:1},8,["onClick","disabled"]),s(_,{color:"primary",loading:l.loading,onClick:r.saveCourse,variant:"elevated"},{default:a(()=>[s(p,{start:""},{default:a(()=>e[19]||(e[19]=[f("ri-save-line")])),_:1}),e[20]||(e[20]=f(" حفظ الكورس "))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const oe=U(ae,[["render",re],["__scopeId","data-v-fbb9dbe7"]]),ie={data(){return{keyName:"show-course",results:JSON.parse(localStorage.getItem("user")),breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"الكورسات",disabled:!0}],loading:!1,progress:0,table:{totalItems:0,Data:[],actions:["حذف","تعديل","اعادة تفعيل"],loading:!1,headers:[{title:"#",type:"strong",sortable:!0,key:"num"},{title:"اسم الكورس",type:"link",sortable:!0,key:"course_name"},{title:"الصف",type:"strong",sortable:!0,key:"grade_name"},{title:"التفاصيل",type:"strong",sortable:!0,key:"description"},{title:"تاريخ البدا",type:"date",sortable:!0,key:"start_date"},{title:"تاريخ الانتهاء",type:"date",sortable:!0,key:"end_date"},{title:"المبلغ",type:"number",sortable:!0,key:"price"},{title:"يوجد عربون",type:"strong",sortable:!0,key:"has_reservation"},{title:"مبلغ العربون",type:"number",sortable:!0,key:"reservation_amount"},{title:"العدد",type:"number",sortable:!0,key:"seats_count"},{title:"الحالة",type:"strong",sortable:!0,key:"is_deleted"},{title:"تاريخ الانشاء",type:"date",sortable:!0,key:"created_at"},{title:"العمليات",type:"strong",sortable:!0,key:"actions"}],tableSettings:{options:{page:1,limit:10,scroll:0,sortBy:"",search:null,is_deleted:null,grade_id:null,subject_id:null,study_year:JSON.parse(localStorage.getItem("studyYear")),sort:'{"key":"createdAt","order":"desc"}'}}},gradeLevelAll:[],courseIsDisabled:[{text:"الكل",value:null},{text:"محذوف",value:!0},{text:"غير محذوف",value:!1}],Actions:{open:!1,data:null},editGrades:{open:!1,data:null},deleteDialog:{open:!1,data:null,messages:[],title:null,confirmButtonText:null},enableDialog:{open:!1,data:null,messages:[],title:null,confirmButtonText:null,checkboxLabel:null},alert:{open:!1,message:null,type:"success"}}},created(){const t=JSON.parse(localStorage.getItem(this.keyName));this.table.tableSettings=t||this.table.tableSettings,this.tempScrollTop=(t==null?void 0:t.scrollTop)||0},mounted(){window.addEventListener("scroll",this.handleScroll),this.$watch(()=>this.table.Data,t=>{(t==null?void 0:t.length)>0&&this.tempScrollTop&&setTimeout(()=>{window.scrollTo({top:this.tempScrollTop,behavior:"smooth"}),this.tempScrollTop=0},300)},{deep:!0})},beforeUnmount(){var t;(t=this.unwatch)==null||t.call(this),window.removeEventListener("scroll",this.handleScroll)},methods:{numberWithComma:$,handleDataAdded(t){this.getDataAxios(),this.showAlert("success",t)},handleScroll(){const t=window.scrollY||window.pageYOffset,e=JSON.parse(localStorage.getItem(this.keyName))||{};e.scrollTop=t,localStorage.setItem(this.keyName,JSON.stringify(e))},reload(){localStorage.removeItem(this.keyName),this.table.tableSettings.options={page:1,limit:10,scroll:0,sortBy:"",search:null,is_deleted:null,grade_id:null,subject_id:null,study_year:JSON.parse(localStorage.getItem("studyYear")),sort:JSON.stringify({key:"createdAt",order:"desc"})},this.getDataAxios()},updateTableOptions(t){this.table.tableSettings.options={...this.table.tableSettings.options,...t,search:t.search?t.search:null},this.getDataAxios()},async getDataAxios(){var e,i,n;this.progress=0,this.loading=!0;const t=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{localStorage.setItem(this.keyName,JSON.stringify(this.table.tableSettings));const l=await v.getCourse(this.table.tableSettings);if((e=l.data)!=null&&e.error)return this.showAlert("error",l.data.message||"حدث خطأ أثناء جلب البيانات");this.table.Data=l.data.data,this.table.totalItems=l.data.count}catch(l){this.showAlert("error",((n=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:n.message)||"حدث خطأ أثناء جلب البيانات")}finally{clearInterval(t),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0},500)}},editItem(t){this.editGrades.data=t,this.editGrades.open=!0},deleteItem(t){this.deleteDialog.data=t,this.deleteDialog.messages=["سيتم حذف الكورس .","ستتمكن من تعديلها واستخدامها كما كانت."],this.deleteDialog.title="تأكيد الحذف",this.deleteDialog.confirmButtonText="حذف الكورس",this.deleteDialog.checkboxLabel="أفهم التحذير وأؤكد الحذف",this.deleteDialog.open=!0},async handleDelete(){var e,i;this.progress=0,this.loading=!0;const t=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const n=await v.deleteCourse(this.deleteDialog.data.id);this.showAlert("success",n.data.message||"تم الحذف بنجاح"),this.getDataAxios()}catch(n){this.showAlert("error",((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"حدث خطأ أثناء عملية الحذف")}finally{clearInterval(t),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.deleteDialog.open=!1},500)}},enableItem(t){this.enableDialog.data=t,this.enableDialog.messages=["سيتم استرجاع المادة الكورس.","ستتمكن من تعديلها واستخدامها كما كانت."],this.enableDialog.title="تأكيد الاسترجاع",this.enableDialog.confirmButtonText="استرجاع الكورس",this.enableDialog.checkboxLabel="أفهم التحذير وأؤكد الاسترجاع",this.enableDialog.open=!0},async handleRestore(){var e,i;this.progress=0,this.loading=!0;const t=setInterval(()=>{this.progress<90&&(this.progress+=10)},100);try{const n=await v.restoreCourse(this.enableDialog.data.id);this.showAlert("success",n.data.message||"تم الحذف بنجاح"),this.getDataAxios()}catch(n){this.showAlert("error",((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"حدث خطأ أثناء عملية الحذف")}finally{clearInterval(t),this.progress=100,setTimeout(()=>{this.loading=!1,this.progress=0,this.enableDialog.open=!1},500)}},showAlert(t,e){Object.assign(this.alert,{type:t,message:e,open:!0})},handleShowCourseStudents(t){t!=null&&t.id&&this.$router.push({path:"/teacher/course/students",query:{courseId:t.id,courseName:t.course_name}})}}};function ne(t,e,i,n,l,r){const h=Z,o=X,g=oe,I=se,O=K,W=H;return d(),F("div",null,[s(h,{items:l.breadcrumbItems},null,8,["items"]),s(D,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:a(()=>[s(S,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[s(p,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),e[11]||(e[11]=w("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),s(k),s(C,null,{default:a(()=>[s(V,{class:"align-center justify-start pa-2"},{default:a(()=>[s(_,{color:"primary",class:"ma-2","prepend-icon":"ri-add-line",rounded:"pill",elevation:"2",size:"default",onClick:e[0]||(e[0]=m=>l.Actions.open=!0)},{default:a(()=>e[12]||(e[12]=[f(" إضافة كورس جديد ")])),_:1})]),_:1})]),_:1})]),_:1}),s(D,{class:"my-4 filter-card",elevation:"3",rounded:"lg"},{default:a(()=>[s(S,{class:"d-flex align-center py-4 px-6"},{default:a(()=>[s(p,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),e[13]||(e[13]=w("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),s(k),s(C,null,{default:a(()=>[s(V,{style:{"padding-block":"10px"}},{default:a(()=>[s(u,{cols:"12",md:"4"},{default:a(()=>[s(A,{modelValue:l.table.tableSettings.options.is_deleted,"onUpdate:modelValue":[e[1]||(e[1]=m=>l.table.tableSettings.options.is_deleted=m),r.getDataAxios],items:l.courseIsDisabled,"item-title":"text","item-value":"value",label:"حالة الكورس",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(D,{class:"my-4 data-table-card",elevation:"3",rounded:"lg"},{default:a(()=>[s(S,{class:"py-4 px-6"},{default:a(()=>[s(V,{class:"align-center"},{default:a(()=>[s(u,{cols:"auto"},{default:a(()=>[s(_,{color:"primary",onClick:e[2]||(e[2]=m=>r.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small",class:"rotate-on-hover"})]),_:1}),s(u,null,{default:a(()=>e[14]||(e[14]=[w("h3",{class:"text-h5 font-weight-bold text-center"},"الكورسات",-1)])),_:1}),s(u,{cols:"auto"},{default:a(()=>[s(ee,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:a(()=>[f(Q(r.numberWithComma(l.table.totalItems))+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),s(k),s(C,null,{default:a(()=>[s(o,{headers:l.table.headers,items:l.table.Data,actions:l.table.actions,loading:l.table.loading,totalItems:l.table.totalItems,tableOptions:l.table.tableSettings.options,onUpdateTableOptions:r.updateTableOptions,onDeleteItem:r.deleteItem,onEditItem:r.editItem,onEnableItem:r.enableItem,onShowItem:r.handleShowCourseStudents,class:"reservation-table"},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onDeleteItem","onEditItem","onEnableItem","onShowItem"])]),_:1})]),_:1}),l.Actions.open?(d(),c(g,{key:0,modelValue:l.Actions.open,"onUpdate:modelValue":e[3]||(e[3]=m=>l.Actions.open=m),onClose:e[4]||(e[4]=m=>l.Actions.open=!1),onDataAdded:r.handleDataAdded,onShowAlert:r.showAlert},null,8,["modelValue","onDataAdded","onShowAlert"])):b("",!0),l.editGrades.open?(d(),c(I,{key:1,modelValue:l.editGrades.open,"onUpdate:modelValue":e[5]||(e[5]=m=>l.editGrades.open=m),courseData:l.editGrades.data,onClose:e[6]||(e[6]=m=>l.editGrades.open=!1),onDataAdded:r.handleDataAdded,onShowAlert:r.showAlert},null,8,["modelValue","courseData","onDataAdded","onShowAlert"])):b("",!0),l.deleteDialog.open?(d(),c(O,{key:2,modelValue:l.deleteDialog.open,"onUpdate:modelValue":e[7]||(e[7]=m=>l.deleteDialog.open=m),messages:l.deleteDialog.messages,title:l.deleteDialog.title,confirmButtonText:l.deleteDialog.confirmButtonText,onConfirm:r.handleDelete},null,8,["modelValue","messages","title","confirmButtonText","onConfirm"])):b("",!0),l.enableDialog.open?(d(),c(O,{key:3,modelValue:l.enableDialog.open,"onUpdate:modelValue":e[8]||(e[8]=m=>l.enableDialog.open=m),messages:l.enableDialog.messages,title:l.enableDialog.title,confirmButtonText:l.enableDialog.confirmButtonText,checkboxLabel:l.enableDialog.checkboxLabel,onConfirm:r.handleRestore},null,8,["modelValue","messages","title","confirmButtonText","checkboxLabel","onConfirm"])):b("",!0),l.alert.open?(d(),c(W,{key:4,modelValue:l.alert.open,"onUpdate:modelValue":e[9]||(e[9]=m=>l.alert.open=m),type:l.alert.type,message:l.alert.message,closable:!0,"close-text":"موافق",onClose:e[10]||(e[10]=m=>l.alert.open=!1)},null,8,["modelValue","type","message"])):b("",!0)])}const Be=U(ie,[["render",ne]]);export{Be as default};
