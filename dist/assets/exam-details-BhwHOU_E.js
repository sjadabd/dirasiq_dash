import{_ as B}from"./BaseAlert-DhiW1pkC.js";import{_ as N}from"./AppBreadcrumbs-CL1Mn0e1.js";import b from"./teacher_api-e-hm75z5.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as h,a as V,c as D}from"./VCard-DJFVzfaq.js";import{c as p,b as s,f as E,n as _,e as n,o as f,d as a,p as v,s as m,V as L,v as C,t as u,F as U,x as F,a_ as q}from"./index-Cq5mHdd1.js";import{V as S}from"./VDivider-BttVlJLf.js";import{V as w}from"./VCardText-DbIVWSue.js";import{V as A,a as T}from"./VRow-C1y3VVie.js";import{V as G}from"./VSelect-D56nOm3K.js";import{V as j}from"./VChip-CKn48zu6.js";import{V as M}from"./VTable-BnE0OQoQ.js";import"./VDialog-BARV40Gk.js";import"./axios-lwY36-Bu.js";import"./VAvatar-B2hOBT8r.js";import"./VImg-BgkOcihp.js";import"./VList-BLaYBSlW.js";const O={name:"teacher-exams-details",data(){return{breadcrumbs:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"الامتحانات والدرجات",disabled:!1,to:"/teacher/exams/manage-exams"},{title:"تفاصيل الامتحان",disabled:!0}],exam:null,students:[],studentsLoading:!1,sessionItems:[],selectedSessionId:null,sessionsLoading:!1,alert:{open:!1,type:"success",message:""}}},created(){const l=this.$route.query.id;l&&(this.fetchExam(l),this.loadSessionsAndStudents(l))},watch:{selectedSessionId:{handler(l){const e=this.$route.query.id;e&&this.fetchStudents(e,l)}}},methods:{showAlert(l,e){Object.assign(this.alert,{type:l,message:e,open:!0})},formatDateTime(l){if(!l)return"";const e=new Date(l);return isNaN(e)?"":e.toLocaleString("ar-IQ")},examTypeLabel(l){return l==="monthly"?"شهري":"يومي"},async fetchExam(l){var e,o,i;try{const t=await b.getExamById(l);this.exam=((e=t==null?void 0:t.data)==null?void 0:e.data)||null}catch(t){this.showAlert("error",((i=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:i.message)||"فشل جلب تفاصيل الامتحان")}},async fetchStudents(l,e){var o,i,t;try{this.studentsLoading=!0;const d=await b.getExamStudents(l,e),I=((o=d==null?void 0:d.data)==null?void 0:o.data)||[];this.students=I.map(c=>({id:c.id,name:c.name,score:c.score??null,saving:!1}))}catch(d){this.showAlert("error",((t=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:t.message)||"فشل جلب الطلاب")}finally{this.studentsLoading=!1}},async loadSessionsAndStudents(l){var e;try{this.sessionsLoading=!0;const o=await b.getSessionNames();this.sessionItems=(((e=o==null?void 0:o.data)==null?void 0:e.data)||[]).map(i=>({text:i.title||i.name||i.label,value:i.id})),this.selectedSessionId=this.sessionItems.length?this.sessionItems[0].value:null}catch{this.sessionItems=[],this.selectedSessionId=null}finally{this.sessionsLoading=!1,this.fetchStudents(l,this.selectedSessionId)}},async saveGrade(l){var e,o,i;try{if(!((e=this.exam)!=null&&e.id)||!(l!=null&&l.id))return;l.saving=!0;const t=l.score===null||l.score===void 0||l.score===""?null:Number(l.score);await b.gradeExam(this.exam.id,l.id,{score:t}),this.showAlert("success",`تم حفظ درجة ${l.name}`)}catch(t){this.showAlert("error",((i=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:i.message)||"فشل حفظ الدرجة")}finally{l.saving=!1}}}},Q={class:"text-body-2 mb-1"},R={class:"text-body-2 mb-1"},H={class:"text-body-2 mb-1"},J={key:0,class:"text-body-2 mb-1"},K={key:1,class:"text-body-2 mb-1"},P={"data-label":"#"},W={"data-label":"الطالب"},X={"data-label":"الدرجة"},Y={"data-label":"إجراء"},Z={key:0};function $(l,e,o,i,t,d){const I=N,c=B;return f(),p("div",null,[s(I,{items:t.breadcrumbs},null,8,["items"]),s(h,{class:"my-4",elevation:"2"},{default:n(()=>[s(V,{class:"d-flex align-center"},{default:n(()=>[s(v,{class:"me-2"},{default:n(()=>e[3]||(e[3]=[m("ri-article-line")])),_:1}),e[5]||(e[5]=a("span",{class:"text-h6"},"تفاصيل الامتحان",-1)),s(L),s(C,{variant:"tonal","prepend-icon":"ri-arrow-go-back-line",onClick:e[0]||(e[0]=r=>l.$router.back())},{default:n(()=>e[4]||(e[4]=[m("رجوع")])),_:1})]),_:1}),s(S),s(w,null,{default:n(()=>[s(A,null,{default:n(()=>[s(T,{cols:"12",md:"6"},{default:n(()=>[s(h,{variant:"tonal"},{default:n(()=>[s(V,{class:"d-flex align-center"},{default:n(()=>[s(v,{class:"me-2"},{default:n(()=>e[6]||(e[6]=[m("ri-information-line")])),_:1}),e[7]||(e[7]=a("span",{class:"text-h6"},"معلومات الامتحان",-1))]),_:1}),s(S),s(w,null,{default:n(()=>{var r,y,x,g,k;return[a("div",Q,[e[8]||(e[8]=a("strong",null,"نوع الامتحان:",-1)),m(" "+u(d.examTypeLabel((r=t.exam)==null?void 0:r.exam_type)),1)]),a("div",R,[e[9]||(e[9]=a("strong",null,"التاريخ:",-1)),m(" "+u(d.formatDateTime((y=t.exam)==null?void 0:y.exam_date)),1)]),a("div",H,[e[10]||(e[10]=a("strong",null,"الدرجة القصوى:",-1)),m(" "+u((x=t.exam)==null?void 0:x.max_score),1)]),(g=t.exam)!=null&&g.description?(f(),p("div",J,[e[11]||(e[11]=a("strong",null,"الوصف:",-1)),m(" "+u(t.exam.description),1)])):_("",!0),(k=t.exam)!=null&&k.notes?(f(),p("div",K,[e[12]||(e[12]=a("strong",null,"ملاحظات:",-1)),m(" "+u(t.exam.notes),1)])):_("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(h,{class:"my-4 filter-card",elevation:"3",rounded:"lg"},{default:n(()=>[s(V,{class:"d-flex align-center py-4 px-6"},{default:n(()=>[s(v,{icon:"mdi mdi-filter-outline",color:"primary",class:"me-2",size:"24"}),e[13]||(e[13]=a("h3",{class:"text-h5 font-weight-bold"},"تصفية",-1))]),_:1}),s(S),s(D,null,{default:n(()=>[s(A,{style:{"padding-block":"10px"}},{default:n(()=>[s(T,{cols:"12",md:"3"},{default:n(()=>[s(G,{modelValue:t.selectedSessionId,"onUpdate:modelValue":e[1]||(e[1]=r=>t.selectedSessionId=r),items:t.sessionItems,"item-title":"text","item-value":"value",label:"اختر الجلسة",density:"comfortable","hide-details":"",style:{"max-inline-size":"260px"},loading:t.sessionsLoading},null,8,["modelValue","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),s(h,null,{default:n(()=>[s(V,{class:"d-flex align-center"},{default:n(()=>[s(v,{class:"me-2"},{default:n(()=>e[14]||(e[14]=[m("ri-team-line")])),_:1}),e[15]||(e[15]=a("span",{class:"text-h6"},"طلاب الامتحان وتسجيل الدرجات",-1)),s(L),s(j,{size:"small",variant:"flat",style:{color:"white"}},{default:n(()=>[m(u(t.students.length)+" طالب",1)]),_:1})]),_:1}),s(S),s(w,null,{default:n(()=>[s(M,{density:"comfortable"},{default:n(()=>[e[18]||(e[18]=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"الطالب"),a("th",{style:{"inline-size":"180px"}},"الدرجة"),a("th",{style:{"inline-size":"160px"}},"إجراء")])],-1)),a("tbody",null,[(f(!0),p(U,null,F(t.students,(r,y)=>{var x;return f(),p("tr",{key:r.id},[a("td",P,u(y+1),1),a("td",W,u(r.name),1),a("td",X,[s(q,{modelValue:r.score,"onUpdate:modelValue":g=>r.score=g,modelModifiers:{number:!0},type:"number",max:((x=t.exam)==null?void 0:x.max_score)||100,min:0,density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","max"])]),a("td",Y,[s(C,{color:"primary",size:"small",loading:r.saving,onClick:g=>d.saveGrade(r)},{default:n(()=>e[16]||(e[16]=[m(" حفظ ")])),_:2},1032,["loading","onClick"])])])}),128)),!t.studentsLoading&&!t.students.length?(f(),p("tr",Z,e[17]||(e[17]=[a("td",{colspan:"4",class:"text-center text-medium-emphasis"}," لا يوجد طلاب ",-1)]))):_("",!0)])]),_:1})]),_:1})]),_:1}),t.alert.open?(f(),E(c,{key:0,modelValue:t.alert.open,"onUpdate:modelValue":e[2]||(e[2]=r=>t.alert.open=r),type:t.alert.type,message:t.alert.message,closable:!0,"close-text":"موافق"},null,8,["modelValue","type","message"])):_("",!0)])}const ye=z(O,[["render",$],["__scopeId","data-v-b6bd945e"]]);export{ye as default};
