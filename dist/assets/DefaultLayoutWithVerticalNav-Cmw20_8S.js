import{n as Z,_ as tt}from"./index-CqsgdwGX.js";import j from"./teacher_api-DyrQANjO.js";import{r as m,k as et,l as at,m as it,a as st,c as V,o as l,b as i,e as a,h as ot,d as h,f as c,n as y,p as f,V as L,q as lt,s as r,v as k,F as nt,x as rt,y as P,i as T,t as I}from"./index-N2EhsRQt.js";import ut from"./Footer-Cp3lXFZV.js";import dt from"./NavbarThemeSwitcher-CBOKAbHN.js";import mt from"./UserProfile-DqvpuJLK.js";import{V as q,a as W,b as E}from"./VCard-CTAW927Q.js";import{V as w}from"./VDivider-D-Cf14qE.js";import{V as ct,a as ft}from"./VList-BwysrA6o.js";import{V as vt}from"./VAvatar-M6cRQjPV.js";import{V as H}from"./VImg-DOYF3Gzb.js";import{V as pt}from"./VBadge-DbVcJeK6.js";import{V as gt}from"./VCardText-Q2eeque7.js";import{V as yt}from"./VDialog-DdZwyjMa.js";import"./logo-DZO2jDAJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue3-perfect-scrollbar-BBsVN-Da.js";import"./casl-BU4oKCFy.js";import"./axios-CK0PAUQZ.js";import"./VTooltip-qYS1AgXw.js";import"./auth_api-BZWltAHM.js";const kt={class:"d-flex h-100 align-center"},Vt={key:1,class:"text-center pa-6 text-medium-emphasis"},_t={key:3,class:"d-flex justify-center pa-2"},xt={class:"text-h6 font-weight-bold"},bt={key:0,class:"text-body-2 text-medium-emphasis mb-2"},Ct={style:{"white-space":"pre-line"},class:"mb-3"},ht={key:1,class:"text-caption text-medium-emphasis"},Gt=Object.assign({inheritAttrs:!1},{__name:"DefaultLayoutWithVerticalNav",setup(It){const N=m(!1),b=m(!1),_=m(!1),v=m([]),$=m(1),B=m(10),S=m(!1),A=m(!1),g=m(0),u=m(null),O=et(),Q=at(),D=e=>{try{return new Date(e).toLocaleString("en-IQ")}catch{return e}},G=e=>{var t;try{const d=(e==null?void 0:e.type)||((t=e==null?void 0:e.data)==null?void 0:t.type),o=(e==null?void 0:e.data)||{};switch(d){case"new_booking":case"booking_update":return o.bookingId?`/teacher/payments/reservations/${encodeURIComponent(o.bookingId)}`:"/teacher/payments/reservations/show-reservation-payments";case"course_update":return"/teacher/course/show-course";case"teacher_message":case"message":return"/teacher/notifications/show-notifications";default:return null}}catch{return null}},M=async(e=1,t=!1)=>{var d;try{A.value=!0;const o=await j.getNotifications({page:e,limit:B.value}),s=(d=o==null?void 0:o.data)!=null&&d.data?o.data:o,p=Array.isArray(s==null?void 0:s.data)?s.data:[],x=(s==null?void 0:s.content_url)||"",C=p.map(n=>{var R,F;return{id:n.id,title:n.title,message:n.message,type:n.type,is_read:!!n.is_read,sentAt:n.sent_at||n.created_at,image:(R=n.data)!=null&&R.imageUrl?x?`${x}${n.data.imageUrl}`:n.data.imageUrl:null,url:((F=n.data)==null?void 0:F.url)||G(n)||null,raw:n}});v.value=t?[...v.value,...C]:C,g.value=v.value.filter(n=>!n.is_read).length;const Y=(s.pagination||{}).totalPages||(C.length<B.value?e:e+1);S.value=e<Y&&C.length>0,$.value=e}catch(o){console.warn("Failed to fetch notifications:",o)}finally{A.value=!1}},U=()=>{$.value=1,M(1,!1)},J=()=>{const e=$.value+1;M(e,!0)},K=async e=>{try{b.value=!1,console.debug("[Notifications] item clicked",e==null?void 0:e.id),e!=null&&e.id&&await z(String(e.id)),u.value=e,_.value=!0}catch(t){console.warn("openNotification failed:",t)}},z=async e=>{try{if(!e)return;console.debug("[Notifications] marking read ->",e),await j.markNotificationRead(String(e));const t=v.value.findIndex(d=>String(d.id)===String(e));t>-1&&!v.value[t].is_read&&(v.value[t].is_read=!0),g.value=Math.max(0,g.value-1)}catch(t){console.warn("Failed to mark notification as read:",t)}};it(()=>{var o;const e=localStorage.getItem("accessToken"),t=localStorage.getItem("user");N.value=!!(e&&t),N.value&&U();const d=(o=Q.query)==null?void 0:o.notificationId;d&&z(String(d)).then(()=>{}).catch(()=>{})});const X=async e=>{if(e!=null&&e.url)try{e.url.startsWith("http://")||e.url.startsWith("https://")?window.open(e.url,"_blank"):await O.push(e.url)}catch{}};return(e,t)=>{const d=st("IconBtn");return l(),V("div",null,[i(T(tt),P(e.$attrs,{"nav-items":T(Z)}),{navbar:a(({toggleVerticalOverlayNavActive:o})=>[h("div",kt,[i(d,{id:"vertical-nav-toggle-btn",class:"ms-n2 d-lg-none",onClick:s=>o(!0)},{default:a(()=>[i(f,{icon:"ri-menu-line"})]),_:2},1032,["onClick"]),i(dt),i(L),N.value?(l(),c(lt,{key:0,modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),location:"bottom","close-on-content-click":!1},{activator:a(({props:s})=>[i(k,P({icon:"",variant:"text"},s),{default:a(()=>[g.value?(l(),c(pt,{key:0,color:"error",content:g.value,overlap:""},{default:a(()=>[i(f,null,{default:a(()=>t[6]||(t[6]=[r("mdi-bell")])),_:1})]),_:1},8,["content"])):(l(),c(f,{key:1},{default:a(()=>t[7]||(t[7]=[r("mdi-bell")])),_:1}))]),_:2},1040)]),default:a(()=>[i(q,{"min-width":"360"},{default:a(()=>[i(W,{class:"d-flex align-center"},{default:a(()=>[i(f,{start:"",class:"me-2"},{default:a(()=>t[8]||(t[8]=[r("mdi-bell")])),_:1}),t[10]||(t[10]=h("span",{class:"text-subtitle-1"},"الإشعارات",-1)),i(L),i(k,{size:"small",variant:"text",onClick:U},{default:a(()=>t[9]||(t[9]=[r("تحديث")])),_:1})]),_:1}),i(w),v.value.length?(l(),c(ct,{key:0,density:"compact"},{default:a(()=>[(l(!0),V(nt,null,rt(v.value,s=>(l(),c(ft,{key:s.id,onClick:p=>K(s),title:s.title,subtitle:D(s.sentAt),class:"notification-item"},{prepend:a(()=>[i(vt,{size:"36",color:s.is_read?"grey":"primary"},{default:a(()=>[s.image?(l(),c(H,{key:0,src:s.image,cover:""},null,8,["src"])):(l(),c(f,{key:1,color:"white",size:"18"},{default:a(()=>t[11]||(t[11]=[r("mdi-bell")])),_:1}))]),_:2},1032,["color"])]),_:2},1032,["onClick","title","subtitle"]))),128))]),_:1})):(l(),V("div",Vt,"لا توجد إشعارات")),S.value?(l(),c(w,{key:2})):y("",!0),S.value?(l(),V("div",_t,[i(k,{size:"small",loading:A.value,variant:"text",onClick:J},{default:a(()=>t[12]||(t[12]=[r("عرض المزيد")])),_:1},8,["loading"])])):y("",!0),i(E,{class:"justify-end"},{default:a(()=>[i(k,{variant:"text",onClick:t[0]||(t[0]=s=>b.value=!1)},{default:a(()=>t[13]||(t[13]=[r("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])):y("",!0),i(mt)])]),footer:a(()=>[i(ut)]),default:a(()=>[ot(e.$slots,"default")]),_:3},16,["nav-items"]),i(yt,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=o=>_.value=o),"max-width":"700"},{default:a(()=>[i(q,null,{default:a(()=>{var o;return[i(W,{class:"d-flex align-center"},{default:a(()=>{var s;return[i(f,{start:"",color:"primary",class:"me-2"},{default:a(()=>t[14]||(t[14]=[r("mdi-bell")])),_:1}),h("span",xt,I((s=u.value)==null?void 0:s.title),1),i(L),i(k,{icon:"",variant:"text",onClick:t[2]||(t[2]=p=>_.value=!1)},{default:a(()=>[i(f,null,{default:a(()=>t[15]||(t[15]=[r("mdi-close")])),_:1})]),_:1})]}),_:1}),i(w),(o=u.value)!=null&&o.image?(l(),c(H,{key:0,src:u.value.image,height:"260",cover:""},null,8,["src"])):y("",!0),i(gt,null,{default:a(()=>{var s,p,x;return[(s=u.value)!=null&&s.sentAt?(l(),V("div",bt,[i(f,{size:"16",class:"me-1"},{default:a(()=>t[16]||(t[16]=[r("mdi-calendar")])),_:1}),r(" "+I(D(u.value.sentAt)),1)])):y("",!0),h("div",Ct,I((p=u.value)==null?void 0:p.message),1),(x=u.value)!=null&&x.type?(l(),V("div",ht,[i(f,{size:"14",class:"me-1"},{default:a(()=>t[17]||(t[17]=[r("mdi-tag")])),_:1}),r(" "+I(u.value.type),1)])):y("",!0)]}),_:1}),i(E,{class:"justify-end"},{default:a(()=>{var s;return[(s=u.value)!=null&&s.url?(l(),c(k,{key:0,onClick:t[3]||(t[3]=p=>X(u.value)),variant:"tonal"},{default:a(()=>t[18]||(t[18]=[r("فتح")])),_:1})):y("",!0),i(k,{variant:"text",onClick:t[4]||(t[4]=p=>_.value=!1)},{default:a(()=>t[19]||(t[19]=[r("إغلاق")])),_:1})]}),_:1})]}),_:1})]),_:1},8,["modelValue"])])}}});export{Gt as default};
