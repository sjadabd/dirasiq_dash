import{r as V,m as E,c as v,o as d,d as i,f as P,b as r,h as N,b7 as T,e as a,F as z,x as F,D as Q,A as j,s as f,B as M,p as w,t as p,n as A,v as C}from"./index-Cq5mHdd1.js";import B from"./teacher_api-e-hm75z5.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as U,V as q}from"./VRow-C1y3VVie.js";import{V as L}from"./VCard-DJFVzfaq.js";import{V as _}from"./VCardText-DbIVWSue.js";import{V as G}from"./VChip-CKn48zu6.js";import{V as H,a as J,b as K}from"./VList-BLaYBSlW.js";import{V as O}from"./VSnackbar-CZKFZQrs.js";const W={class:"text-center mb-6"},X={class:"text-h3 pricing-title pb-2"},Y={key:0,class:"text-center py-10"},Z={class:"text-h4 mb-1"},ee={class:"mb-0 text-body-1"},te={class:"d-flex justify-center align-center"},se={class:"text-h1 font-weight-medium text-primary"},ae={key:0,class:"text-body-1 font-weight-medium align-self-end ms-2"},re={key:0,class:"text-caption mt-2"},oe={__name:"AppPricing",props:{title:{type:String,default:"خطط التسعير"},cols:{type:[Number,String],default:12},sm:{type:[Number,String],default:6},md:{type:[Number,String],default:4},lg:{type:[Number,String],default:4},xl:{type:[Number,String],default:4}},setup($){const g=$,b=V([]),k=V(!1),u=V({show:!1,message:"",color:"error"});async function I(){var n,s,t;k.value=!0;try{const l=await B.getActivePackages(),c=((s=(n=l.data)==null?void 0:n.data)==null?void 0:s.data)||((t=l.data)==null?void 0:t.data)||l,h=Array.isArray(c==null?void 0:c.data)?c.data:c;if(!Array.isArray(h))throw new Error("Invalid response data");const m=h.map(e=>{const o=e.isFree||e.price===0,y=o?0:e.price;return{id:e.id,name:e.name,tagLine:e.description||(o?"مجاناً للمعلمين الجدد":"ميزات متقدمة"),logo:o?"/images/gift-icon.png":"/images/star-icon.png",monthlyPrice:y,yearlyPrice:y*12,isPopular:!1,current:!!e.current,features:[`حتى ${e.maxStudents} طالب`,e.description||(o?"مجاناً للمعلمين الجدد":"ميزات متقدمة"),e.durationDays===30?"اشتراك شهري":`اشتراك ${e.durationDays} يوم`,"دعم فني مخصص"]}}),x=m.findIndex(e=>{var o,y;return((o=e.name)==null?void 0:o.trim())==="الباقة الاحترافية"||((y=e.name)==null?void 0:y.toLowerCase().includes("professional"))});if(x!==-1)m.forEach(e=>e.isPopular=!1),m[x].isPopular=!0;else{const e=m.findIndex(o=>o.monthlyPrice!==0);e!==-1&&(m[e].isPopular=!0)}b.value=m}catch(l){u.value={show:!0,message:"تعذر تحميل الباقات. يرجى المحاولة لاحقًا",color:"error"},console.warn("⚠️ Failed to fetch pricing plans:",l)}finally{k.value=!1}}async function D(n){var s,t,l,c,h,m,x;if(!n.current)try{const e=await B.activateSubscriptionPackage(n.id),o=((s=e==null?void 0:e.data)==null?void 0:s.success)||(e==null?void 0:e.success),y=((t=e==null?void 0:e.data)==null?void 0:t.message)||(e==null?void 0:e.message)||`تم تفعيل باقة ${n.name} بنجاح`;u.value={show:!0,message:y,color:o?"success":"error"},o&&(b.value=b.value.map(S=>({...S,current:S.id===n.id})))}catch(e){console.warn("Failed to activate subscription package:",e);const o=((c=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:c.message)||((x=(m=(h=e==null?void 0:e.response)==null?void 0:h.data)==null?void 0:m.errors)==null?void 0:x[0])||"تعذر تفعيل الباقة، يرجى المحاولة لاحقًا";u.value={show:!0,message:o,color:"error"}}}return E(()=>{I()}),(n,s)=>(d(),v("div",null,[i("div",W,[N(n.$slots,"heading",{},()=>[i("h3",X,p(g.title),1)],!0),N(n.$slots,"subtitle",{},()=>[s[2]||(s[2]=i("p",{class:"mb-0"},[f(" تتضمن جميع الباقات أكثر من عدد طلاب. "),i("br"),f(" اختر الباقة الأنسب لاحتياجاتك. ")],-1))],!0)]),k.value?(d(),v("div",Y,[r(T,{indeterminate:"",color:"primary",size:"64"}),s[3]||(s[3]=i("p",{class:"mt-4 text-body-1"},"جاري تحميل الباقات...",-1))])):b.value.length>0?(d(),P(q,{key:1},{default:a(()=>[(d(!0),v(z,null,F(b.value,t=>(d(),P(U,{key:t.id,cols:g.cols,sm:g.sm,md:g.md,lg:g.lg,xl:g.xl},{default:a(()=>[r(L,{flat:"",border:"",class:Q([t.isPopular?"border-primary border-opacity-100":"","h-100"])},{default:a(()=>[r(_,{class:"text-end pt-4",style:{"block-size":"3.75rem"}},{default:a(()=>[j(r(G,{color:"primary",size:"small"},{default:a(()=>s[4]||(s[4]=[f(" الأكثر شعبية ")])),_:2},1536),[[M,t.isPopular]])]),_:2},1024),r(_,{class:"text-center"},{default:a(()=>[r(w,{icon:t.monthlyPrice===0?"mdi-gift":"mdi-star",color:t.monthlyPrice===0?"success":"primary",size:"80",class:"mb-5"},null,8,["icon","color"]),i("h4",Z,p(t.name),1),i("p",ee,p(t.tagLine),1)]),_:2},1024),r(_,{class:"position-relative text-center"},{default:a(()=>[i("div",null,[i("div",te,[i("h1",se,p(t.monthlyPrice===0?"مجاناً":new Intl.NumberFormat("en-IQ").format(t.monthlyPrice)),1),t.monthlyPrice!==0?(d(),v("span",ae," دينار/شهر ")):A("",!0)]),t.monthlyPrice!==0?(d(),v("div",re,p(new Intl.NumberFormat("en-IQ").format(t.yearlyPrice))+" دينار/سنة ",1)):A("",!0)])]),_:2},1024),r(_,{class:"pt-2"},{default:a(()=>[r(H,{class:"card-list pb-5"},{default:a(()=>[(d(!0),v(z,null,F(t.features,(l,c)=>(d(),P(J,{key:c},{prepend:a(()=>[r(w,{size:14,icon:"mdi-check-circle",color:"success",class:"me-2"})]),default:a(()=>[r(K,{class:"text-body-1"},{default:a(()=>[f(p(l),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),r(C,{block:"",color:t.current?"success":"primary",variant:t.isPopular?"elevated":"outlined",size:"large",onClick:l=>D(t)},{default:a(()=>[f(p(t.current?"باقتك الحالية":t.monthlyPrice===0?"ابدأ مجاناً":"اشترك الآن"),1)]),_:2},1032,["color","variant","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1032,["cols","sm","md","lg","xl"]))),128))]),_:1})):(d(),P(L,{key:2,flat:"",border:"",class:"text-center py-10"},{default:a(()=>[r(_,null,{default:a(()=>[r(w,{icon:"mdi-package-variant",size:"64",color:"grey",class:"mb-4"}),s[6]||(s[6]=i("h4",{class:"text-h5 mb-2"},"لا توجد باقات متاحة",-1)),s[7]||(s[7]=i("p",{class:"text-body-2 text-medium-emphasis"}," لم يتم العثور على أي باقات في الوقت الحالي ",-1)),r(C,{color:"primary",variant:"outlined",class:"mt-4",onClick:I},{default:a(()=>s[5]||(s[5]=[f(" إعادة المحاولة ")])),_:1})]),_:1})]),_:1})),r(O,{modelValue:u.value.show,"onUpdate:modelValue":s[1]||(s[1]=t=>u.value.show=t),color:u.value.color,location:"top",timeout:5e3},{actions:a(()=>[r(C,{variant:"text",onClick:s[0]||(s[0]=t=>u.value.show=!1)},{default:a(()=>s[8]||(s[8]=[f(" إغلاق ")])),_:1})]),default:a(()=>[f(p(u.value.message)+" ",1)]),_:1},8,["modelValue","color"])]))}},ye=R(oe,[["__scopeId","data-v-fc9bed13"]]);export{ye as _};
