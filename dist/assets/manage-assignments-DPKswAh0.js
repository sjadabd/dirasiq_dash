import{_ as Q}from"./ConfirmDangerDialog-CGsm43ei.js";import{_ as W}from"./BaseAlert-B7PZHURR.js";import{_ as H}from"./AppDateTimePicker-CvTLQXuu.js";import{_ as K}from"./SmartTable-LGudWv2R.js";import{_ as X}from"./AppBreadcrumbs-CbmSjfOn.js";import{T as y}from"./teacher_api-CgB6fFx4.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as U,b as T,a as P,c as R}from"./VCard-CBPwRQhR.js";import{V as N}from"./VDialog-N4WR69CN.js";import{c as w,b as s,f as j,x as B,e as l,o as h,d as p,k as x,A as b,q as f,V as k,t as O,b7 as C,F as z,s as E}from"./index-B_A_UGf-.js";import{V as S}from"./VDivider-Conlu035.js";import{V as L,a as u}from"./VRow-DsXvHsvC.js";import{V as D}from"./VSelect-BCxvD-wi.js";import{V as M}from"./VChip-BWlPf9tC.js";import{V as F}from"./VCardText-BWyx6VBY.js";import{V as Z}from"./VSwitch-B-sofXG8.js";import{V as q}from"./VFileInput-CTwA9g0q.js";import{V as J}from"./VImg-Mh6Lj_73.js";import"./number-DRUmGIrN.js";import"./VDataTable-DbM1iDiq.js";import"./VTable-CEsLxIJM.js";import"./filter-B6bRDRWJ.js";import"./VTooltip-MO4tEoa_.js";import"./axios-WFtL0f35.js";import"./VAvatar-BaPloNUq.js";import"./VList-khjaFYbC.js";const $={name:"teacher-assignments-manage-assignments",data(){return{breadcrumbItems:[{title:"الرئيسية",disabled:!1,to:"/teacher/index"},{title:"الواجبات",disabled:!0}],attachmentTypeItems:[{title:"image",value:"image"},{title:"pdf",value:"pdf"}],resourceTypes:[{title:"link",value:"link"}],alert:{open:!1,type:"success",message:""},confirmDialog:{open:!1,title:"تأكيد الحذف",buttonText:"حذف نهائي",messages:["سيتم حذف هذا الواجب نهائياً.","لا يمكن التراجع عن هذه العملية."],targetId:null},filters:{course_id:null,subject_id:null},table:{totalItems:0,Data:[],actions:["تعديل","تحديث رد","ارسال اشعار","حذف"],loading:!1,headers:[{title:"#",type:"strong",sortable:!1,key:"num"},{title:"العنوان",type:"link",sortable:!0,key:"title"},{title:"الدورة",type:"strong",sortable:!1,key:"course_label"},{title:"تاريخ التسليم",type:"strong",sortable:!0,key:"due_date"},{title:"الظهور",type:"strong",sortable:!1,key:"visibility_label"},{title:"الحالة",type:"strong",sortable:!1,key:"is_active_label"},{title:"إجراءات",type:"strong",sortable:!1,key:"actions"}],tableSettings:{options:{page:1,limit:10,search:null}}},courseItems:[],subjectItems:[],sessionItems:[],coursesLoading:!1,subjectsLoading:!1,sessionsLoading:!1,studentsOptions:[],studentsLoading:!1,gradeDialog:{open:!1,loading:!1,assignmentId:null,studentId:null,score:null,feedback:"",submission:null},recipientsDialog:{open:!1,loading:!1,assignmentId:null,studentIds:[]},imagePreview:{open:!1,src:"",title:""},formDialog:{open:!1,mode:"create",loading:!1},form:{id:null,title:"",description:"",course_id:null,subject_id:null,session_id:null,assigned_date:"",due_date:"",submission_type:"mixed",delivery_mode:"mixed",attachments:{pdf:{name:"",base64:""},images:[],existing:[]},resources:[],max_score:100,is_active:!0,visibility:"all_students",study_year:null,grade_id:null,recipients:{studentIds:[]}},submissionTypes:[{title:"نصي فقط",value:"text"},{title:"رابط فقط",value:"link"},{title:"ملف فقط",value:"file"},{title:"مختلط (نص/رابط/ملف)",value:"mixed"}],deliveryModes:[{title:"ورقي",value:"paper"},{title:"إلكتروني",value:"electronic"},{title:"مختلط",value:"mixed"}],visibilityItems:[{title:"كل الطلاب",value:"all_students"},{title:"طلاب محددون",value:"specific_students"}]}},created(){this.loadCourseNames(),this.loadSubjects(),this.loadSessionNames(),this.getDataAxios()},watch:{"form.visibility"(i){this.form.recipients.studentIds=[],i==="specific_students"?this.form.session_id?this.loadStudentsBySession(this.form.session_id):this.form.course_id?this.loadStudentsByCourse(this.form.course_id):this.loadTeacherStudents():this.studentsOptions=[]},"form.session_id"(i){this.form.visibility==="specific_students"&&(i?this.loadStudentsBySession(i):this.form.course_id?this.loadStudentsByCourse(this.form.course_id):this.loadTeacherStudents())},"form.course_id"(i){this.form.visibility==="specific_students"&&(this.form.session_id||(i?this.loadStudentsByCourse(i):this.loadTeacherStudents()))},"gradeDialog.studentId":{async handler(i){var e;try{const o=this.gradeDialog.assignmentId;if(!o||!i){this.gradeDialog.score=null,this.gradeDialog.feedback="",this.gradeDialog.submission=null;return}const n=await y.getAssignmentSubmission(o,i),t=(e=n==null?void 0:n.data)==null?void 0:e.data;t?(this.gradeDialog.score=typeof t.score=="number"?t.score:t.score?Number(t.score):null,this.gradeDialog.feedback=t.feedback||"",this.gradeDialog.submission=t):(this.gradeDialog.score=null,this.gradeDialog.feedback="",this.gradeDialog.submission=null)}catch{this.gradeDialog.score=null,this.gradeDialog.feedback="",this.gradeDialog.submission=null}},immediate:!1}},methods:{showAlert(i,e){Object.assign(this.alert,{type:i,message:e,open:!0})},formatDateTime(i){if(!i)return"";const e=new Date(i);return Number.isNaN(e.getTime())?"":e.toLocaleString("ar-IQ")},resolveUrl(i){if(!i)return"";if(/^https?:\/\//i.test(i))return i;try{const e=JSON.parse(localStorage.getItem("results")||"{}"),o=(e==null?void 0:e.content_url)||"http://localhost:3000";return new URL(i,o).href}catch{return"http://localhost:3000".replace(/\/$/,"")+(String(i).startsWith("/")?"":"/")+String(i)}},openImage(i){const e=this.resolveUrl(i==null?void 0:i.url);this.imagePreview={open:!0,src:e,title:(i==null?void 0:i.name)||""}},closeImage(){this.imagePreview.open=!1},async onPdfSelected(i){try{this.form||(this.form={}),this.form.attachments||(this.form.attachments={pdf:{name:"",base64:""},images:[],existing:[]});const e=Array.isArray(i)?i[0]:i;if(!e){this.form.attachments.pdf={name:"",base64:""};return}const o=await this.readFileAsBase64(e);this.form.attachments.pdf={name:e.name||"document.pdf",base64:o}}catch{this.form.attachments.pdf={name:"",base64:""}}},async onImagesSelected(i){try{this.form||(this.form={}),this.form.attachments||(this.form.attachments={pdf:{name:"",base64:""},images:[],existing:[]});const e=(Array.isArray(i)?i:[i]).filter(Boolean),o=[];for(const n of e){const t=await this.readFileAsBase64(n);o.push({name:n.name||"image.png",base64:t})}this.form.attachments.images=o}catch{this.form.attachments.images=[]}},readFileAsBase64(i){return new Promise((e,o)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=o,n.readAsDataURL(i)})},async openGradeDialog(i){var e;try{if(!(i!=null&&i.id))return;this.gradeDialog.assignmentId=i.id,this.gradeDialog.submission=null,this.studentsLoading=!0;try{const o=await y.getAssignmentRecipients(i.id),n=((e=o==null?void 0:o.data)==null?void 0:e.data)||[];this.studentsOptions=n.map(t=>({id:String(t.id||t.studentId||t.student_id),name:t.name||t.fullName||t.student_name}))}finally{this.studentsLoading=!1}this.gradeDialog.studentId=null,this.gradeDialog.score=null,this.gradeDialog.feedback="",this.gradeDialog.open=!0}catch{this.showAlert("error","تعذر فتح التقييم")}},async submitGrade(){var i,e;try{this.gradeDialog.loading=!0;const{assignmentId:o,studentId:n,score:t,feedback:d}=this.gradeDialog;if(!o||!n){this.showAlert("error","اختر الطالب");return}await y.gradeAssignment(o,n,{score:t,feedback:d}),this.showAlert("success","تم حفظ التقييم"),this.gradeDialog.open=!1}catch(o){this.showAlert("error",((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"فشل حفظ التقييم")}finally{this.gradeDialog.loading=!1}},async openRecipientsDialog(i){var e;try{if(!(i!=null&&i.id))return;this.recipientsDialog.assignmentId=i.id;try{const o=await y.getAssignmentRecipients(i.id),n=(((e=o==null?void 0:o.data)==null?void 0:e.data)||[]).map(t=>String(t.id||t.studentId||t.student_id||t));this.recipientsDialog.studentIds=n}catch{this.recipientsDialog.studentIds=[]}this.form.session_id?await this.loadStudentsBySession(this.form.session_id):this.form.course_id?await this.loadStudentsByCourse(this.form.course_id):await this.loadTeacherStudents(),this.recipientsDialog.open=!0}catch{this.showAlert("error","تعذر فتح المستلمين")}},async submitRecipients(){var i,e;try{this.recipientsDialog.loading=!0;const{assignmentId:o,studentIds:n}=this.recipientsDialog;await y.setAssignmentRecipients(o,n.map(String)),this.showAlert("success","تم حفظ المستلمين"),this.recipientsDialog.open=!1}catch(o){this.showAlert("error",((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"فشل حفظ المستلمين")}finally{this.recipientsDialog.loading=!1}},async loadCourseNames(){var i;try{this.coursesLoading=!0;const e=await y.getCourseNames(),o=((i=e==null?void 0:e.data)==null?void 0:i.data)||[];this.courseItems=o.map(n=>({text:n.name,value:n.id}))}finally{this.coursesLoading=!1}},async loadSubjects(){var i;try{this.subjectsLoading=!0;const e=await y.getAllSubjects(),o=((i=e==null?void 0:e.data)==null?void 0:i.data)||[];this.subjectItems=o.map(n=>({text:n.name,value:n.id}))}finally{this.subjectsLoading=!1}},async loadSessionNames(){var i;try{this.sessionsLoading=!0;const e=await y.getSessionNames(),o=((i=e==null?void 0:e.data)==null?void 0:i.data)||[];this.sessionItems=o.map(n=>({text:n.title||n.name,value:n.id}))}finally{this.sessionsLoading=!1}},async loadTeacherStudents(){var i;try{this.studentsLoading=!0;const e=await y.getTeacherStudents(),o=((i=e==null?void 0:e.data)==null?void 0:i.data)||[];this.studentsOptions=o.map(n=>({id:String(n.id||n.student_id),name:n.name||n.student_name}))}finally{this.studentsLoading=!1}},async loadStudentsByCourse(i){var e;try{if(!i){this.studentsOptions=[];return}this.studentsLoading=!0;const o=await y.getStudentsByCourse(i),n=((e=o==null?void 0:o.data)==null?void 0:e.data)||[];this.studentsOptions=n.map(t=>({id:String(t.id||t.student_id),name:t.name||t.student_name}))}finally{this.studentsLoading=!1}},async loadStudentsBySession(i){var e;try{if(!i){this.studentsOptions=[];return}this.studentsLoading=!0;const o=await y.getStudentsBySession(i),n=((e=o==null?void 0:o.data)==null?void 0:e.data)||[];this.studentsOptions=n.map(t=>({id:String(t.id||t.student_id),name:t.name||t.student_name}))}finally{this.studentsLoading=!1}},reload(){this.table.tableSettings.options={page:1,limit:10,search:null},this.getDataAxios()},updateTableOptions(i){this.table.tableSettings.options={...this.table.tableSettings.options,...i},this.getDataAxios()},async getDataAxios(){var i,e,o;try{this.table.loading=!0;const n=this.table.tableSettings.options,t=await y.getAssignments({options:n}),d=(t==null?void 0:t.data)||{},I=d.data||[];this.table.totalItems=((i=d.pagination)==null?void 0:i.total)||0,this.table.Data=I.map((r,v)=>{var _;return{id:r.id,num:(n.page-1)*n.limit+v+1,title:r.title||"-",course_label:((_=r.course)==null?void 0:_.name)||"-",due_date:r.due_date||"-",visibility_label:r.visibility==="all_students"?"كل الطلاب":r.visibility==="specific_students"?"طلاب محددون":r.visibility||"-",is_active_label:r.is_active?"مفعل":"معطل"}})}catch(n){this.showAlert("error",((o=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:o.message)||"تعذر جلب الواجبات")}finally{this.table.loading=!1}},openCreateDialog(){this.formDialog.mode="create",this.formDialog.open=!0},async openEditDialog(i){var e,o,n,t,d,I,r,v;try{if(!(i!=null&&i.id))return;const _=await y.getAssignmentById(i.id),m=((e=_==null?void 0:_.data)==null?void 0:e.data)||{};this.form={id:m.id,title:m.title||"",description:m.description||"",course_id:m.course_id||((o=m.course)==null?void 0:o.id)||null,subject_id:m.subject_id||((n=m.subject)==null?void 0:n.id)||null,session_id:m.session_id||((t=m.session)==null?void 0:t.id)||null,assigned_date:m.assigned_date||"",due_date:m.due_date||"",submission_type:["text","link","file","mixed"].includes(String(m.submission_type||"").toLowerCase())?String(m.submission_type).toLowerCase():"mixed",attachments:(()=>{var G;const a=Array.isArray((G=m.attachments)==null?void 0:G.files)?m.attachments.files:[],V={name:"",base64:""},c=[],g=[];for(const A of a)A.base64?(A.type||"").toLowerCase()==="pdf"?(V.name=A.name||"document.pdf",V.base64=A.base64):c.push({name:A.name||"image.png",base64:A.base64}):A.url&&g.push({type:A.type||"image",name:A.name||"",url:A.url||""});return{pdf:V,images:c,existing:g}})(),resources:Array.isArray(m.resources)?m.resources.map(a=>({type:a.type||"link",title:a.title||"",url:a.url||""})):[],max_score:typeof m.max_score=="number"?m.max_score:100,is_active:typeof m.is_active=="boolean"?m.is_active:!0,visibility:m.visibility||"all_students",study_year:m.study_year||null,grade_id:m.grade_id||null,recipients:{studentIds:Array.isArray(m.recipients)?m.recipients.map(a=>String(a.id||a.studentId||a)):[]},delivery_mode:(I=(d=m.attachments)==null?void 0:d.meta)!=null&&I.delivery_mode?String(m.attachments.meta.delivery_mode).toLowerCase():"mixed"},this.form.visibility==="specific_students"&&(this.form.session_id?await this.loadStudentsBySession(this.form.session_id):this.form.course_id?await this.loadStudentsByCourse(this.form.course_id):await this.loadTeacherStudents()),this.formDialog.mode="edit",this.formDialog.open=!0}catch(_){this.showAlert("error",((v=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:v.message)||"تعذر فتح التعديل")}},async submitForm(){var i,e,o,n,t,d,I;try{this.formDialog.loading=!0;const r=this.form;if(!r.title||!r.course_id){this.showAlert("error","الحقول course_id و title مطلوبة");return}const v=[];if((e=(i=r.attachments)==null?void 0:i.pdf)!=null&&e.base64&&v.push({type:"pdf",name:r.attachments.pdf.name||"document.pdf",base64:r.attachments.pdf.base64}),Array.isArray((o=r.attachments)==null?void 0:o.images))for(const g of r.attachments.images)g!=null&&g.base64&&v.push({type:"image",name:g.name||"image.png",base64:g.base64});if(Array.isArray((n=r.attachments)==null?void 0:n.existing))for(const g of r.attachments.existing)g!=null&&g.url&&(g!=null&&g.name)&&(g!=null&&g.type)&&v.push({type:g.type,name:g.name,url:g.url});const _=["paper","electronic","mixed"].includes(String(r.delivery_mode||"").toLowerCase())?String(r.delivery_mode).toLowerCase():"mixed",m={};v.length&&(m.files=v),m.meta={delivery_mode:_};const V=["text","link","file","mixed"].includes(String(r.submission_type||"").toLowerCase())?String(r.submission_type).toLowerCase():"mixed",c={course_id:r.course_id,subject_id:r.subject_id||null,session_id:r.session_id||null,title:r.title,description:r.description||null,assigned_date:r.assigned_date||null,due_date:r.due_date||null,submission_type:V,attachments:m,resources:r.resources||[],max_score:r.max_score??100,is_active:!!r.is_active,visibility:r.visibility||"all_students",study_year:r.study_year||null,grade_id:r.grade_id||null,recipients:r.visibility==="specific_students"?{studentIds:(((t=r.recipients)==null?void 0:t.studentIds)||[]).map(String)}:void 0};this.formDialog.mode==="edit"&&r.id?(await y.updateAssignment(r.id,c),this.showAlert("success","تم تحديث الواجب")):(await y.createAssignment(c),this.showAlert("success","تم إنشاء الواجب")),this.formDialog.open=!1,this.getDataAxios()}catch(r){this.showAlert("error",((I=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:I.message)||(this.formDialog.mode==="edit"?"فشل تحديث الواجب":"فشل إنشاء الواجب"))}finally{this.formDialog.loading=!1}},addResourceRow(){Array.isArray(this.form.resources)||(this.form.resources=[]),this.form.resources.push({type:"link",title:"",url:""})},removeResourceRow(i){Array.isArray(this.form.resources)&&this.form.resources.splice(i,1)},addExistingFile(){(!this.form.attachments||!Array.isArray(this.form.attachments.existing))&&(this.form.attachments={pdf:{name:"",base64:""},images:[],existing:[]}),this.form.attachments.existing.push({type:"image",name:"",url:""})},removeExistingFile(i){!this.form.attachments||!Array.isArray(this.form.attachments.existing)||this.form.attachments.existing.splice(i,1)},async handleDeleteAssignment(i){i!=null&&i.id&&(this.confirmDialog.targetId=i.id,this.confirmDialog.open=!0)},async confirmDeleteAssignment(){var i,e;try{const o=this.confirmDialog.targetId;if(!o)return;await y.deleteAssignment(o),this.showAlert("success","تم حذف الواجب"),this.getDataAxios()}catch(o){this.showAlert("error",((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"فشل حذف الواجب")}finally{this.confirmDialog.targetId=null,this.confirmDialog.open=!1}},openAssignmentOverview(i){i!=null&&i.id&&this.$router.push({name:"teacher-assignments-assignment-overview",query:{id:i.id}})}}},ee={class:"text-h6"},te={class:"d-flex align-center mb-2"},se={class:"d-flex align-center mb-2"},ie={class:"text-h6"},le={class:"d-flex align-center mb-2"},ae={class:"text-caption"},oe={key:0,class:"mb-2"},ne={class:"text-body-2 mt-1",style:{"white-space":"pre-wrap"}},re={key:1,class:"mb-2"},de=["href"],ue={key:2},me={key:0},fe={key:1};function ge(i,e,o,n,t,d){const I=X,r=K,v=H,_=W,m=Q;return h(),w("div",null,[s(I,{items:t.breadcrumbItems},null,8,["items"]),s(U,{class:"my-4 operations-card",elevation:"3",rounded:"lg"},{default:l(()=>[s(T,{class:"d-flex align-center py-4 px-6"},{default:l(()=>[s(x,{icon:"mdi-cog-outline",color:"primary",class:"me-2",size:"24"}),e[35]||(e[35]=p("h3",{class:"text-h5 font-weight-bold"},"العمليات",-1))]),_:1}),s(S),s(P,null,{default:l(()=>[s(L,{class:"align-center justify-start pa-2"},{default:l(()=>[s(b,{color:"primary",class:"ma-2","prepend-icon":"ri-add-line",rounded:"pill",elevation:"2",size:"default",onClick:d.openCreateDialog},{default:l(()=>e[36]||(e[36]=[f(" إضافة واجب جديد ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),s(U,{class:"my-4",elevation:"3",rounded:"lg"},{default:l(()=>[s(T,{class:"d-flex align-center py-4 px-6"},{default:l(()=>[s(x,{icon:"ri-notification-3-line",color:"primary",class:"me-2",size:"24"}),e[37]||(e[37]=p("h3",{class:"text-h5 font-weight-bold"},"إشعارات المعلم",-1)),s(k)]),_:1}),s(S),s(P,null,{default:l(()=>[s(L,{class:"py-3"},{default:l(()=>[s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.filters.course_id,"onUpdate:modelValue":[e[0]||(e[0]=a=>t.filters.course_id=a),d.reload],items:t.courseItems,"item-title":"text","item-value":"value",label:"الدورة",variant:"outlined",loading:t.coursesLoading,disabled:t.coursesLoading,clearable:""},null,8,["modelValue","items","loading","disabled","onUpdate:modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.filters.subject_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>t.filters.subject_id=a),d.reload],items:t.subjectItems,"item-title":"text","item-value":"value",label:"المادة",variant:"outlined",loading:t.subjectsLoading,disabled:t.subjectsLoading,clearable:""},null,8,["modelValue","items","loading","disabled","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(U,{class:"my-4",elevation:"3",rounded:"lg"},{default:l(()=>[s(T,{class:"py-4 px-6"},{default:l(()=>[s(L,{class:"align-center"},{default:l(()=>[s(u,{cols:"auto"},{default:l(()=>[s(b,{color:"primary",onClick:e[2]||(e[2]=a=>d.reload()),icon:"ri-refresh-line",variant:"tonal",rounded:"circle",size:"small",class:"rotate-on-hover"})]),_:1}),s(u,null,{default:l(()=>e[38]||(e[38]=[p("h3",{class:"text-h5 font-weight-bold text-center"},"قائمة الواجبات",-1)])),_:1}),s(u,{cols:"auto"},{default:l(()=>[s(M,{color:"primary",variant:"elevated",class:"font-weight-medium"},{default:l(()=>[f(O(Number(t.table.totalItems).toLocaleString())+" عدد السجلات ",1)]),_:1})]),_:1})]),_:1})]),_:1}),s(S),s(P,null,{default:l(()=>[s(r,{headers:t.table.headers,items:t.table.Data,actions:t.table.actions,loading:t.table.loading,totalItems:t.table.totalItems,tableOptions:t.table.tableSettings.options,onUpdateTableOptions:d.updateTableOptions,onDeleteItem:d.handleDeleteAssignment,onEditItem:d.openEditDialog,onUpdateResponseItem:d.openGradeDialog,onSendNotificationsItem:d.openRecipientsDialog,onShowItem:d.openAssignmentOverview},null,8,["headers","items","actions","loading","totalItems","tableOptions","onUpdateTableOptions","onDeleteItem","onEditItem","onUpdateResponseItem","onSendNotificationsItem","onShowItem"])]),_:1})]),_:1}),s(N,{modelValue:t.formDialog.open,"onUpdate:modelValue":e[20]||(e[20]=a=>t.formDialog.open=a),"max-width":"1000"},{default:l(()=>[s(U,null,{default:l(()=>[s(T,{class:"d-flex align-center"},{default:l(()=>[s(x,{icon:"ri-task-line",class:"me-2"}),p("span",ee,O(t.formDialog.mode==="create"?"إنشاء واجب":"تعديل واجب"),1),s(k),s(b,{icon:"",variant:"text",onClick:e[3]||(e[3]=a=>t.formDialog.open=!1)},{default:l(()=>[s(x,null,{default:l(()=>e[39]||(e[39]=[f("ri-close-line")])),_:1})]),_:1})]),_:1}),s(S),s(F,null,{default:l(()=>[s(L,null,{default:l(()=>[s(u,{cols:"12",md:"6"},{default:l(()=>[s(v,{modelValue:t.form.assigned_date,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.assigned_date=a),type:"date",label:"تاريخ الإسناد",variant:"outlined"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(v,{modelValue:t.form.due_date,"onUpdate:modelValue":e[5]||(e[5]=a=>t.form.due_date=a),type:"date",label:"تاريخ التسليم",variant:"outlined"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(C,{modelValue:t.form.title,"onUpdate:modelValue":e[6]||(e[6]=a=>t.form.title=a),label:"العنوان",variant:"outlined"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(C,{modelValue:t.form.description,"onUpdate:modelValue":e[7]||(e[7]=a=>t.form.description=a),label:"الوصف",variant:"outlined"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.course_id,"onUpdate:modelValue":e[8]||(e[8]=a=>t.form.course_id=a),items:t.courseItems,"item-title":"text","item-value":"value",label:"الدورة",variant:"outlined",loading:t.coursesLoading,disabled:t.coursesLoading},null,8,["modelValue","items","loading","disabled"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.subject_id,"onUpdate:modelValue":e[9]||(e[9]=a=>t.form.subject_id=a),items:t.subjectItems,"item-title":"text","item-value":"value",label:"المادة",variant:"outlined",loading:t.subjectsLoading,disabled:t.subjectsLoading,clearable:""},null,8,["modelValue","items","loading","disabled"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.session_id,"onUpdate:modelValue":e[10]||(e[10]=a=>t.form.session_id=a),items:t.sessionItems,"item-title":"text","item-value":"value",label:"الجلسة (اختياري)",variant:"outlined",loading:t.sessionsLoading,disabled:t.sessionsLoading,clearable:""},null,8,["modelValue","items","loading","disabled"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.submission_type,"onUpdate:modelValue":e[11]||(e[11]=a=>t.form.submission_type=a),items:t.submissionTypes,label:"نوع التسليم (مطلوب للطالب)",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.delivery_mode,"onUpdate:modelValue":e[12]||(e[12]=a=>t.form.delivery_mode=a),items:t.deliveryModes,label:"وضع التسليم (ورقي/إلكتروني)",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(C,{modelValue:t.form.max_score,"onUpdate:modelValue":e[13]||(e[13]=a=>t.form.max_score=a),modelModifiers:{number:!0},type:"number",label:"الدرجة القصوى",variant:"outlined"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(Z,{modelValue:t.form.is_active,"onUpdate:modelValue":e[14]||(e[14]=a=>t.form.is_active=a),label:"مفعل",inset:""},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:l(()=>[s(D,{modelValue:t.form.visibility,"onUpdate:modelValue":e[15]||(e[15]=a=>t.form.visibility=a),items:t.visibilityItems,label:"نطاق الظهور",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t.form.visibility==="specific_students"?(h(),j(u,{key:0,cols:"12"},{default:l(()=>[s(D,{modelValue:t.form.recipients.studentIds,"onUpdate:modelValue":e[16]||(e[16]=a=>t.form.recipients.studentIds=a),items:t.studentsOptions,"item-title":"name","item-value":"id",label:"اختر الطلاب",chips:"",multiple:"",clearable:"",loading:t.studentsLoading,variant:"outlined"},null,8,["modelValue","items","loading"])]),_:1})):B("",!0),s(u,{cols:"12"},{default:l(()=>e[40]||(e[40]=[p("h4",{class:"text-subtitle-1 mb-2"},"المرفقات",-1)])),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(q,{label:"ملف PDF (اختياري)",variant:"outlined",accept:"application/pdf","show-size":"","onUpdate:modelValue":e[17]||(e[17]=a=>d.onPdfSelected(a))})]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(q,{label:"صور (اختياري، متعدد)",variant:"outlined",accept:"image/*",multiple:"","show-size":"","onUpdate:modelValue":e[18]||(e[18]=a=>d.onImagesSelected(a))})]),_:1}),t.formDialog.mode!=="create"?(h(),j(u,{key:1,cols:"12"},{default:l(()=>[p("div",te,[e[42]||(e[42]=p("h4",{class:"text-subtitle-1 mb-0"},"ملفات موجودة مسبقًا",-1)),s(k),s(b,{size:"small",variant:"tonal",color:"primary",onClick:d.addExistingFile,"prepend-icon":"ri-add-line"},{default:l(()=>e[41]||(e[41]=[f("إضافة ملف موجود")])),_:1},8,["onClick"])]),(h(!0),w(z,null,E(t.form.attachments.existing,(a,V)=>(h(),j(L,{key:V,class:"mb-2"},{default:l(()=>[s(u,{cols:"12",md:"2"},{default:l(()=>[s(D,{items:t.attachmentTypeItems,modelValue:a.type,"onUpdate:modelValue":c=>a.type=c,label:"النوع",variant:"outlined"},null,8,["items","modelValue","onUpdate:modelValue"])]),_:2},1024),s(u,{cols:"12",md:"4"},{default:l(()=>[s(C,{modelValue:a.name,"onUpdate:modelValue":c=>a.name=c,label:"الاسم",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(u,{cols:"12",md:"5"},{default:l(()=>[s(C,{modelValue:a.url,"onUpdate:modelValue":c=>a.url=c,label:"الرابط",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(u,{cols:"12",md:"1",class:"d-flex align-center"},{default:l(()=>[s(b,{icon:"",color:"error",variant:"text",onClick:c=>d.removeExistingFile(V)},{default:l(()=>[s(x,null,{default:l(()=>e[43]||(e[43]=[f("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):B("",!0),s(u,{cols:"12"},{default:l(()=>[p("div",se,[e[45]||(e[45]=p("h4",{class:"text-subtitle-1 mb-0"},"الموارد",-1)),s(k),s(b,{size:"small",variant:"tonal",color:"primary",onClick:d.addResourceRow,"prepend-icon":"ri-add-line"},{default:l(()=>e[44]||(e[44]=[f("إضافة مورد")])),_:1},8,["onClick"])]),(h(!0),w(z,null,E(t.form.resources,(a,V)=>(h(),j(L,{key:V,class:"mb-2"},{default:l(()=>[s(u,{cols:"12",md:"3"},{default:l(()=>[s(D,{modelValue:a.type,"onUpdate:modelValue":c=>a.type=c,items:t.resourceTypes,label:"النوع",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(u,{cols:"12",md:"4"},{default:l(()=>[s(C,{modelValue:a.title,"onUpdate:modelValue":c=>a.title=c,label:"عنوان المورد",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(u,{cols:"12",md:"5"},{default:l(()=>[s(C,{modelValue:a.url,"onUpdate:modelValue":c=>a.url=c,label:"رابط المورد",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(u,{cols:"12",md:"1",class:"d-flex align-center"},{default:l(()=>[s(b,{icon:"",color:"error",variant:"text",onClick:c=>d.removeResourceRow(V)},{default:l(()=>[s(x,null,{default:l(()=>e[46]||(e[46]=[f("ri-delete-bin-line")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(S),s(R,null,{default:l(()=>[s(k),s(b,{variant:"text",onClick:e[19]||(e[19]=a=>t.formDialog.open=!1)},{default:l(()=>e[47]||(e[47]=[f("إلغاء")])),_:1}),s(b,{color:"primary",loading:t.formDialog.loading,onClick:d.submitForm},{default:l(()=>e[48]||(e[48]=[f("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(N,{modelValue:t.imagePreview.open,"onUpdate:modelValue":e[21]||(e[21]=a=>t.imagePreview.open=a),"max-width":"900"},{default:l(()=>[s(U,null,{default:l(()=>[s(T,{class:"d-flex align-center"},{default:l(()=>[s(x,{class:"me-2"},{default:l(()=>e[49]||(e[49]=[f("ri-image-line")])),_:1}),p("span",ie,O(t.imagePreview.title||"معاينة الصورة"),1),s(k),s(b,{icon:"",variant:"text",onClick:d.closeImage},{default:l(()=>[s(x,null,{default:l(()=>e[50]||(e[50]=[f("ri-close-line")])),_:1})]),_:1},8,["onClick"])]),_:1}),s(S),s(F,null,{default:l(()=>[s(J,{src:t.imagePreview.src,alt:t.imagePreview.title,height:"70vh",contain:"",class:"rounded"},null,8,["src","alt"])]),_:1}),s(S),s(R,null,{default:l(()=>[s(k),s(b,{href:t.imagePreview.src,target:"_blank",rel:"noopener",variant:"tonal","prepend-icon":"ri-download-2-line"},{default:l(()=>e[51]||(e[51]=[f("فتح/تحميل")])),_:1},8,["href"]),s(b,{color:"primary",onClick:d.closeImage},{default:l(()=>e[52]||(e[52]=[f("إغلاق")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.alert.open?(h(),j(_,{key:0,modelValue:t.alert.open,"onUpdate:modelValue":e[22]||(e[22]=a=>t.alert.open=a),type:t.alert.type,message:t.alert.message,closable:!0,"close-text":"موافق",onClose:e[23]||(e[23]=a=>t.alert.open=!1)},null,8,["modelValue","type","message"])):B("",!0),s(m,{modelValue:t.confirmDialog.open,"onUpdate:modelValue":e[24]||(e[24]=a=>t.confirmDialog.open=a),title:t.confirmDialog.title,messages:t.confirmDialog.messages,confirmButtonText:t.confirmDialog.buttonText,onConfirm:d.confirmDeleteAssignment},null,8,["modelValue","title","messages","confirmButtonText","onConfirm"]),s(N,{modelValue:t.gradeDialog.open,"onUpdate:modelValue":e[30]||(e[30]=a=>t.gradeDialog.open=a),"max-width":"600"},{default:l(()=>[s(U,null,{default:l(()=>[s(T,{class:"d-flex align-center"},{default:l(()=>[s(x,{class:"me-2"},{default:l(()=>e[53]||(e[53]=[f("ri-mark-pen-line")])),_:1}),e[55]||(e[55]=p("span",{class:"text-h6"},"تقييم واجب",-1)),s(k),s(b,{icon:"",variant:"text",onClick:e[25]||(e[25]=a=>t.gradeDialog.open=!1)},{default:l(()=>[s(x,null,{default:l(()=>e[54]||(e[54]=[f("ri-close-line")])),_:1})]),_:1})]),_:1}),s(S),s(F,null,{default:l(()=>[s(L,null,{default:l(()=>[s(u,{cols:"12"},{default:l(()=>[s(D,{modelValue:t.gradeDialog.studentId,"onUpdate:modelValue":e[26]||(e[26]=a=>t.gradeDialog.studentId=a),items:t.studentsOptions,"item-title":"name","item-value":"id",label:"اختر الطالب",loading:t.studentsLoading,clearable:""},null,8,["modelValue","items","loading"])]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(C,{modelValue:t.gradeDialog.score,"onUpdate:modelValue":e[27]||(e[27]=a=>t.gradeDialog.score=a),modelModifiers:{number:!0},type:"number",label:"الدرجة"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"6"},{default:l(()=>[s(C,{modelValue:t.gradeDialog.feedback,"onUpdate:modelValue":e[28]||(e[28]=a=>t.gradeDialog.feedback=a),label:"ملاحظات (اختياري)"},null,8,["modelValue"])]),_:1}),t.gradeDialog.submission?(h(),j(u,{key:0,cols:"12"},{default:l(()=>[s(U,{variant:"tonal",class:"pa-3"},{default:l(()=>[p("div",le,[s(M,{size:"small",color:t.gradeDialog.submission.status==="submitted"?"primary":"default",class:"me-2"},{default:l(()=>[f(O(t.gradeDialog.submission.status||"—"),1)]),_:1},8,["color"]),p("span",ae,"تم الإرسال: "+O(d.formatDateTime(t.gradeDialog.submission.submitted_at)),1)]),t.gradeDialog.submission.content_text?(h(),w("div",oe,[e[56]||(e[56]=p("strong",null,"النص:",-1)),p("div",ne,O(t.gradeDialog.submission.content_text),1)])):B("",!0),t.gradeDialog.submission.link_url?(h(),w("div",re,[e[57]||(e[57]=p("strong",null,"رابط:",-1)),p("a",{href:t.gradeDialog.submission.link_url,target:"_blank",rel:"noopener",class:"ms-1"},"فتح الرابط",8,de)])):B("",!0),Array.isArray(t.gradeDialog.submission.attachments)&&t.gradeDialog.submission.attachments.length?(h(),w("div",ue,[e[58]||(e[58]=p("strong",{class:"d-block mb-2"},"مرفقات:",-1)),s(L,{class:"ga-2"},{default:l(()=>[(h(!0),w(z,null,E(t.gradeDialog.submission.attachments,(a,V)=>(h(),j(u,{key:V,cols:"12",sm:"6"},{default:l(()=>[(a.type||"").toLowerCase()==="image"?(h(),w("div",me,[s(J,{src:d.resolveUrl(a.url),alt:a.name,height:"150",cover:"",class:"rounded",style:{cursor:"pointer"},onClick:c=>d.openImage(a)},null,8,["src","alt","onClick"])])):(h(),w("div",fe,[s(b,{href:d.resolveUrl(a.url),target:"_blank",rel:"noopener",variant:"tonal",size:"small","prepend-icon":"ri-attachment-2"},{default:l(()=>[f(O(a.name||"ملف"),1)]),_:2},1032,["href"])]))]),_:2},1024))),128))]),_:1})])):B("",!0)]),_:1})]),_:1})):B("",!0)]),_:1})]),_:1}),s(S),s(R,null,{default:l(()=>[s(k),s(b,{variant:"text",onClick:e[29]||(e[29]=a=>t.gradeDialog.open=!1)},{default:l(()=>e[59]||(e[59]=[f("إلغاء")])),_:1}),s(b,{color:"primary",loading:t.gradeDialog.loading,onClick:d.submitGrade},{default:l(()=>e[60]||(e[60]=[f("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(N,{modelValue:t.recipientsDialog.open,"onUpdate:modelValue":e[34]||(e[34]=a=>t.recipientsDialog.open=a),"max-width":"700"},{default:l(()=>[s(U,null,{default:l(()=>[s(T,{class:"d-flex align-center"},{default:l(()=>[s(x,{class:"me-2"},{default:l(()=>e[61]||(e[61]=[f("ri-user-add-line")])),_:1}),e[63]||(e[63]=p("span",{class:"text-h6"},"تعيين الطلاب المستهدفين",-1)),s(k),s(b,{icon:"",variant:"text",onClick:e[31]||(e[31]=a=>t.recipientsDialog.open=!1)},{default:l(()=>[s(x,null,{default:l(()=>e[62]||(e[62]=[f("ri-close-line")])),_:1})]),_:1})]),_:1}),s(S),s(F,null,{default:l(()=>[s(D,{modelValue:t.recipientsDialog.studentIds,"onUpdate:modelValue":e[32]||(e[32]=a=>t.recipientsDialog.studentIds=a),items:t.studentsOptions,"item-title":"name","item-value":"id",label:"اختر الطلاب",chips:"",multiple:"",clearable:"",loading:t.studentsLoading},null,8,["modelValue","items","loading"])]),_:1}),s(S),s(R,null,{default:l(()=>[s(k),s(b,{variant:"text",onClick:e[33]||(e[33]=a=>t.recipientsDialog.open=!1)},{default:l(()=>e[64]||(e[64]=[f("إلغاء")])),_:1}),s(b,{color:"primary",loading:t.recipientsDialog.loading,onClick:d.submitRecipients},{default:l(()=>e[65]||(e[65]=[f("حفظ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ze=Y($,[["render",ge]]);export{ze as default};
